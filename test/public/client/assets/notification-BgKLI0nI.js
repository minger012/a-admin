import{g as Q,t as T,c as j,H as X,I as F,s as H,n as q,h as se,a7 as le,a8 as ie,b as ee,a2 as ce,a as re,e as te,k as ue,i as J,j as de,K as me,a4 as pe,a9 as fe,P as ve,_ as _e,aa as ge,ab as he,ac as L}from"./CpNavBar-djel9aZ1.js";import{P as ye,L as we}from"./index-Bl7rt81G.js";import{E as Ce}from"./index-Cj7WTVpK.js";import{C as be}from"./index-Dwpv7QBi.js";import{a as ke}from"./common-6faCF9ER.js";import{d as N,b as i,T as xe,a as g,c as W,g as Pe,r as Oe,K as Se,j as Ve,v as Ie,m as Be,u as ze,w as Te,l as $,q as m,s as A,F as Y,B as Z,y as U,A as $e,J as K,D as Ae,x as E,C as V,_ as Ee}from"./index-B6wOA8lt.js";import{u as Me}from"./use-id-CoqnX0hP.js";import"./use-tab-status-C-ic9NKg.js";const[De,G]=j("tag"),Ne={size:String,mark:Boolean,show:T,type:Q("default"),color:String,plain:Boolean,round:Boolean,textColor:String,closeable:Boolean};var Re=N({name:De,props:Ne,emits:["close"],setup(t,{slots:l,emit:_}){const r=a=>{a.stopPropagation(),_("close",a)},s=()=>t.plain?{color:t.textColor||t.color,borderColor:t.color}:{color:t.textColor,background:t.color},p=()=>{var a;const{type:x,mark:u,plain:h,round:w,size:f,closeable:v}=t,C={mark:u,plain:h,round:w};f&&(C[f]=f);const b=v&&i(F,{name:"cross",class:[G("close"),X],onClick:r},null);return i("span",{style:s(),class:G([C,x])},[(a=l.default)==null?void 0:a.call(l),b])};return()=>i(xe,{name:t.closeable?"van-fade":void 0},{default:()=>[t.show?p():null]})}});const Le=H(Re),[oe,M]=j("dropdown-menu"),We={overlay:T,zIndex:q,duration:se(.2),direction:Q("down"),activeColor:String,autoLocate:Boolean,closeOnClickOutside:T,closeOnClickOverlay:T,swipeThreshold:q},ae=Symbol(oe);var Ue=N({name:oe,props:We,setup(t,{slots:l}){const _=Me(),r=g(),s=g(),p=g(0),{children:a,linkChildren:x}=le(ae),u=ie(r),h=W(()=>a.some(e=>e.state.showWrapper)),w=W(()=>t.swipeThreshold&&a.length>+t.swipeThreshold),f=W(()=>{if(h.value&&Pe(t.zIndex))return{zIndex:+t.zIndex+1}}),v=()=>{a.forEach(e=>{e.toggle(!1)})},C=()=>{t.closeOnClickOutside&&v()},b=()=>{if(s.value){const e=te(s);t.direction==="down"?p.value=e.bottom:p.value=ue.value-e.top}},I=()=>{h.value&&b()},O=e=>{a.forEach((o,n)=>{n===e?o.toggle():o.state.showPopup&&o.toggle(!1,{immediate:!0})})},S=(e,o)=>{const{showPopup:n}=e.state,{disabled:d,titleClass:k}=e;return i("div",{id:`${_}-${o}`,role:"button",tabindex:d?void 0:0,"data-allow-mismatch":"attribute",class:[M("item",{disabled:d,grow:w.value}),{[X]:!d}],onClick:()=>{d||O(o)}},[i("span",{class:[M("title",{down:n===(t.direction==="down"),active:n}),k],style:{color:n?t.activeColor:""}},[i("div",{class:"van-ellipsis"},[e.renderTitle()])])])};return ee({close:v}),x({id:_,props:t,offset:p,updateOffset:b}),ce(r,C),re("scroll",I,{target:u,passive:!0}),()=>{var e;return i("div",{ref:r,class:M()},[i("div",{ref:s,style:f.value,class:M("bar",{opened:h.value,scrollable:w.value})},[a.map(S)]),(e=l.default)==null?void 0:e.call(l)])}}});const[Ke,D]=j("dropdown-item"),je={title:String,options:de(),disabled:Boolean,teleport:[String,Object],lazyRender:T,modelValue:J,titleClass:J};var Fe=N({name:Ke,inheritAttrs:!1,props:je,emits:["open","opened","close","closed","change","update:modelValue"],setup(t,{emit:l,slots:_,attrs:r}){const s=Oe({showPopup:!1,transition:!0,showWrapper:!1}),p=g(),{parent:a,index:x}=me(ae);if(!a)return;const u=e=>()=>l(e),h=u("open"),w=u("close"),f=u("opened"),v=()=>{s.showWrapper=!1,l("closed")},C=e=>{t.teleport&&e.stopPropagation()},b=(e=!s.showPopup,o={})=>{e!==s.showPopup&&(s.showPopup=e,s.transition=!o.immediate,e&&(a.updateOffset(),s.showWrapper=!0))},I=()=>{if(_.title)return _.title();if(t.title)return t.title;const e=t.options.find(o=>o.value===t.modelValue);return e?e.text:""},O=e=>{const{activeColor:o}=a.props,{disabled:n}=e,d=e.value===t.modelValue,k=()=>{n||(s.showPopup=!1,e.value!==t.modelValue&&(l("update:modelValue",e.value),l("change",e.value)))},P=()=>{if(d)return i(F,{class:D("icon"),color:n?void 0:o,name:"success"},null)};return i(be,{role:"menuitem",key:String(e.value),icon:e.icon,title:e.text,class:D("option",{active:d,disabled:n}),style:{color:d?o:""},tabindex:d?0:-1,clickable:!n,onClick:k},{value:P})},S=()=>{const{offset:e}=a,{autoLocate:o,zIndex:n,overlay:d,duration:k,direction:P,closeOnClickOverlay:R}=a.props,B=pe(n);let z=e.value;if(o&&p.value){const y=fe(p.value);y&&(z-=te(y).top)}return P==="down"?B.top=`${z}px`:B.bottom=`${z}px`,Ve(i("div",Be({ref:p,style:B,class:D([P]),onClick:C},r),[i(ve,{show:s.showPopup,"onUpdate:show":y=>s.showPopup=y,role:"menu",class:D("content"),overlay:d,position:P==="down"?"top":"bottom",duration:s.transition?k:0,lazyRender:t.lazyRender,overlayStyle:{position:"absolute"},"aria-labelledby":`${a.id}-${x.value}`,"data-allow-mismatch":"attribute",closeOnClickOverlay:R,onOpen:h,onClose:w,onOpened:f,onClosed:v},{default:()=>{var y;return[t.options.map(O),(y=_.default)==null?void 0:y.call(_)]}})]),[[Ie,s.showWrapper]])};return ee({state:s,toggle:b,renderTitle:I}),()=>t.teleport?i(Se,{to:t.teleport},{default:()=>[S()]}):S()}});const He=H(Fe),qe=H(Ue),Je={class:"page"},Ye={class:"filter-section"},Ze={class:"message-list"},Ge={class:"p-3 h-full"},Qe=["onClick"],Xe={class:"text-10"},et={class:"message-time"},tt={key:0,class:"unread-dot"},ot={class:"message-item-content"},at={class:"message-icon-wrapper"},nt={class:"message-body"},st={class:"message-title"},lt={class:"message-text"},it=N({__name:"notification",setup(t){const{t:l}=ze(),_=ke(),r=g({page:0,pageSize:10}),s=g(!1),p=g(!1),a=g([]),x=async()=>{p.value||(s.value=!0,r.value.page++,await L(r.value,f.value,v.value).then(o=>{a.value.push(...o.data.list),r.value.page>=o.data.total_page&&(p.value=!0),s.value=!1}).catch(()=>{s.value=!1}))},u=g(!1),h=async()=>{r.value.page=1,await L(r.value,f.value,v.value).then(o=>{a.value=o.data.list,u.value=!1}).catch(()=>{u.value=!1})},w=o=>{o.read_time==0&&(ge(o.id),a.value=a.value.map(n=>(n.id==o.id&&(n.read_time=1),n))),he({title:o.title,message:o.content}).then(()=>{})},f=g(0),v=g(0);Te([f,v],async([o,n])=>{r.value.page=1,a.value=[],u.value=!0,await L(r.value,o,n).then(d=>{a.value=d.data.list,u.value=!1}).catch(()=>{u.value=!1})});const C=[{text:l("notification.allMessages"),value:0},{text:l("notification.systemAnnouncement"),value:1},{text:l("notification.systemMaintenance"),value:2},{text:l("notification.activityNotification"),value:3}],b=[{text:l("notification.allStatus"),value:0},{text:l("notification.unreadMessages"),value:1},{text:l("notification.readMessages"),value:2}],I={1:l("notification.systemAnnouncement"),2:l("notification.systemMaintenance"),3:l("notification.activityNotification")},O={1:"icon-blue",2:"icon-orange",3:"icon-red"},S={1:"primary",2:"warning",3:"danger"},e={1:"volume-o",2:"setting-o",3:"gift-o"};return(o,n)=>{const d=_e,k=He,P=qe,R=Ce,B=Le,z=F,y=we,ne=ye;return V(),$(Y,null,[i(d),m("div",Je,[m("div",Ye,[i(P,{"swipe-threshold":"2"},{default:A(()=>[i(k,{modelValue:f.value,"onUpdate:modelValue":n[0]||(n[0]=c=>f.value=c),options:C},null,8,["modelValue"]),i(k,{modelValue:v.value,"onUpdate:modelValue":n[1]||(n[1]=c=>v.value=c),options:b},null,8,["modelValue"])]),_:1})]),m("div",Ze,[i(ne,{modelValue:u.value,"onUpdate:modelValue":n[3]||(n[3]=c=>u.value=c),onRefresh:h},{default:A(()=>[a.value?(V(),Z(y,{key:1,loading:s.value,"onUpdate:loading":n[2]||(n[2]=c=>s.value=c),finished:p.value,onLoad:x,"finished-text":U(l)("common.noMore")},{default:A(()=>[m("div",Ge,[(V(!0),$(Y,null,$e(a.value,c=>(V(),$("div",{class:"message-item type-system_announcement",onClick:ct=>w(c)},[m("div",{class:K(["message-item-header",c.read_time==0?"unread":""])},[m("div",{class:K(["message-type-indicator",O[c.type]])},null,2),i(B,{type:S[c.type]},{default:A(()=>[m("span",Xe,E(I[c.type]),1)]),_:2},1032,["type"]),m("span",et,E(U(_).timeAgo(c.create_time)),1),c.read_time==0?(V(),$("div",tt)):Ae("",!0)],2),m("div",ot,[m("div",at,[m("div",{class:K(["message-icon",O[c.type]])},[i(z,{name:e[c.type],size:"1.125rem"},null,8,["name"])],2)]),m("div",nt,[m("h3",st,E(c.title),1),m("p",lt,E(c.content),1)])])],8,Qe))),256))])]),_:1},8,["loading","finished","finished-text"])):(V(),Z(R,{key:0,description:U(l)("notification.noMessages")},null,8,["description"]))]),_:1},8,["modelValue"])])])],64)}}}),gt=Ee(it,[["__scopeId","data-v-0d4e8d45"]]);export{gt as default};
