import{d as N,l as Q,t as B,g as j,f as i,al as le,H as X,I as q,J as F,n as K,o as ie,a as _,ar as ce,as as re,c as L,N as ue,e as ee,ak as de,b as me,j as te,y as pe,q as Y,s as fe,r as ve,af as _e,am as ge,ao as he,at as ye,S as we,T as Ce,P as ke,A as be,V as xe,w as Pe,W as T,Y as m,$ as A,Z,a3 as J,a1 as W,_ as Se,a4 as U,a9 as Oe,a0 as R,a8 as O,aa as Ve}from"./index-vQrqw6fU.js";import{P as Ie,L as $e}from"./index-B4WzkpQL.js";import{E as ze}from"./index-hbUtGqP-.js";import{C as Be}from"./index-6t32LDw6.js";import{_ as Te,o as Ae,q as Re,t as H}from"./CpNavBar-DUuFUbYm.js";import{a as Ee}from"./common--UIybQxO.js";import{u as Me}from"./use-id-8PMqNpWA.js";import"./use-tab-status-kLUgJ0_C.js";const[Ne,G]=j("tag"),De={size:String,mark:Boolean,show:B,type:Q("default"),color:String,plain:Boolean,round:Boolean,textColor:String,closeable:Boolean};var Le=N({name:Ne,props:De,emits:["close"],setup(t,{slots:l,emit:g}){const u=o=>{o.stopPropagation(),g("close",o)},s=()=>t.plain?{color:t.textColor||t.color,borderColor:t.color}:{color:t.textColor,background:t.color},p=()=>{var o;const{type:P,mark:d,plain:h,round:y,size:w,closeable:f}=t,v={mark:d,plain:h,round:y};w&&(v[w]=w);const b=f&&i(q,{name:"cross",class:[G("close"),X],onClick:u},null);return i("span",{style:s(),class:G([v,P])},[(o=l.default)==null?void 0:o.call(l),b])};return()=>i(le,{name:t.closeable?"van-fade":void 0},{default:()=>[t.show?p():null]})}});const We=F(Le),[oe,E]=j("dropdown-menu"),Ue={overlay:B,zIndex:K,duration:ie(.2),direction:Q("down"),activeColor:String,autoLocate:Boolean,closeOnClickOutside:B,closeOnClickOverlay:B,swipeThreshold:K},ae=Symbol(oe);var He=N({name:oe,props:Ue,setup(t,{slots:l}){const g=Me(),u=_(),s=_(),p=_(0),{children:o,linkChildren:P}=ce(ae),d=re(u),h=L(()=>o.some(e=>e.state.showWrapper)),y=L(()=>t.swipeThreshold&&o.length>+t.swipeThreshold),w=L(()=>{if(h.value&&ue(t.zIndex))return{zIndex:+t.zIndex+1}}),f=()=>{o.forEach(e=>{e.toggle(!1)})},v=()=>{t.closeOnClickOutside&&f()},b=()=>{if(s.value){const e=te(s);t.direction==="down"?p.value=e.bottom:p.value=pe.value-e.top}},V=()=>{h.value&&b()},I=e=>{o.forEach((r,a)=>{a===e?r.toggle():r.state.showPopup&&r.toggle(!1,{immediate:!0})})},S=(e,r)=>{const{showPopup:a}=e.state,{disabled:n,titleClass:C}=e;return i("div",{id:`${g}-${r}`,role:"button",tabindex:n?void 0:0,"data-allow-mismatch":"attribute",class:[E("item",{disabled:n,grow:y.value}),{[X]:!n}],onClick:()=>{n||I(r)}},[i("span",{class:[E("title",{down:a===(t.direction==="down"),active:a}),C],style:{color:a?t.activeColor:""}},[i("div",{class:"van-ellipsis"},[e.renderTitle()])])])};return ee({close:f}),P({id:g,props:t,offset:p,updateOffset:b}),de(u,v),me("scroll",V,{target:d,passive:!0}),()=>{var e;return i("div",{ref:u,class:E()},[i("div",{ref:s,style:w.value,class:E("bar",{opened:h.value,scrollable:y.value})},[o.map(S)]),(e=l.default)==null?void 0:e.call(l)])}}});const[je,M]=j("dropdown-item"),qe={title:String,options:fe(),disabled:Boolean,teleport:[String,Object],lazyRender:B,modelValue:Y,titleClass:Y};var Fe=N({name:je,inheritAttrs:!1,props:qe,emits:["open","opened","close","closed","change","update:modelValue"],setup(t,{emit:l,slots:g,attrs:u}){const s=ve({showPopup:!1,transition:!0,showWrapper:!1}),p=_(),{parent:o,index:P}=_e(ae);if(!o)return;const d=e=>()=>l(e),h=d("open"),y=d("close"),w=d("opened"),f=()=>{s.showWrapper=!1,l("closed")},v=e=>{t.teleport&&e.stopPropagation()},b=(e=!s.showPopup,r={})=>{e!==s.showPopup&&(s.showPopup=e,s.transition=!r.immediate,e&&(o.updateOffset(),s.showWrapper=!0))},V=()=>{if(g.title)return g.title();if(t.title)return t.title;const e=t.options.find(r=>r.value===t.modelValue);return e?e.text:""},I=e=>{const{activeColor:r}=o.props,{disabled:a}=e,n=e.value===t.modelValue,C=()=>{a||(s.showPopup=!1,e.value!==t.modelValue&&(l("update:modelValue",e.value),l("change",e.value)))},x=()=>{if(n)return i(q,{class:M("icon"),color:a?void 0:r,name:"success"},null)};return i(Be,{role:"menuitem",key:String(e.value),icon:e.icon,title:e.text,class:M("option",{active:n,disabled:a}),style:{color:n?r:""},tabindex:n?0:-1,clickable:!a,onClick:C},{value:x})},S=()=>{const{offset:e}=o,{autoLocate:r,zIndex:a,overlay:n,duration:C,direction:x,closeOnClickOverlay:D}=o.props,$=he(a);let z=e.value;if(r&&p.value){const k=ye(p.value);k&&(z-=te(k).top)}return x==="down"?$.top=`${z}px`:$.bottom=`${z}px`,we(i("div",be({ref:p,style:$,class:M([x]),onClick:v},u),[i(ke,{show:s.showPopup,"onUpdate:show":k=>s.showPopup=k,role:"menu",class:M("content"),overlay:n,position:x==="down"?"top":"bottom",duration:s.transition?C:0,lazyRender:t.lazyRender,overlayStyle:{position:"absolute"},"aria-labelledby":`${o.id}-${P.value}`,"data-allow-mismatch":"attribute",closeOnClickOverlay:D,onOpen:h,onClose:y,onOpened:w,onClosed:f},{default:()=>{var k;return[t.options.map(I),(k=g.default)==null?void 0:k.call(g)]}})]),[[Ce,s.showWrapper]])};return ee({state:s,toggle:b,renderTitle:V}),()=>t.teleport?i(ge,{to:t.teleport},{default:()=>[S()]}):S()}});const Ke=F(Fe),Ye=F(He),Ze={class:"page"},Je={class:"filter-section"},Ge={class:"message-list"},Qe={class:"p-3 h-full"},Xe=["onClick"],et={class:"text-10"},tt={class:"message-time"},ot={key:0,class:"unread-dot"},at={class:"message-item-content"},nt={class:"message-icon-wrapper"},st={class:"message-body"},lt={class:"message-title"},it={class:"message-text"},ct=N({__name:"notification",setup(t){const{t:l}=xe(),g=Ee(),u=_({page:0,pageSize:10}),s=_(!1),p=_(!1),o=_([]),P=async()=>{p.value||(s.value=!0,u.value.page++,await H(u.value,f.value,v.value).then(a=>{o.value.push(...a.data.list),u.value.page>=a.data.total_page&&(p.value=!0),s.value=!1}).catch(()=>{s.value=!1}))},d=_(!1),h=async()=>{u.value.page=1,await H(u.value,f.value,v.value).then(a=>{o.value=a.data.list,d.value=!1}).catch(()=>{d.value=!1})},y=_(null),w=a=>{a.read_time==0&&(Ae(a.id),o.value=o.value.map(n=>(n.id==a.id&&(n.read_time=1,y.value.fetchUnreadCount()),n))),Re({title:a.title,message:a.content}).then(()=>{})},f=_(0),v=_(0);Pe([f,v],async([a,n])=>{u.value.page=1,o.value=[],d.value=!0,await H(u.value,a,n).then(C=>{o.value=C.data.list,d.value=!1}).catch(()=>{d.value=!1})});const b=[{text:l("notification.allMessages"),value:0},{text:l("notification.systemAnnouncement"),value:1},{text:l("notification.systemMaintenance"),value:2},{text:l("notification.activityNotification"),value:3}],V=[{text:l("notification.allStatus"),value:0},{text:l("notification.unreadMessages"),value:1},{text:l("notification.readMessages"),value:2}],I={1:l("notification.systemAnnouncement"),2:l("notification.systemMaintenance"),3:l("notification.activityNotification")},S={1:"icon-blue",2:"icon-orange",3:"icon-red"},e={1:"primary",2:"warning",3:"danger"},r={1:"volume-o",2:"setting-o",3:"gift-o"};return(a,n)=>{const C=Te,x=Ke,D=Ye,$=ze,z=We,k=q,ne=$e,se=Ie;return O(),T(Z,null,[i(C,{ref_key:"childRef",ref:y},null,512),m("div",Ze,[m("div",Je,[i(D,{"swipe-threshold":"2"},{default:A(()=>[i(x,{modelValue:f.value,"onUpdate:modelValue":n[0]||(n[0]=c=>f.value=c),options:b},null,8,["modelValue"]),i(x,{modelValue:v.value,"onUpdate:modelValue":n[1]||(n[1]=c=>v.value=c),options:V},null,8,["modelValue"])]),_:1})]),m("div",Ge,[i(se,{modelValue:d.value,"onUpdate:modelValue":n[3]||(n[3]=c=>d.value=c),onRefresh:h},{default:A(()=>[o.value?(O(),J(ne,{key:1,loading:s.value,"onUpdate:loading":n[2]||(n[2]=c=>s.value=c),finished:p.value,onLoad:P,"finished-text":W(l)("common.noMore")},{default:A(()=>[m("div",Qe,[(O(!0),T(Z,null,Se(o.value,c=>(O(),T("div",{class:"message-item type-system_announcement",onClick:rt=>w(c)},[m("div",{class:U(["message-item-header",c.read_time==0?"unread":""])},[m("div",{class:U(["message-type-indicator",S[c.type]])},null,2),i(z,{type:e[c.type]},{default:A(()=>[m("span",et,R(I[c.type]),1)]),_:2},1032,["type"]),m("span",tt,R(W(g).timeAgo(c.create_time)),1),c.read_time==0?(O(),T("div",ot)):Oe("",!0)],2),m("div",at,[m("div",nt,[m("div",{class:U(["message-icon",S[c.type]])},[i(k,{name:r[c.type],size:"1.125rem"},null,8,["name"])],2)]),m("div",st,[m("h3",lt,R(c.title),1),m("p",it,R(c.content),1)])])],8,Xe))),256))])]),_:1},8,["loading","finished","finished-text"])):(O(),J($,{key:0,description:W(l)("notification.noMessages")},null,8,["description"]))]),_:1},8,["modelValue"])])])],64)}}}),ht=Ve(ct,[["__scopeId","data-v-f826dce1"]]);export{ht as default};
