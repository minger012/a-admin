import{g as Q,t as $,c as F,H as X,I as H,y as K,n as q,h as se,ad as le,ae as ie,B as ce,b as ee,a8 as re,a as de,e as te,l as ue,i as G,j as me,S as pe,aa as fe,af as ve,P as ge,_ as _e,ag as he,ah as ye,ai as W}from"./CpNavBar-BGhrA26v.js";import{P as we,L as Ce}from"./index-BOOpFCIE.js";import{E as xe}from"./index-CtUvwBnm.js";import{C as be}from"./index-BQYZZJmj.js";import{a as ke}from"./common-VvLUS-WY.js";import{d as N,b as i,T as Pe,a as _,c as U,r as Se,G as Oe,f as Ve,v as Ie,m as Be,u as ze,w as Te,g as R,h as m,i as A,j as k,F as Y,p as Z,l as $e,B as j,x as Re,t as E,q as I,_ as Ae}from"./index-DqBSD0aN.js";import{u as Ee}from"./use-id-BHI6m-7i.js";import"./use-tab-status-DAeoIkwI.js";const[Me,J]=F("tag"),De={size:String,mark:Boolean,show:$,type:Q("default"),color:String,plain:Boolean,round:Boolean,textColor:String,closeable:Boolean};var Ne=N({name:Me,props:De,emits:["close"],setup(t,{slots:a,emit:g}){const r=n=>{n.stopPropagation(),g("close",n)},l=()=>t.plain?{color:t.textColor||t.color,borderColor:t.color}:{color:t.textColor,background:t.color},p=()=>{var n;const{type:P,mark:d,plain:h,round:w,size:f,closeable:v}=t,C={mark:d,plain:h,round:w};f&&(C[f]=f);const x=v&&i(H,{name:"cross",class:[J("close"),X],onClick:r},null);return i("span",{style:l(),class:J([C,P])},[(n=a.default)==null?void 0:n.call(a),x])};return()=>i(Pe,{name:t.closeable?"van-fade":void 0},{default:()=>[t.show?p():null]})}});const Le=K(Ne),[oe,M]=F("dropdown-menu"),We={overlay:$,zIndex:q,duration:se(.2),direction:Q("down"),activeColor:String,autoLocate:Boolean,closeOnClickOutside:$,closeOnClickOverlay:$,swipeThreshold:q},ae=Symbol(oe);var Ue=N({name:oe,props:We,setup(t,{slots:a}){const g=Ee(),r=_(),l=_(),p=_(0),{children:n,linkChildren:P}=le(ae),d=ie(r),h=U(()=>n.some(e=>e.state.showWrapper)),w=U(()=>t.swipeThreshold&&n.length>+t.swipeThreshold),f=U(()=>{if(h.value&&ce(t.zIndex))return{zIndex:+t.zIndex+1}}),v=()=>{n.forEach(e=>{e.toggle(!1)})},C=()=>{t.closeOnClickOutside&&v()},x=()=>{if(l.value){const e=te(l);t.direction==="down"?p.value=e.bottom:p.value=ue.value-e.top}},B=()=>{h.value&&x()},O=e=>{n.forEach((o,s)=>{s===e?o.toggle():o.state.showPopup&&o.toggle(!1,{immediate:!0})})},V=(e,o)=>{const{showPopup:s}=e.state,{disabled:u,titleClass:b}=e;return i("div",{id:`${g}-${o}`,role:"button",tabindex:u?void 0:0,"data-allow-mismatch":"attribute",class:[M("item",{disabled:u,grow:w.value}),{[X]:!u}],onClick:()=>{u||O(o)}},[i("span",{class:[M("title",{down:s===(t.direction==="down"),active:s}),b],style:{color:s?t.activeColor:""}},[i("div",{class:"van-ellipsis"},[e.renderTitle()])])])};return ee({close:v}),P({id:g,props:t,offset:p,updateOffset:x}),re(r,C),de("scroll",B,{target:d,passive:!0}),()=>{var e;return i("div",{ref:r,class:M()},[i("div",{ref:l,style:f.value,class:M("bar",{opened:h.value,scrollable:w.value})},[n.map(V)]),(e=a.default)==null?void 0:e.call(a)])}}});const[je,D]=F("dropdown-item"),Fe={title:String,options:me(),disabled:Boolean,teleport:[String,Object],lazyRender:$,modelValue:G,titleClass:G};var He=N({name:je,inheritAttrs:!1,props:Fe,emits:["open","opened","close","closed","change","update:modelValue"],setup(t,{emit:a,slots:g,attrs:r}){const l=Se({showPopup:!1,transition:!0,showWrapper:!1}),p=_(),{parent:n,index:P}=pe(ae);if(!n)return;const d=e=>()=>a(e),h=d("open"),w=d("close"),f=d("opened"),v=()=>{l.showWrapper=!1,a("closed")},C=e=>{t.teleport&&e.stopPropagation()},x=(e=!l.showPopup,o={})=>{e!==l.showPopup&&(l.showPopup=e,l.transition=!o.immediate,e&&(n.updateOffset(),l.showWrapper=!0))},B=()=>{if(g.title)return g.title();if(t.title)return t.title;const e=t.options.find(o=>o.value===t.modelValue);return e?e.text:""},O=e=>{const{activeColor:o}=n.props,{disabled:s}=e,u=e.value===t.modelValue,b=()=>{s||(l.showPopup=!1,e.value!==t.modelValue&&(a("update:modelValue",e.value),a("change",e.value)))},S=()=>{if(u)return i(H,{class:D("icon"),color:s?void 0:o,name:"success"},null)};return i(be,{role:"menuitem",key:String(e.value),icon:e.icon,title:e.text,class:D("option",{active:u,disabled:s}),style:{color:u?o:""},tabindex:u?0:-1,clickable:!s,onClick:b},{value:S})},V=()=>{const{offset:e}=n,{autoLocate:o,zIndex:s,overlay:u,duration:b,direction:S,closeOnClickOverlay:L}=n.props,z=fe(s);let T=e.value;if(o&&p.value){const y=ve(p.value);y&&(T-=te(y).top)}return S==="down"?z.top=`${T}px`:z.bottom=`${T}px`,Ve(i("div",Be({ref:p,style:z,class:D([S]),onClick:C},r),[i(ge,{show:l.showPopup,"onUpdate:show":y=>l.showPopup=y,role:"menu",class:D("content"),overlay:u,position:S==="down"?"top":"bottom",duration:l.transition?b:0,lazyRender:t.lazyRender,overlayStyle:{position:"absolute"},"aria-labelledby":`${n.id}-${P.value}`,"data-allow-mismatch":"attribute",closeOnClickOverlay:L,onOpen:h,onClose:w,onOpened:f,onClosed:v},{default:()=>{var y;return[t.options.map(O),(y=g.default)==null?void 0:y.call(g)]}})]),[[Ie,l.showWrapper]])};return ee({state:l,toggle:x,renderTitle:B}),()=>t.teleport?i(Oe,{to:t.teleport},{default:()=>[V()]}):V()}});const Ke=K(He),qe=K(Ue),Ge={class:"page"},Ye={class:"filter-section"},Ze={class:"message-list"},Je={class:"p-3 h-full"},Qe=["onClick"],Xe={class:"text-10"},et={class:"message-time"},tt={key:0,class:"unread-dot"},ot={class:"message-item-content"},at={class:"message-icon-wrapper"},nt={class:"message-body"},st={class:"message-title"},lt={class:"message-text"},it=N({__name:"notification",setup(t){const{t:a}=ze(),g=ke(),r=_({page:0,pageSize:10}),l=_(!1),p=_(!1),n=_([]),P=async()=>{p.value||(l.value=!0,r.value.page++,await W(r.value,f.value,v.value).then(o=>{n.value.push(...o.data.list),r.value.page>=o.data.total_page&&(p.value=!0),l.value=!1}).catch(()=>{l.value=!1}))},d=_(!1),h=async()=>{r.value.page=1,await W(r.value,f.value,v.value).then(o=>{n.value=o.data.list,d.value=!1}).catch(()=>{d.value=!1})},w=o=>{o.read_time==0&&(he(o.id),n.value=n.value.map(s=>(s.id==o.id&&(s.read_time=1),s))),ye({title:o.title,message:o.content}).then(()=>{})},f=_(0),v=_(0);Te([f,v],async([o,s])=>{r.value.page=1,n.value=[],d.value=!0,await W(r.value,o,s).then(u=>{n.value=u.data.list,d.value=!1}).catch(()=>{d.value=!1})});const C=[{text:a("notification.allMessages"),value:0},{text:a("notification.systemAnnouncement"),value:1},{text:a("notification.systemMaintenance"),value:2},{text:a("notification.activityNotification"),value:3}],x=[{text:a("notification.allStatus"),value:0},{text:a("notification.unreadMessages"),value:1},{text:a("notification.readMessages"),value:2}],B={1:a("notification.systemAnnouncement"),2:a("notification.systemMaintenance"),3:a("notification.activityNotification")},O={1:"icon-blue",2:"icon-orange",3:"icon-red"},V={1:"primary",2:"warning",3:"danger"},e={1:"volume-o",2:"setting-o",3:"gift-o"};return(o,s)=>{const u=_e,b=Ke,S=qe,L=xe,z=Le,T=H,y=Ce,ne=we;return I(),R(Y,null,[i(u),m("div",Ge,[m("div",Ye,[i(S,{"swipe-threshold":"2"},{default:A(()=>[i(b,{modelValue:f.value,"onUpdate:modelValue":s[0]||(s[0]=c=>f.value=c),options:C},null,8,["modelValue"]),i(b,{modelValue:v.value,"onUpdate:modelValue":s[1]||(s[1]=c=>v.value=c),options:x},null,8,["modelValue"])]),_:1})]),m("div",Ze,[i(ne,{modelValue:d.value,"onUpdate:modelValue":s[3]||(s[3]=c=>d.value=c),onRefresh:h,"pulling-text":k(a)("common.pullDownRefresh"),"loosing-text":k(a)("common.releaseRefresh"),"loading-text":k(a)("common.loading")},{default:A(()=>[n.value?(I(),Z(y,{key:1,loading:l.value,"onUpdate:loading":s[2]||(s[2]=c=>l.value=c),finished:p.value,"finished-text":k(a)("common.noMore"),"loading-text":k(a)("common.loading"),"error-text":k(a)("common.fail"),onLoad:P},{default:A(()=>[m("div",Je,[(I(!0),R(Y,null,$e(n.value,c=>(I(),R("div",{class:"message-item type-system_announcement",onClick:ct=>w(c)},[m("div",{class:j(["message-item-header",c.read_time==0?"unread":""])},[m("div",{class:j(["message-type-indicator",O[c.type]])},null,2),i(z,{type:V[c.type]},{default:A(()=>[m("span",Xe,E(B[c.type]),1)]),_:2},1032,["type"]),m("span",et,E(k(g).timeAgo(c.create_time)),1),c.read_time==0?(I(),R("div",tt)):Re("",!0)],2),m("div",ot,[m("div",at,[m("div",{class:j(["message-icon",O[c.type]])},[i(T,{name:e[c.type],size:"1.125rem"},null,8,["name"])],2)]),m("div",nt,[m("h3",st,E(c.title),1),m("p",lt,E(c.content),1)])])],8,Qe))),256))])]),_:1},8,["loading","finished","finished-text","loading-text","error-text"])):(I(),Z(L,{key:0,description:k(a)("notification.noMessages")},null,8,["description"]))]),_:1},8,["modelValue","pulling-text","loosing-text","loading-text"])])])],64)}}}),_t=Ae(it,[["__scopeId","data-v-a7bcad2c"]]);export{_t as default};
