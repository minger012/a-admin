import{g as Q,t as T,c as j,H as X,I as F,s as H,n as q,h as le,a7 as ie,a8 as ce,b as ee,a2 as re,a as ue,e as te,k as de,i as J,j as me,K as pe,a4 as fe,a9 as ve,P as _e,_ as ge,aa as he,ab as ye,ac as L}from"./CpNavBar-n7MbzKf8.js";import{P as we,L as Ce}from"./index-Dc2O9QY3.js";import{E as be}from"./index-DxR1XFmb.js";import{C as ke}from"./index-C3MOloKJ.js";import{a as xe}from"./common-5rSUidVe.js";import{d as D,b as i,T as Pe,a as _,c as W,g as Oe,r as Se,K as Ve,j as Ie,v as Be,m as ze,u as Te,w as $e,l as $,q as m,s as A,F as Y,B as Z,y as U,A as Ae,J as K,D as Re,x as R,C as S,_ as Ee}from"./index-BDHkMs_b.js";import{u as Me}from"./use-id-CeQUJRjB.js";import"./use-tab-status-TafqOlit.js";const[De,G]=j("tag"),Ne={size:String,mark:Boolean,show:T,type:Q("default"),color:String,plain:Boolean,round:Boolean,textColor:String,closeable:Boolean};var Le=D({name:De,props:Ne,emits:["close"],setup(t,{slots:l,emit:g}){const u=o=>{o.stopPropagation(),g("close",o)},s=()=>t.plain?{color:t.textColor||t.color,borderColor:t.color}:{color:t.textColor,background:t.color},p=()=>{var o;const{type:P,mark:d,plain:h,round:y,size:w,closeable:f}=t,v={mark:d,plain:h,round:y};w&&(v[w]=w);const k=f&&i(F,{name:"cross",class:[G("close"),X],onClick:u},null);return i("span",{style:s(),class:G([v,P])},[(o=l.default)==null?void 0:o.call(l),k])};return()=>i(Pe,{name:t.closeable?"van-fade":void 0},{default:()=>[t.show?p():null]})}});const We=H(Le),[oe,E]=j("dropdown-menu"),Ue={overlay:T,zIndex:q,duration:le(.2),direction:Q("down"),activeColor:String,autoLocate:Boolean,closeOnClickOutside:T,closeOnClickOverlay:T,swipeThreshold:q},ae=Symbol(oe);var Ke=D({name:oe,props:Ue,setup(t,{slots:l}){const g=Me(),u=_(),s=_(),p=_(0),{children:o,linkChildren:P}=ie(ae),d=ce(u),h=W(()=>o.some(e=>e.state.showWrapper)),y=W(()=>t.swipeThreshold&&o.length>+t.swipeThreshold),w=W(()=>{if(h.value&&Oe(t.zIndex))return{zIndex:+t.zIndex+1}}),f=()=>{o.forEach(e=>{e.toggle(!1)})},v=()=>{t.closeOnClickOutside&&f()},k=()=>{if(s.value){const e=te(s);t.direction==="down"?p.value=e.bottom:p.value=de.value-e.top}},V=()=>{h.value&&k()},I=e=>{o.forEach((r,a)=>{a===e?r.toggle():r.state.showPopup&&r.toggle(!1,{immediate:!0})})},O=(e,r)=>{const{showPopup:a}=e.state,{disabled:n,titleClass:C}=e;return i("div",{id:`${g}-${r}`,role:"button",tabindex:n?void 0:0,"data-allow-mismatch":"attribute",class:[E("item",{disabled:n,grow:y.value}),{[X]:!n}],onClick:()=>{n||I(r)}},[i("span",{class:[E("title",{down:a===(t.direction==="down"),active:a}),C],style:{color:a?t.activeColor:""}},[i("div",{class:"van-ellipsis"},[e.renderTitle()])])])};return ee({close:f}),P({id:g,props:t,offset:p,updateOffset:k}),re(u,v),ue("scroll",V,{target:d,passive:!0}),()=>{var e;return i("div",{ref:u,class:E()},[i("div",{ref:s,style:w.value,class:E("bar",{opened:h.value,scrollable:y.value})},[o.map(O)]),(e=l.default)==null?void 0:e.call(l)])}}});const[je,M]=j("dropdown-item"),Fe={title:String,options:me(),disabled:Boolean,teleport:[String,Object],lazyRender:T,modelValue:J,titleClass:J};var He=D({name:je,inheritAttrs:!1,props:Fe,emits:["open","opened","close","closed","change","update:modelValue"],setup(t,{emit:l,slots:g,attrs:u}){const s=Se({showPopup:!1,transition:!0,showWrapper:!1}),p=_(),{parent:o,index:P}=pe(ae);if(!o)return;const d=e=>()=>l(e),h=d("open"),y=d("close"),w=d("opened"),f=()=>{s.showWrapper=!1,l("closed")},v=e=>{t.teleport&&e.stopPropagation()},k=(e=!s.showPopup,r={})=>{e!==s.showPopup&&(s.showPopup=e,s.transition=!r.immediate,e&&(o.updateOffset(),s.showWrapper=!0))},V=()=>{if(g.title)return g.title();if(t.title)return t.title;const e=t.options.find(r=>r.value===t.modelValue);return e?e.text:""},I=e=>{const{activeColor:r}=o.props,{disabled:a}=e,n=e.value===t.modelValue,C=()=>{a||(s.showPopup=!1,e.value!==t.modelValue&&(l("update:modelValue",e.value),l("change",e.value)))},x=()=>{if(n)return i(F,{class:M("icon"),color:a?void 0:r,name:"success"},null)};return i(ke,{role:"menuitem",key:String(e.value),icon:e.icon,title:e.text,class:M("option",{active:n,disabled:a}),style:{color:n?r:""},tabindex:n?0:-1,clickable:!a,onClick:C},{value:x})},O=()=>{const{offset:e}=o,{autoLocate:r,zIndex:a,overlay:n,duration:C,direction:x,closeOnClickOverlay:N}=o.props,B=fe(a);let z=e.value;if(r&&p.value){const b=ve(p.value);b&&(z-=te(b).top)}return x==="down"?B.top=`${z}px`:B.bottom=`${z}px`,Ie(i("div",ze({ref:p,style:B,class:M([x]),onClick:v},u),[i(_e,{show:s.showPopup,"onUpdate:show":b=>s.showPopup=b,role:"menu",class:M("content"),overlay:n,position:x==="down"?"top":"bottom",duration:s.transition?C:0,lazyRender:t.lazyRender,overlayStyle:{position:"absolute"},"aria-labelledby":`${o.id}-${P.value}`,"data-allow-mismatch":"attribute",closeOnClickOverlay:N,onOpen:h,onClose:y,onOpened:w,onClosed:f},{default:()=>{var b;return[t.options.map(I),(b=g.default)==null?void 0:b.call(g)]}})]),[[Be,s.showWrapper]])};return ee({state:s,toggle:k,renderTitle:V}),()=>t.teleport?i(Ve,{to:t.teleport},{default:()=>[O()]}):O()}});const qe=H(He),Je=H(Ke),Ye={class:"page"},Ze={class:"filter-section"},Ge={class:"message-list"},Qe={class:"p-3 h-full"},Xe=["onClick"],et={class:"text-10"},tt={class:"message-time"},ot={key:0,class:"unread-dot"},at={class:"message-item-content"},nt={class:"message-icon-wrapper"},st={class:"message-body"},lt={class:"message-title"},it={class:"message-text"},ct=D({__name:"notification",setup(t){const{t:l}=Te(),g=xe(),u=_({page:0,pageSize:10}),s=_(!1),p=_(!1),o=_([]),P=async()=>{p.value||(s.value=!0,u.value.page++,await L(u.value,f.value,v.value).then(a=>{o.value.push(...a.data.list),u.value.page>=a.data.total_page&&(p.value=!0),s.value=!1}).catch(()=>{s.value=!1}))},d=_(!1),h=async()=>{u.value.page=1,await L(u.value,f.value,v.value).then(a=>{o.value=a.data.list,d.value=!1}).catch(()=>{d.value=!1})},y=_(null),w=a=>{a.read_time==0&&(he(a.id),o.value=o.value.map(n=>(n.id==a.id&&(n.read_time=1,y.value.fetchUnreadCount()),n))),ye({title:a.title,message:a.content}).then(()=>{})},f=_(0),v=_(0);$e([f,v],async([a,n])=>{u.value.page=1,o.value=[],d.value=!0,await L(u.value,a,n).then(C=>{o.value=C.data.list,d.value=!1}).catch(()=>{d.value=!1})});const k=[{text:l("notification.allMessages"),value:0},{text:l("notification.systemAnnouncement"),value:1},{text:l("notification.systemMaintenance"),value:2},{text:l("notification.activityNotification"),value:3}],V=[{text:l("notification.allStatus"),value:0},{text:l("notification.unreadMessages"),value:1},{text:l("notification.readMessages"),value:2}],I={1:l("notification.systemAnnouncement"),2:l("notification.systemMaintenance"),3:l("notification.activityNotification")},O={1:"icon-blue",2:"icon-orange",3:"icon-red"},e={1:"primary",2:"warning",3:"danger"},r={1:"volume-o",2:"setting-o",3:"gift-o"};return(a,n)=>{const C=ge,x=qe,N=Je,B=be,z=We,b=F,ne=Ce,se=we;return S(),$(Y,null,[i(C,{ref_key:"childRef",ref:y},null,512),m("div",Ye,[m("div",Ze,[i(N,{"swipe-threshold":"2"},{default:A(()=>[i(x,{modelValue:f.value,"onUpdate:modelValue":n[0]||(n[0]=c=>f.value=c),options:k},null,8,["modelValue"]),i(x,{modelValue:v.value,"onUpdate:modelValue":n[1]||(n[1]=c=>v.value=c),options:V},null,8,["modelValue"])]),_:1})]),m("div",Ge,[i(se,{modelValue:d.value,"onUpdate:modelValue":n[3]||(n[3]=c=>d.value=c),onRefresh:h},{default:A(()=>[o.value?(S(),Z(ne,{key:1,loading:s.value,"onUpdate:loading":n[2]||(n[2]=c=>s.value=c),finished:p.value,onLoad:P,"finished-text":U(l)("common.noMore")},{default:A(()=>[m("div",Qe,[(S(!0),$(Y,null,Ae(o.value,c=>(S(),$("div",{class:"message-item type-system_announcement",onClick:rt=>w(c)},[m("div",{class:K(["message-item-header",c.read_time==0?"unread":""])},[m("div",{class:K(["message-type-indicator",O[c.type]])},null,2),i(z,{type:e[c.type]},{default:A(()=>[m("span",et,R(I[c.type]),1)]),_:2},1032,["type"]),m("span",tt,R(U(g).timeAgo(c.create_time)),1),c.read_time==0?(S(),$("div",ot)):Re("",!0)],2),m("div",at,[m("div",nt,[m("div",{class:K(["message-icon",O[c.type]])},[i(b,{name:r[c.type],size:"1.125rem"},null,8,["name"])],2)]),m("div",st,[m("h3",lt,R(c.title),1),m("p",it,R(c.content),1)])])],8,Xe))),256))])]),_:1},8,["loading","finished","finished-text"])):(S(),Z(B,{key:0,description:U(l)("notification.noMessages")},null,8,["description"]))]),_:1},8,["modelValue"])])])],64)}}}),ht=Ee(ct,[["__scopeId","data-v-f826dce1"]]);export{ht as default};
