import{G as Q,t as B,d as H,T as X,I as j,w as G,n as K,R as se,Y as le,Z as ie,H as ce,i as ee,S as re,$ as ue,a0 as te,a1 as de,u as Y,a2 as me,h as pe,V as fe,a3 as ve,P as ge,_ as _e,a4 as he,a5 as we,a6 as W}from"./CpNavBar-YKSWdiMH.js";import{P as ye,L as Ce}from"./index-B93TrPKR.js";import{E as xe}from"./index-DIFNj-OC.js";import{C as be}from"./index-DDBs86HS.js";import{a as ke}from"./common-C6QzqCjM.js";import{d as N,a as i,T as Pe,r as _,p as U,G as Se,D as Oe,s as Ve,E as Ie,q as Te,u as $e,w as ze,c as R,b as m,i as E,e as k,F as Z,h as q,g as Be,x as F,l as Re,t as A,j as I,_ as Ee}from"./index-DZ_urxbV.js";import{u as Ae}from"./use-id-CwjrKIfK.js";import"./use-tab-status-DgQygf_o.js";const[De,J]=H("tag"),Me={size:String,mark:Boolean,show:B,type:Q("default"),color:String,plain:Boolean,round:Boolean,textColor:String,closeable:Boolean};var Ne=N({name:De,props:Me,emits:["close"],setup(t,{slots:a,emit:g}){const r=n=>{n.stopPropagation(),g("close",n)},l=()=>t.plain?{color:t.textColor||t.color,borderColor:t.color}:{color:t.textColor,background:t.color},p=()=>{var n;const{type:P,mark:u,plain:h,round:y,size:f,closeable:v}=t,C={mark:u,plain:h,round:y};f&&(C[f]=f);const x=v&&i(j,{name:"cross",class:[J("close"),X],onClick:r},null);return i("span",{style:l(),class:J([C,P])},[(n=a.default)==null?void 0:n.call(a),x])};return()=>i(Pe,{name:t.closeable?"van-fade":void 0},{default:()=>[t.show?p():null]})}});const Le=G(Ne),[oe,D]=H("dropdown-menu"),We={overlay:B,zIndex:K,duration:se(.2),direction:Q("down"),activeColor:String,autoLocate:Boolean,closeOnClickOutside:B,closeOnClickOverlay:B,swipeThreshold:K},ae=Symbol(oe);var Ue=N({name:oe,props:We,setup(t,{slots:a}){const g=Ae(),r=_(),l=_(),p=_(0),{children:n,linkChildren:P}=le(ae),u=ie(r),h=U(()=>n.some(e=>e.state.showWrapper)),y=U(()=>t.swipeThreshold&&n.length>+t.swipeThreshold),f=U(()=>{if(h.value&&ce(t.zIndex))return{zIndex:+t.zIndex+1}}),v=()=>{n.forEach(e=>{e.toggle(!1)})},C=()=>{t.closeOnClickOutside&&v()},x=()=>{if(l.value){const e=te(l);t.direction==="down"?p.value=e.bottom:p.value=de.value-e.top}},T=()=>{h.value&&x()},O=e=>{n.forEach((o,s)=>{s===e?o.toggle():o.state.showPopup&&o.toggle(!1,{immediate:!0})})},V=(e,o)=>{const{showPopup:s}=e.state,{disabled:d,titleClass:b}=e;return i("div",{id:`${g}-${o}`,role:"button",tabindex:d?void 0:0,"data-allow-mismatch":"attribute",class:[D("item",{disabled:d,grow:y.value}),{[X]:!d}],onClick:()=>{d||O(o)}},[i("span",{class:[D("title",{down:s===(t.direction==="down"),active:s}),b],style:{color:s?t.activeColor:""}},[i("div",{class:"van-ellipsis"},[e.renderTitle()])])])};return ee({close:v}),P({id:g,props:t,offset:p,updateOffset:x}),re(r,C),ue("scroll",T,{target:u,passive:!0}),()=>{var e;return i("div",{ref:r,class:D()},[i("div",{ref:l,style:f.value,class:D("bar",{opened:h.value,scrollable:y.value})},[n.map(V)]),(e=a.default)==null?void 0:e.call(a)])}}});const[Fe,M]=H("dropdown-item"),He={title:String,options:me(),disabled:Boolean,teleport:[String,Object],lazyRender:B,modelValue:Y,titleClass:Y};var je=N({name:Fe,inheritAttrs:!1,props:He,emits:["open","opened","close","closed","change","update:modelValue"],setup(t,{emit:a,slots:g,attrs:r}){const l=Se({showPopup:!1,transition:!0,showWrapper:!1}),p=_(),{parent:n,index:P}=pe(ae);if(!n)return;const u=e=>()=>a(e),h=u("open"),y=u("close"),f=u("opened"),v=()=>{l.showWrapper=!1,a("closed")},C=e=>{t.teleport&&e.stopPropagation()},x=(e=!l.showPopup,o={})=>{e!==l.showPopup&&(l.showPopup=e,l.transition=!o.immediate,e&&(n.updateOffset(),l.showWrapper=!0))},T=()=>{if(g.title)return g.title();if(t.title)return t.title;const e=t.options.find(o=>o.value===t.modelValue);return e?e.text:""},O=e=>{const{activeColor:o}=n.props,{disabled:s}=e,d=e.value===t.modelValue,b=()=>{s||(l.showPopup=!1,e.value!==t.modelValue&&(a("update:modelValue",e.value),a("change",e.value)))},S=()=>{if(d)return i(j,{class:M("icon"),color:s?void 0:o,name:"success"},null)};return i(be,{role:"menuitem",key:String(e.value),icon:e.icon,title:e.text,class:M("option",{active:d,disabled:s}),style:{color:d?o:""},tabindex:d?0:-1,clickable:!s,onClick:b},{value:S})},V=()=>{const{offset:e}=n,{autoLocate:o,zIndex:s,overlay:d,duration:b,direction:S,closeOnClickOverlay:L}=n.props,$=fe(s);let z=e.value;if(o&&p.value){const w=ve(p.value);w&&(z-=te(w).top)}return S==="down"?$.top=`${z}px`:$.bottom=`${z}px`,Ve(i("div",Te({ref:p,style:$,class:M([S]),onClick:C},r),[i(ge,{show:l.showPopup,"onUpdate:show":w=>l.showPopup=w,role:"menu",class:M("content"),overlay:d,position:S==="down"?"top":"bottom",duration:l.transition?b:0,lazyRender:t.lazyRender,overlayStyle:{position:"absolute"},"aria-labelledby":`${n.id}-${P.value}`,"data-allow-mismatch":"attribute",closeOnClickOverlay:L,onOpen:h,onClose:y,onOpened:f,onClosed:v},{default:()=>{var w;return[t.options.map(O),(w=g.default)==null?void 0:w.call(g)]}})]),[[Ie,l.showWrapper]])};return ee({state:l,toggle:x,renderTitle:T}),()=>t.teleport?i(Oe,{to:t.teleport},{default:()=>[V()]}):V()}});const Ge=G(je),Ke=G(Ue),Ye={class:"page"},Ze={class:"filter-section"},qe={class:"message-list"},Je={class:"p-3 h-full"},Qe=["onClick"],Xe={class:"text-10"},et={class:"message-time"},tt={key:0,class:"unread-dot"},ot={class:"message-item-content"},at={class:"message-icon-wrapper"},nt={class:"message-body"},st={class:"message-title"},lt={class:"message-text"},it=N({__name:"notification",setup(t){const{t:a}=$e(),g=ke(),r=_({page:0,pageSize:10}),l=_(!1),p=_(!1),n=_([]),P=async()=>{p.value||(l.value=!0,r.value.page++,await W(r.value,f.value,v.value).then(o=>{n.value.push(...o.data.list),r.value.page>=o.data.total_page&&(p.value=!0),l.value=!1}).catch(()=>{l.value=!1}))},u=_(!1),h=async()=>{r.value.page=1,await W(r.value,f.value,v.value).then(o=>{n.value=o.data.list,u.value=!1}).catch(()=>{u.value=!1})},y=o=>{o.read_time==0&&(he(o.id),n.value=n.value.map(s=>(s.id==o.id&&(s.read_time=1),s))),we({title:o.title,message:o.content}).then(()=>{})},f=_(0),v=_(0);ze([f,v],async([o,s])=>{r.value.page=1,n.value=[],u.value=!0,await W(r.value,o,s).then(d=>{n.value=d.data.list,u.value=!1}).catch(()=>{u.value=!1})});const C=[{text:a("notification.allMessages"),value:0},{text:a("notification.systemAnnouncement"),value:1},{text:a("notification.systemMaintenance"),value:2},{text:a("notification.activityNotification"),value:3}],x=[{text:a("notification.allStatus"),value:0},{text:a("notification.unreadMessages"),value:1},{text:a("notification.readMessages"),value:2}],T={1:a("notification.systemAnnouncement"),2:a("notification.systemMaintenance"),3:a("notification.activityNotification")},O={1:"icon-blue",2:"icon-orange",3:"icon-red"},V={1:"primary",2:"warning",3:"danger"},e={1:"volume-o",2:"setting-o",3:"gift-o"};return(o,s)=>{const d=_e,b=Ge,S=Ke,L=xe,$=Le,z=j,w=Ce,ne=ye;return I(),R(Z,null,[i(d),m("div",Ye,[m("div",Ze,[i(S,{"swipe-threshold":"2"},{default:E(()=>[i(b,{modelValue:f.value,"onUpdate:modelValue":s[0]||(s[0]=c=>f.value=c),options:C},null,8,["modelValue"]),i(b,{modelValue:v.value,"onUpdate:modelValue":s[1]||(s[1]=c=>v.value=c),options:x},null,8,["modelValue"])]),_:1})]),m("div",qe,[i(ne,{modelValue:u.value,"onUpdate:modelValue":s[3]||(s[3]=c=>u.value=c),onRefresh:h,"pulling-text":k(a)("common.pullDownRefresh"),"loosing-text":k(a)("common.releaseRefresh"),"loading-text":k(a)("common.loading")},{default:E(()=>[n.value?(I(),q(w,{key:1,loading:l.value,"onUpdate:loading":s[2]||(s[2]=c=>l.value=c),finished:p.value,"finished-text":k(a)("common.noMore"),"loading-text":k(a)("common.loading"),"error-text":k(a)("common.fail"),onLoad:P},{default:E(()=>[m("div",Je,[(I(!0),R(Z,null,Be(n.value,c=>(I(),R("div",{class:"message-item type-system_announcement",onClick:ct=>y(c)},[m("div",{class:F(["message-item-header",c.read_time==0?"unread":""])},[m("div",{class:F(["message-type-indicator",O[c.type]])},null,2),i($,{type:V[c.type]},{default:E(()=>[m("span",Xe,A(T[c.type]),1)]),_:2},1032,["type"]),m("span",et,A(k(g).timeAgo(c.create_time)),1),c.read_time==0?(I(),R("div",tt)):Re("",!0)],2),m("div",ot,[m("div",at,[m("div",{class:F(["message-icon",O[c.type]])},[i(z,{name:e[c.type],size:"1.125rem"},null,8,["name"])],2)]),m("div",nt,[m("h3",st,A(c.title),1),m("p",lt,A(c.content),1)])])],8,Qe))),256))])]),_:1},8,["loading","finished","finished-text","loading-text","error-text"])):(I(),q(L,{key:0,description:k(a)("notification.noMessages")},null,8,["description"]))]),_:1},8,["modelValue","pulling-text","loosing-text","loading-text"])])])],64)}}}),_t=Ee(it,[["__scopeId","data-v-a7bcad2c"]]);export{_t as default};
