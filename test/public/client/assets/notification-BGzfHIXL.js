import{G as J,t as z,e as F,T as Q,I as H,w as j,n as G,R as ae,Y as se,Z as ne,H as le,j as X,S as ie,$ as re,a0 as ee,a1 as ce,u as K,a2 as ue,i as de,V as pe,a3 as me,P as ve,_ as fe,a4 as ge,a5 as _e,a6 as W}from"./CpNavBar-C6kWJ5zi.js";import{P as he,L as we}from"./index-yUXsrzyI.js";import{E as ye}from"./index-CMATy_yw.js";import{C as Ce}from"./index-DxvPpL6i.js";import{a as xe}from"./common-6_y_QWEd.js";import{u as be}from"./use-id-CaLom9W9.js";import{d as L,a as n,T as ke,r as _,n as U,G as Pe,D as Oe,s as Se,E as Ve,p as Ie,w as Te,c as B,b as d,h as E,F as Y,g as Z,f as $e,x as M,k as ze,t as R,u as Be,i as V,_ as Ee}from"./index-CjmkDDmm.js";import"./use-tab-status-CDHW3uOn.js";const[Re,q]=F("tag"),De={size:String,mark:Boolean,show:z,type:J("default"),color:String,plain:Boolean,round:Boolean,textColor:String,closeable:Boolean};var Ae=L({name:Re,props:De,emits:["close"],setup(t,{slots:f,emit:r}){const p=s=>{s.stopPropagation(),r("close",s)},a=()=>t.plain?{color:t.textColor||t.color,borderColor:t.color}:{color:t.textColor,background:t.color},i=()=>{var s;const{type:m,mark:h,plain:w,round:g,size:v,closeable:C}=t,x={mark:h,plain:w,round:g};v&&(x[v]=v);const b=C&&n(H,{name:"cross",class:[q("close"),Q],onClick:p},null);return n("span",{style:a(),class:q([x,m])},[(s=f.default)==null?void 0:s.call(f),b])};return()=>n(ke,{name:t.closeable?"van-fade":void 0},{default:()=>[t.show?i():null]})}});const Le=j(Ae),[te,D]=F("dropdown-menu"),Ne={overlay:z,zIndex:G,duration:ae(.2),direction:J("down"),activeColor:String,autoLocate:Boolean,closeOnClickOutside:z,closeOnClickOverlay:z,swipeThreshold:G},oe=Symbol(te);var We=L({name:te,props:Ne,setup(t,{slots:f}){const r=be(),p=_(),a=_(),i=_(0),{children:s,linkChildren:m}=se(oe),h=ne(p),w=U(()=>s.some(e=>e.state.showWrapper)),g=U(()=>t.swipeThreshold&&s.length>+t.swipeThreshold),v=U(()=>{if(w.value&&le(t.zIndex))return{zIndex:+t.zIndex+1}}),C=()=>{s.forEach(e=>{e.toggle(!1)})},x=()=>{t.closeOnClickOutside&&C()},b=()=>{if(a.value){const e=ee(a);t.direction==="down"?i.value=e.bottom:i.value=ce.value-e.top}},O=()=>{w.value&&b()},I=e=>{s.forEach((o,c)=>{c===e?o.toggle():o.state.showPopup&&o.toggle(!1,{immediate:!0})})},S=(e,o)=>{const{showPopup:c}=e.state,{disabled:u,titleClass:k}=e;return n("div",{id:`${r}-${o}`,role:"button",tabindex:u?void 0:0,"data-allow-mismatch":"attribute",class:[D("item",{disabled:u,grow:g.value}),{[Q]:!u}],onClick:()=>{u||I(o)}},[n("span",{class:[D("title",{down:c===(t.direction==="down"),active:c}),k],style:{color:c?t.activeColor:""}},[n("div",{class:"van-ellipsis"},[e.renderTitle()])])])};return X({close:C}),m({id:r,props:t,offset:i,updateOffset:b}),ie(p,x),re("scroll",O,{target:h,passive:!0}),()=>{var e;return n("div",{ref:p,class:D()},[n("div",{ref:a,style:v.value,class:D("bar",{opened:w.value,scrollable:g.value})},[s.map(S)]),(e=f.default)==null?void 0:e.call(f)])}}});const[Ue,A]=F("dropdown-item"),Me={title:String,options:ue(),disabled:Boolean,teleport:[String,Object],lazyRender:z,modelValue:K,titleClass:K};var Fe=L({name:Ue,inheritAttrs:!1,props:Me,emits:["open","opened","close","closed","change","update:modelValue"],setup(t,{emit:f,slots:r,attrs:p}){const a=Pe({showPopup:!1,transition:!0,showWrapper:!1}),i=_(),{parent:s,index:m}=de(oe);if(!s)return;const h=e=>()=>f(e),w=h("open"),g=h("close"),v=h("opened"),C=()=>{a.showWrapper=!1,f("closed")},x=e=>{t.teleport&&e.stopPropagation()},b=(e=!a.showPopup,o={})=>{e!==a.showPopup&&(a.showPopup=e,a.transition=!o.immediate,e&&(s.updateOffset(),a.showWrapper=!0))},O=()=>{if(r.title)return r.title();if(t.title)return t.title;const e=t.options.find(o=>o.value===t.modelValue);return e?e.text:""},I=e=>{const{activeColor:o}=s.props,{disabled:c}=e,u=e.value===t.modelValue,k=()=>{c||(a.showPopup=!1,e.value!==t.modelValue&&(f("update:modelValue",e.value),f("change",e.value)))},P=()=>{if(u)return n(H,{class:A("icon"),color:c?void 0:o,name:"success"},null)};return n(Ce,{role:"menuitem",key:String(e.value),icon:e.icon,title:e.text,class:A("option",{active:u,disabled:c}),style:{color:u?o:""},tabindex:u?0:-1,clickable:!c,onClick:k},{value:P})},S=()=>{const{offset:e}=s,{autoLocate:o,zIndex:c,overlay:u,duration:k,direction:P,closeOnClickOverlay:N}=s.props,T=pe(c);let $=e.value;if(o&&i.value){const y=me(i.value);y&&($-=ee(y).top)}return P==="down"?T.top=`${$}px`:T.bottom=`${$}px`,Se(n("div",Ie({ref:i,style:T,class:A([P]),onClick:x},p),[n(ve,{show:a.showPopup,"onUpdate:show":y=>a.showPopup=y,role:"menu",class:A("content"),overlay:u,position:P==="down"?"top":"bottom",duration:a.transition?k:0,lazyRender:t.lazyRender,overlayStyle:{position:"absolute"},"aria-labelledby":`${s.id}-${m.value}`,"data-allow-mismatch":"attribute",closeOnClickOverlay:N,onOpen:w,onClose:g,onOpened:v,onClosed:C},{default:()=>{var y;return[t.options.map(I),(y=r.default)==null?void 0:y.call(r)]}})]),[[Ve,a.showWrapper]])};return X({state:a,toggle:b,renderTitle:O}),()=>t.teleport?n(Oe,{to:t.teleport},{default:()=>[S()]}):S()}});const He=j(Fe),je=j(We),Ge={class:"page"},Ke={class:"filter-section"},Ye={class:"message-list"},Ze={class:"p-3 h-full"},qe=["onClick"],Je={class:"text-10"},Qe={class:"message-time"},Xe={key:0,class:"unread-dot"},et={class:"message-item-content"},tt={class:"message-icon-wrapper"},ot={class:"message-body"},at={class:"message-title"},st={class:"message-text"},nt=L({__name:"notification",setup(t){const f=xe(),r=_({page:0,pageSize:10}),p=_(!1),a=_(!1),i=_([]),s=async()=>{a.value||(p.value=!0,r.value.page++,await W(r.value,g.value,v.value).then(e=>{i.value.push(...e.data.list),r.value.page>=e.data.total_page&&(a.value=!0),p.value=!1}).catch(()=>{p.value=!1}))},m=_(!1),h=async()=>{r.value.page=1,await W(r.value,g.value,v.value).then(e=>{i.value=e.data.list,m.value=!1}).catch(()=>{m.value=!1})},w=e=>{e.read_time==0&&(ge(e.id),i.value=i.value.map(o=>(o.id==e.id&&(o.read_time=1),o))),_e({title:e.title,message:e.content}).then(()=>{})},g=_(0),v=_(0);Te([g,v],async([e,o])=>{r.value.page=1,i.value=[],m.value=!0,await W(r.value,e,o).then(c=>{i.value=c.data.list,m.value=!1}).catch(()=>{m.value=!1})});const C=[{text:"全部消息",value:0},{text:"系统公告",value:1},{text:"系统维护",value:2},{text:"活动通知",value:3}],x=[{text:"全部状态",value:0},{text:"未读消息",value:1},{text:"已读消息",value:2}],b={1:"系统公告",2:"系统维护",3:"活动通知"},O={1:"icon-blue",2:"icon-orange",3:"icon-red"},I={1:"primary",2:"warning",3:"danger"},S={1:"volume-o",2:"setting-o",3:"gift-o"};return(e,o)=>{const c=fe,u=He,k=je,P=ye,N=Le,T=H,$=we,y=he;return V(),B(Y,null,[n(c),d("div",Ge,[d("div",Ke,[n(k,{"swipe-threshold":"2"},{default:E(()=>[n(u,{modelValue:g.value,"onUpdate:modelValue":o[0]||(o[0]=l=>g.value=l),options:C},null,8,["modelValue"]),n(u,{modelValue:v.value,"onUpdate:modelValue":o[1]||(o[1]=l=>v.value=l),options:x},null,8,["modelValue"])]),_:1})]),d("div",Ye,[n(y,{modelValue:m.value,"onUpdate:modelValue":o[3]||(o[3]=l=>m.value=l),onRefresh:h,"pulling-text":"Pull down to refresh...","loosing-text":"Release to refresh...","loading-text":"loading..."},{default:E(()=>[i.value?(V(),Z($,{key:1,loading:p.value,"onUpdate:loading":o[2]||(o[2]=l=>p.value=l),finished:a.value,"finished-text":"no more","loading-text":"loading...","error-text":"fail",onLoad:s},{default:E(()=>[d("div",Ze,[(V(!0),B(Y,null,$e(i.value,l=>(V(),B("div",{class:"message-item type-system_announcement",onClick:lt=>w(l)},[d("div",{class:M(["message-item-header",l.read_time==0?"unread":""])},[d("div",{class:M(["message-type-indicator",O[l.type]])},null,2),n(N,{type:I[l.type]},{default:E(()=>[d("span",Je,R(b[l.type]),1)]),_:2},1032,["type"]),d("span",Qe,R(Be(f).timeAgo(l.create_time)),1),l.read_time==0?(V(),B("div",Xe)):ze("",!0)],2),d("div",et,[d("div",tt,[d("div",{class:M(["message-icon",O[l.type]])},[n(T,{name:S[l.type],size:"1.125rem"},null,8,["name"])],2)]),d("div",ot,[d("h3",at,R(l.title),1),d("p",st,R(l.content),1)])])],8,qe))),256))])]),_:1},8,["loading","finished"])):(V(),Z(P,{key:0,description:"暂无消息"}))]),_:1},8,["modelValue"])])])],64)}}}),ft=Ee(nt,[["__scopeId","data-v-e640b424"]]);export{ft as default};
