import{d as N,l as Q,t as z,g as H,f as i,aC as le,H as X,I as K,J as j,n as J,o as ie,a as _,aI as ce,aJ as re,c as L,N as ue,e as ee,aB as de,b as me,j as te,y as pe,q as Y,s as fe,r as ve,al as _e,aD as ge,aF as he,aK as ye,S as we,T as Ce,P as be,A as ke,V as xe,w as Pe,W as T,Y as m,$ as A,Z,a3 as q,a1 as W,_ as Se,a4 as U,ad as Oe,a0 as M,aL as Ve,aa as O,aM as F,af as Ie}from"./index-CW24Rrz8.js";import{P as Be,L as $e}from"./index-BBUYrgRD.js";import{E as ze}from"./index-CPnfmbyq.js";import{C as Te}from"./index-B90dZW2P.js";import{_ as Ae,s as Me}from"./CpNavBar-CJHi_sXB.js";import{a as Re}from"./common-BcFkYjCN.js";import{u as Ee}from"./use-id-DPpD5rJm.js";import"./use-tab-status-CltZDvE3.js";const[Ne,G]=H("tag"),De={size:String,mark:Boolean,show:z,type:Q("default"),color:String,plain:Boolean,round:Boolean,textColor:String,closeable:Boolean};var Le=N({name:Ne,props:De,emits:["close"],setup(t,{slots:l,emit:g}){const u=a=>{a.stopPropagation(),g("close",a)},s=()=>t.plain?{color:t.textColor||t.color,borderColor:t.color}:{color:t.textColor,background:t.color},p=()=>{var a;const{type:P,mark:d,plain:h,round:y,size:w,closeable:f}=t,v={mark:d,plain:h,round:y};w&&(v[w]=w);const k=f&&i(K,{name:"cross",class:[G("close"),X],onClick:u},null);return i("span",{style:s(),class:G([v,P])},[(a=l.default)==null?void 0:a.call(l),k])};return()=>i(le,{name:t.closeable?"van-fade":void 0},{default:()=>[t.show?p():null]})}});const We=j(Le),[ae,R]=H("dropdown-menu"),Ue={overlay:z,zIndex:J,duration:ie(.2),direction:Q("down"),activeColor:String,autoLocate:Boolean,closeOnClickOutside:z,closeOnClickOverlay:z,swipeThreshold:J},oe=Symbol(ae);var Fe=N({name:ae,props:Ue,setup(t,{slots:l}){const g=Ee(),u=_(),s=_(),p=_(0),{children:a,linkChildren:P}=ce(oe),d=re(u),h=L(()=>a.some(e=>e.state.showWrapper)),y=L(()=>t.swipeThreshold&&a.length>+t.swipeThreshold),w=L(()=>{if(h.value&&ue(t.zIndex))return{zIndex:+t.zIndex+1}}),f=()=>{a.forEach(e=>{e.toggle(!1)})},v=()=>{t.closeOnClickOutside&&f()},k=()=>{if(s.value){const e=te(s);t.direction==="down"?p.value=e.bottom:p.value=pe.value-e.top}},V=()=>{h.value&&k()},I=e=>{a.forEach((r,o)=>{o===e?r.toggle():r.state.showPopup&&r.toggle(!1,{immediate:!0})})},S=(e,r)=>{const{showPopup:o}=e.state,{disabled:n,titleClass:C}=e;return i("div",{id:`${g}-${r}`,role:"button",tabindex:n?void 0:0,"data-allow-mismatch":"attribute",class:[R("item",{disabled:n,grow:y.value}),{[X]:!n}],onClick:()=>{n||I(r)}},[i("span",{class:[R("title",{down:o===(t.direction==="down"),active:o}),C],style:{color:o?t.activeColor:""}},[i("div",{class:"van-ellipsis"},[e.renderTitle()])])])};return ee({close:f}),P({id:g,props:t,offset:p,updateOffset:k}),de(u,v),me("scroll",V,{target:d,passive:!0}),()=>{var e;return i("div",{ref:u,class:R()},[i("div",{ref:s,style:w.value,class:R("bar",{opened:h.value,scrollable:y.value})},[a.map(S)]),(e=l.default)==null?void 0:e.call(l)])}}});const[He,E]=H("dropdown-item"),Ke={title:String,options:fe(),disabled:Boolean,teleport:[String,Object],lazyRender:z,modelValue:Y,titleClass:Y};var je=N({name:He,inheritAttrs:!1,props:Ke,emits:["open","opened","close","closed","change","update:modelValue"],setup(t,{emit:l,slots:g,attrs:u}){const s=ve({showPopup:!1,transition:!0,showWrapper:!1}),p=_(),{parent:a,index:P}=_e(oe);if(!a)return;const d=e=>()=>l(e),h=d("open"),y=d("close"),w=d("opened"),f=()=>{s.showWrapper=!1,l("closed")},v=e=>{t.teleport&&e.stopPropagation()},k=(e=!s.showPopup,r={})=>{e!==s.showPopup&&(s.showPopup=e,s.transition=!r.immediate,e&&(a.updateOffset(),s.showWrapper=!0))},V=()=>{if(g.title)return g.title();if(t.title)return t.title;const e=t.options.find(r=>r.value===t.modelValue);return e?e.text:""},I=e=>{const{activeColor:r}=a.props,{disabled:o}=e,n=e.value===t.modelValue,C=()=>{o||(s.showPopup=!1,e.value!==t.modelValue&&(l("update:modelValue",e.value),l("change",e.value)))},x=()=>{if(n)return i(K,{class:E("icon"),color:o?void 0:r,name:"success"},null)};return i(Te,{role:"menuitem",key:String(e.value),icon:e.icon,title:e.text,class:E("option",{active:n,disabled:o}),style:{color:n?r:""},tabindex:n?0:-1,clickable:!o,onClick:C},{value:x})},S=()=>{const{offset:e}=a,{autoLocate:r,zIndex:o,overlay:n,duration:C,direction:x,closeOnClickOverlay:D}=a.props,B=he(o);let $=e.value;if(r&&p.value){const b=ye(p.value);b&&($-=te(b).top)}return x==="down"?B.top=`${$}px`:B.bottom=`${$}px`,we(i("div",ke({ref:p,style:B,class:E([x]),onClick:v},u),[i(be,{show:s.showPopup,"onUpdate:show":b=>s.showPopup=b,role:"menu",class:E("content"),overlay:n,position:x==="down"?"top":"bottom",duration:s.transition?C:0,lazyRender:t.lazyRender,overlayStyle:{position:"absolute"},"aria-labelledby":`${a.id}-${P.value}`,"data-allow-mismatch":"attribute",closeOnClickOverlay:D,onOpen:h,onClose:y,onOpened:w,onClosed:f},{default:()=>{var b;return[t.options.map(I),(b=g.default)==null?void 0:b.call(g)]}})]),[[Ce,s.showWrapper]])};return ee({state:s,toggle:k,renderTitle:V}),()=>t.teleport?i(ge,{to:t.teleport},{default:()=>[S()]}):S()}});const Je=j(je),Ye=j(Fe),Ze={class:"page"},qe={class:"filter-section"},Ge={class:"message-list"},Qe={class:"p-3 h-full"},Xe=["onClick"],et={class:"text-10"},tt={class:"message-time"},at={key:0,class:"unread-dot"},ot={class:"message-item-content"},nt={class:"message-icon-wrapper"},st={class:"message-body"},lt={class:"message-title"},it={class:"message-text"},ct=N({__name:"notification",setup(t){const{t:l}=xe(),g=Re(),u=_({page:0,pageSize:10}),s=_(!1),p=_(!1),a=_([]),P=async()=>{p.value||(s.value=!0,u.value.page++,await F(u.value,f.value,v.value).then(o=>{a.value.push(...o.data.list),u.value.page>=o.data.total_page&&(p.value=!0),s.value=!1}).catch(()=>{s.value=!1}))},d=_(!1),h=async()=>{u.value.page=1,await F(u.value,f.value,v.value).then(o=>{a.value=o.data.list,d.value=!1}).catch(()=>{d.value=!1})},y=_(null),w=o=>{o.read_time==0&&(Ve(o.id),a.value=a.value.map(n=>(n.id==o.id&&(n.read_time=1,y.value.fetchUnreadCount()),n))),Me({title:o.title,message:o.content}).then(()=>{})},f=_(0),v=_(0);Pe([f,v],async([o,n])=>{u.value.page=1,a.value=[],d.value=!0,await F(u.value,o,n).then(C=>{a.value=C.data.list,d.value=!1}).catch(()=>{d.value=!1})});const k=[{text:l("notification.allMessages"),value:0},{text:l("notification.systemAnnouncement"),value:1},{text:l("notification.systemMaintenance"),value:2},{text:l("notification.activityNotification"),value:3}],V=[{text:l("notification.allStatus"),value:0},{text:l("notification.unreadMessages"),value:1},{text:l("notification.readMessages"),value:2}],I={1:l("notification.systemAnnouncement"),2:l("notification.systemMaintenance"),3:l("notification.activityNotification")},S={1:"icon-blue",2:"icon-orange",3:"icon-red"},e={1:"primary",2:"warning",3:"danger"},r={1:"volume-o",2:"setting-o",3:"gift-o"};return(o,n)=>{const C=Ae,x=Je,D=Ye,B=ze,$=We,b=K,ne=$e,se=Be;return O(),T(Z,null,[i(C,{ref_key:"childRef",ref:y},null,512),m("div",Ze,[m("div",qe,[i(D,{"swipe-threshold":"2"},{default:A(()=>[i(x,{modelValue:f.value,"onUpdate:modelValue":n[0]||(n[0]=c=>f.value=c),options:k},null,8,["modelValue"]),i(x,{modelValue:v.value,"onUpdate:modelValue":n[1]||(n[1]=c=>v.value=c),options:V},null,8,["modelValue"])]),_:1})]),m("div",Ge,[i(se,{modelValue:d.value,"onUpdate:modelValue":n[3]||(n[3]=c=>d.value=c),onRefresh:h},{default:A(()=>[a.value?(O(),q(ne,{key:1,loading:s.value,"onUpdate:loading":n[2]||(n[2]=c=>s.value=c),finished:p.value,onLoad:P,"finished-text":W(l)("common.noMore")},{default:A(()=>[m("div",Qe,[(O(!0),T(Z,null,Se(a.value,c=>(O(),T("div",{class:"message-item type-system_announcement",onClick:rt=>w(c)},[m("div",{class:U(["message-item-header",c.read_time==0?"unread":""])},[m("div",{class:U(["message-type-indicator",S[c.type]])},null,2),i($,{type:e[c.type]},{default:A(()=>[m("span",et,M(I[c.type]),1)]),_:2},1032,["type"]),m("span",tt,M(W(g).timeAgo(c.create_time)),1),c.read_time==0?(O(),T("div",at)):Oe("",!0)],2),m("div",ot,[m("div",nt,[m("div",{class:U(["message-icon",S[c.type]])},[i(b,{name:r[c.type],size:"1.125rem"},null,8,["name"])],2)]),m("div",st,[m("h3",lt,M(c.title),1),m("p",it,M(c.content),1)])])],8,Xe))),256))])]),_:1},8,["loading","finished","finished-text"])):(O(),q(B,{key:0,description:W(l)("notification.noMessages")},null,8,["description"]))]),_:1},8,["modelValue"])])])],64)}}}),ht=Ie(ct,[["__scopeId","data-v-bca6c1d5"]]);export{ht as default};
