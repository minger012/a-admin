var D=Object.defineProperty,S=Object.defineProperties;var A=Object.getOwnPropertyDescriptors;var w=Object.getOwnPropertySymbols;var B=Object.prototype.hasOwnProperty,I=Object.prototype.propertyIsEnumerable;var T=(a,e,o)=>e in a?D(a,e,{enumerable:!0,configurable:!0,writable:!0,value:o}):a[e]=o,y=(a,e)=>{for(var o in e||(e={}))B.call(e,o)&&T(a,o,e[o]);if(w)for(var o of w(e))I.call(e,o)&&T(a,o,e[o]);return a},v=(a,e)=>S(a,A(e));var g=(a,e,o)=>new Promise((f,s)=>{var d=r=>{try{l(o.next(r))}catch(m){s(m)}},_=r=>{try{l(o.throw(r))}catch(m){s(m)}},l=r=>r.done?f(r.value):Promise.resolve(r.value).then(d,_);l((o=o.apply(a,e)).next())});import{B as E}from"./Table-B7zsuUw9.js";import{T as N}from"./TableAction-DB_awGjd.js";import{d as P,g as $}from"./admin-3ONY92Rh.js";import{g as j}from"./role-AAGbgIHL.js";import{f as q}from"./dateUtil-DeXksHIp.js";import L from"./AdminModal-DvmFBr0l.js";import{P as O}from"./PlusOutlined-DnK2ELqe.js";import{d as V,u as F,p as K,r as h,b as U,t as G,c as H,j as c,w as p,q as J,s as Q,o as W,h as k,i as X,N as Y,B as Z}from"./index-BEDOAs2M.js";import"./vuedraggable.umd-Dy6826IL.js";import"./useDesignSetting-OypQRMnc.js";import"./propTypes-C2D30ETy.js";import"./componentSetting-CQq0JJwW.js";import"./index-BWiplwgM.js";import"./DownOutlined-jyipYFFO.js";const ee=[{title:"管理员ID",key:"id"},{title:"账号",key:"username"},{title:"管理员角色",key:"auth_id",render(a){return a.role_name||`ID: ${a.auth_id}`}},{title:"创建时间",key:"create_time",width:160,render(a){return a.create_time?q(a.create_time*1e3):"-"}}],_e=V({__name:"index",setup(a){const e=F(),o=K(),f=h(),s=h(),d=h({}),_=U({width:200,title:"操作",key:"action",fixed:"right",render(t){return Q(N,{style:"button",actions:[{label:"编辑",onClick:x.bind(null,t)},{label:"删除",onClick:M.bind(null,t),type:"error",ifShow:()=>t.username!=="admin"}]})}});function l(){return g(this,null,function*(){try{const t=yield j({pageSize:100,page:1});if(t.code===1&&t.data.list){const i={};t.data.list.forEach(n=>{i[n.id]=n.name}),d.value=i}}catch(t){console.error("Failed to load roles:",t)}})}const r=t=>g(this,null,function*(){const i=y({pageSize:t.pageSize,page:t.page},t.searchInfo);try{const n=yield $(i);return Object.keys(d.value).length===0&&(yield l()),n.code===1?{list:(n.data.list||[]).map(u=>v(y({},u),{role_name:d.value[u.auth_id]||`未知角色 (ID: ${u.auth_id})`})),page:n.data.page,pageCount:n.data.total_page,pageSize:n.data.page_size,itemCount:n.data.total}:(e.error(n.msg||"获取管理员列表失败"),{list:[],page:1,pageCount:0,pageSize:10,itemCount:0})}catch(n){return e.error("获取管理员列表失败"),{list:[],page:1,pageCount:0,pageSize:10,itemCount:0}}});function m(){s.value.openAddModal()}function R(t){console.log(t)}function C(){f.value.reload()}function x(t){s.value.openEditModal(t)}function M(t){o.warning({title:"删除确认",content:`确定要删除管理员 "${t.username}" 吗？`,positiveText:"确定",negativeText:"取消",onPositiveClick:()=>g(this,null,function*(){try{e.loading("删除中...");const i=yield P(t.username);i.code===1?(e.success("删除成功"),C()):e.error(i.msg||"删除失败")}catch(i){e.error("删除失败: "+(i.message||"未知错误"))}})})}return G(()=>{l()}),(t,i)=>{const n=Y,b=Z,u=J;return W(),H("div",null,[c(u,{bordered:!1,class:"mt-4 proCard"},{default:p(()=>[c(k(E),{columns:k(ee),request:r,"row-key":z=>z.username,ref_key:"actionRef",ref:f,actionColumn:_,"onUpdate:checkedRowKeys":R},{tableTitle:p(()=>[c(b,{type:"primary",onClick:m},{icon:p(()=>[c(n,null,{default:p(()=>[c(k(O))]),_:1})]),default:p(()=>[i[0]||(i[0]=X(" 新增管理员 "))]),_:1})]),_:1},8,["columns","row-key","actionColumn"])]),_:1}),c(L,{ref_key:"adminModalRef",ref:s,onReloadTable:C},null,512)])}}});export{_e as default};
