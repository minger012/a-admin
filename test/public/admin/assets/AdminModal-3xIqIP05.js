var L=Object.defineProperty;var C=Object.getOwnPropertySymbols;var z=Object.prototype.hasOwnProperty,$=Object.prototype.propertyIsEnumerable;var N=(a,o,t)=>o in a?L(a,o,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[o]=t,B=(a,o)=>{for(var t in o||(o={}))z.call(o,t)&&N(a,t,o[t]);if(C)for(var t of C(o))$.call(o,t)&&N(a,t,o[t]);return a};var h=(a,o,t)=>new Promise((y,f)=>{var m=u=>{try{i(t.next(u))}catch(p){f(p)}},l=u=>{try{i(t.throw(u))}catch(p){f(p)}},i=u=>u.done?y(u.value):Promise.resolve(u.value).then(m,l);i((t=t.apply(a,o)).next())});import{A as w,d as D,u as I,r as v,b as G,O as P,o as H,x as J,w as r,j as d,i as T,by as K,a as Q,k as W,l as X,C as Y,_ as Z,B as ee,D as ae,E as te,n as ne}from"./index-FB6W5mBG.js";import{g as oe}from"./role-CrdDRdET.js";function me(a){return w.Post("/admin/admin/list",a,{meta:{isReturnNativeResponse:!0}})}function se(a){return w.Post("/admin/admin/add",a,{meta:{isReturnNativeResponse:!0}})}function le(a){return w.Post("/admin/admin/edit",a,{meta:{isReturnNativeResponse:!0}})}function _e(a){return w.Post("/admin/admin/del",{username:a},{meta:{isReturnNativeResponse:!0}})}const ue=D({__name:"AdminModal",emits:["reloadTable"],setup(a,{expose:o,emit:t}){const y=t,f=I(),m=v(!1),l=v("add"),i=v(),u=v(!1),p=v(!1),R=v([]),n=G({id:null,username:"",password:"",auth_id:null}),O=P(()=>l.value==="add"?"新增管理员":"编辑管理员"),S=P(()=>({username:{required:!0,trigger:["blur","input"],message:"请输入用户名"},password:{required:l.value==="add",trigger:["blur","input"],message:"请输入密码"},auth_id:{required:!0,trigger:["blur","change"],message:"请选择角色",type:"number"}}));function A(){return h(this,null,function*(){try{const s=yield oe({pageSize:100,page:1});s.code===1&&(R.value=s.data.list.map(e=>({label:e.name,value:e.id})))}catch(s){console.error("Failed to load role options:",s)}})}function U(){l.value="add",p.value=!1,M(),A(),m.value=!0}function V(s){l.value="edit",p.value=!0,M(),n.id=s.id,n.username=s.username,n.password="",n.auth_id=s.auth_id,A(),m.value=!0}function M(){n.id=null,n.username="",n.password="",n.auth_id=null,i.value&&i.value.restoreValidation()}function k(){m.value=!1}function j(){var s;(s=i.value)==null||s.validate(e=>h(this,null,function*(){if(!e){u.value=!0;try{const _=B({},n);l.value==="edit"&&!_.password&&delete _.password;const b=yield(l.value==="add"?se:le)(_);b.code===1?(f.success(l.value==="add"?"添加成功":"编辑成功"),k(),y("reloadTable")):f.error(b.msg||(l.value==="add"?"添加失败":"编辑失败"))}catch(_){f.error(l.value==="add"?"添加失败":"编辑失败")}finally{u.value=!1}}}))}return o({openAddModal:U,openEditModal:V}),(s,e)=>{const _=W,g=X,b=Y,q=Z,x=ee,E=ae,F=te;return H(),J(F,{show:m.value,"onUpdate:show":e[3]||(e[3]=c=>m.value=c),"show-icon":!1,preset:"dialog",title:O.value,"mask-closable":!1},{action:r(()=>[d(E,null,{default:r(()=>[d(x,{onClick:k},{default:r(()=>e[5]||(e[5]=[T("取消")])),_:1}),d(x,{type:"primary",loading:u.value,onClick:j},{default:r(()=>e[6]||(e[6]=[T("确定")])),_:1},8,["loading"])]),_:1})]),default:r(()=>[d(q,{model:n,rules:S.value,ref_key:"formRef",ref:i,"label-placement":"left","label-width":80,class:"py-4"},{default:r(()=>[d(g,{label:"用户名",path:"username"},{default:r(()=>[d(_,{placeholder:"请输入用户名",value:n.username,"onUpdate:value":e[0]||(e[0]=c=>n.username=c),disabled:p.value},null,8,["value","disabled"])]),_:1}),d(g,{label:"密码",path:"password"},K({default:r(()=>[d(_,{type:"password",placeholder:"编辑时可不填写密码",value:n.password,"onUpdate:value":e[1]||(e[1]=c=>n.password=c)},null,8,["value"])]),_:2},[p.value?{name:"help",fn:r(()=>[e[4]||(e[4]=Q("span",{class:"text-gray-400"},"不修改密码请留空",-1))]),key:"0"}:void 0]),1024),d(g,{label:"角色",path:"auth_id"},{default:r(()=>[d(b,{value:n.auth_id,"onUpdate:value":e[2]||(e[2]=c=>n.auth_id=c),options:R.value,placeholder:"请选择权限组"},null,8,["value","options"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["show","title"])}}}),re=ne(ue,[["__scopeId","data-v-804a1daf"]]),ce=Object.freeze(Object.defineProperty({__proto__:null,default:re},Symbol.toStringTag,{value:"Module"}));export{re as A,ce as a,_e as d,me as g};
