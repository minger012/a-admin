var re=Object.defineProperty;var q=Object.getOwnPropertySymbols;var le=Object.prototype.hasOwnProperty,ie=Object.prototype.propertyIsEnumerable;var A=(a,s,r)=>s in a?re(a,s,{enumerable:!0,configurable:!0,writable:!0,value:r}):a[s]=r,B=(a,s)=>{for(var r in s||(s={}))le.call(s,r)&&A(a,r,s[r]);if(q)for(var r of q(s))ie.call(s,r)&&A(a,r,s[r]);return a};var S=(a,s,r)=>new Promise((x,p)=>{var M=_=>{try{w(r.next(_))}catch(k){p(k)}},N=_=>{try{w(r.throw(_))}catch(k){p(k)}},w=_=>_.done?x(_.value):Promise.resolve(_.value).then(M,N);w((r=r.apply(a,s)).next())});import{B as de}from"./Table-B7zsuUw9.js";import{T as ue}from"./TableAction-DB_awGjd.js";import{_ as pe}from"./BasicForm-DYjcmFKt.js";import{u as me}from"./useForm-nNaFm5KP.js";import{s as g,B as W,v as ce,d as _e,u as fe,r as y,b as L,t as ge,a1 as we,c as P,j as n,w as o,X as he,q as ye,E as ke,o as R,h as b,N as be,i as f,y as C,z as U,x as ve,D as xe,a2 as De,a3 as Se,k as Re,l as Ce,F as Me,G as Ne,_ as Fe}from"./index-BEDOAs2M.js";import{g as K,w as Ie}from"./withdraw-BD3sTFoy.js";import{u as $,w as Ee}from"./xlsx-DaVhO591.js";import{D as Te}from"./DownloadOutlined-B_HUG7fM.js";import"./vuedraggable.umd-Dy6826IL.js";import"./useDesignSetting-OypQRMnc.js";import"./propTypes-C2D30ETy.js";import"./componentSetting-CQq0JJwW.js";import"./index-BWiplwgM.js";import"./DownOutlined-jyipYFFO.js";const Be={0:"待审核",1:"成功",2:"驳回"},Le={0:"warning",1:"success",2:"error"},Pe=[{label:"全部",value:""},{label:"待审核",value:0},{label:"成功",value:1},{label:"驳回",value:2}],Ue=[{type:"selection",fixed:"left"},{title:"ID",width:80,key:"id"},{title:"用户ID",width:100,key:"uid"},{title:"用户简称",width:120,key:"username"},{title:"FB_ID",width:180,key:"fb_id"},{title:"所属管理者",width:120,key:"admin_username",render(a){return g("span",{},{default:()=>a.admin_username||"-"})}},{title:"提现方式",width:100,key:"methods",render(a){return g(W,{text:!0,type:"primary",onClick:()=>{window.dispatchEvent(new CustomEvent("view-withdraw-method",{detail:a}))}},{default:()=>"查看"})}},{title:"涉及金额",width:120,key:"money",render(a){return g("span",{},{default:()=>a.money.toFixed(2)})}},{title:"后台备注",width:180,key:"remarks",ellipsis:{tooltip:!0},render(a){return g("span",{},{default:()=>a.remarks||"-"})}},{title:"用户端备注",width:180,key:"user_remarks",ellipsis:{tooltip:!0},render(a){return g("span",{},{default:()=>a.user_remarks||"-"})}},{title:"状态",width:80,key:"state",fixed:"right",render(a){return g(ce,{type:Le[a.state],bordered:!1},{default:()=>Be[a.state]})}},{title:"更新时间",key:"update_time",width:160,render(a){return g("span",{},{default:()=>a.update_time?new Date(a.update_time*1e3).toLocaleString():"-"})}},{title:"创建时间",key:"create_time",width:160,render(a){return g("span",{},{default:()=>new Date(a.create_time*1e3).toLocaleString()})}}],$e={key:0,class:"text-gray-500"},ze={key:0,class:"text-gray-500 text-xs ml-2"},tt=_e({__name:"index",setup(a){const s=fe(),r=y(),x=y(),p=y([]),M=[{field:"uid",component:"NInput",label:"用户ID",componentProps:{placeholder:"请输入用户ID"}},{field:"admin_username",component:"NInput",label:"管理员账号",componentProps:{placeholder:"请输入管理员账号"}},{field:"fb_id",component:"NInput",label:"FB_ID",componentProps:{placeholder:"请输入FB_ID"}},{field:"state",component:"NSelect",label:"状态",componentProps:{placeholder:"请选择状态",options:Pe}},{field:"dateRange",component:"NDatePicker",label:"创建时间",componentProps:{type:"datetimerange",clearable:!0,style:{width:"100%"}}}],[N]=me({gridProps:{cols:"1 s:1 m:2 l:3 xl:4 2xl:4"},labelWidth:100,schemas:M}),w=y({}),_={Crypto:"虚拟币"};function k(t){return _[t]||t}const F=y(!1),D=L({methods:"",currency:"",address:""}),v=y(!1),I=y(!1),i=L({id:0,remarks:"",user_remarks:"",state:1,originalState:0}),G={state:{required:!0,type:"number",message:"请选择状态",trigger:["blur","change"]}},X=L({width:100,title:"操作",key:"action",fixed:"right",render(t){return g(ue,{style:"button",actions:[{label:"编辑",type:"primary",onClick:Z.bind(null,t)}]})}});function H(c){return S(this,arguments,function*({page:t,pageSize:e}){const d=B({page:String(t),pageSize:String(e)},w.value);d.dateRange&&d.dateRange.length===2&&(d.sTime=Math.floor(d.dateRange[0]/1e3),d.eTime=Math.floor(d.dateRange[1]/1e3),delete d.dateRange);try{const m=(yield K(d)).data;return{list:m.list||[],page:Number(m.page)||1,pageCount:Number(m.total_page)||0,pageSize:Number(m.page_size)||10,itemCount:Number(m.total)||0}}catch(h){return s.error("获取提现列表失败"),{list:[],page:1,pageCount:0,pageSize:10,itemCount:0}}})}function J(t){w.value=t,E()}function Q(){w.value={},E()}function E(){r.value.reload()}function Y(t){Object.assign(D,{methods:t.methods,currency:t.currency,address:t.address}),F.value=!0}function Z(t){Object.assign(i,{id:t.id,remarks:t.remarks||"",user_remarks:t.user_remarks||"",state:t.state===0?1:t.state,originalState:t.state}),v.value=!0}function ee(){return S(this,null,function*(){var t;try{yield(t=x.value)==null?void 0:t.validate(),I.value=!0;const e={id:i.id,remarks:i.remarks,user_remarks:i.user_remarks};i.originalState===0&&(e.state=i.state);const c=yield Ie(e);c.code===1?(s.success("编辑成功"),v.value=!1,E()):s.error(c.msg||"编辑失败")}catch(e){console.error("编辑提现记录失败:",e),e!==void 0&&s.error("表单验证失败")}finally{I.value=!1}})}function te(){p.value=[]}function ae(){return S(this,null,function*(){let t=[];if(p.value.length>0)t=r.value.getDataSource().filter(c=>p.value.includes(c.id));else try{const e=B({page:"1",pageSize:"999999"},w.value);e.dateRange&&e.dateRange.length===2&&(e.sTime=Math.floor(e.dateRange[0]/1e3),e.eTime=Math.floor(e.dateRange[1]/1e3),delete e.dateRange),t=(yield K(e)).data.list||[]}catch(e){s.error("获取数据失败");return}if(t.length===0){s.warning("没有数据可导出");return}ne(t)})}function ne(t){const e={0:"待审核",1:"成功",2:"驳回"},c=t.map(l=>({ID:l.id,用户ID:l.uid,用户简称:l.username,FB_ID:l.fb_id,所属管理者:l.admin_username||"-",提现方式:k(l.methods),币种:l.currency,钱包地址:l.address,涉及金额:l.money.toFixed(2),后台备注:l.remarks||"-",用户端备注:l.user_remarks||"-",状态:e[l.state]||"-",更新时间:l.update_time?new Date(l.update_time*1e3).toLocaleString():"-",创建时间:new Date(l.create_time*1e3).toLocaleString()})),d=$.json_to_sheet(c),h=$.book_new();$.book_append_sheet(h,d,"提现列表");const m=`提现列表_${new Date().toLocaleDateString().replace(/\//g,"-")}.xlsx`;Ee(h,m),s.success(`导出成功，共 ${t.length} 条数据`)}const z=t=>{Y(t.detail)};return ge(()=>{window.addEventListener("view-withdraw-method",z)}),we(()=>{window.removeEventListener("view-withdraw-method",z)}),(t,e)=>{const c=ye,d=W,h=xe,m=De,l=Se,V=ke,j=Re,T=Ce,O=Me,oe=Ne,se=Fe;return R(),P(he,null,[n(c,{bordered:!1},{default:o(()=>[n(b(pe),{onRegister:b(N),onSubmit:J,onReset:Q},null,8,["onRegister"])]),_:1}),n(c,{bordered:!1,class:"mt-3"},{default:o(()=>[n(b(de),{columns:b(Ue),request:H,"row-key":u=>u.id,ref_key:"actionRef",ref:r,actionColumn:X,"checked-row-keys":p.value,"onUpdate:checkedRowKeys":e[0]||(e[0]=u=>p.value=u),"scroll-x":1700,striped:!0},{tableTitle:o(()=>[n(h,{class:"flex items-center"},{default:o(()=>[n(d,{onClick:ae},{icon:o(()=>[n(b(be),null,{default:o(()=>[n(b(Te))]),_:1})]),default:o(()=>[e[7]||(e[7]=f(" 导出 "))]),_:1}),p.value.length>0?(R(),P("span",$e," 已选 "+C(p.value.length)+" 项 ",1)):U("",!0),p.value.length>0?(R(),ve(d,{key:1,text:"",type:"primary",onClick:te},{default:o(()=>e[8]||(e[8]=[f(" 清除 ")])),_:1})):U("",!0)]),_:1})]),_:1},8,["columns","row-key","actionColumn","checked-row-keys"])]),_:1}),n(V,{show:F.value,"onUpdate:show":e[1]||(e[1]=u=>F.value=u),preset:"card",title:"提现方式详情",style:{width:"500px"}},{default:o(()=>[n(l,{bordered:"",column:1,"label-placement":"left","label-style":{width:"100px"}},{default:o(()=>[n(m,{label:"提现方式"},{default:o(()=>[f(C(k(D.methods)),1)]),_:1}),n(m,{label:"币种"},{default:o(()=>[f(C(D.currency),1)]),_:1}),n(m,{label:"钱包地址"},{default:o(()=>[f(C(D.address),1)]),_:1})]),_:1})]),_:1},8,["show"]),n(V,{show:v.value,"onUpdate:show":e[6]||(e[6]=u=>v.value=u),preset:"dialog",title:"编辑提现记录",style:{width:"600px"}},{action:o(()=>[n(h,null,{default:o(()=>[n(d,{onClick:e[5]||(e[5]=u=>v.value=!1)},{default:o(()=>e[11]||(e[11]=[f("取消")])),_:1}),n(d,{type:"primary",loading:I.value,onClick:ee},{default:o(()=>e[12]||(e[12]=[f("确定")])),_:1},8,["loading"])]),_:1})]),default:o(()=>[n(se,{model:i,rules:G,ref_key:"editFormRef",ref:x,"label-placement":"left","label-width":100,class:"py-4"},{default:o(()=>[n(T,{label:"后台备注",path:"remarks"},{default:o(()=>[n(j,{value:i.remarks,"onUpdate:value":e[2]||(e[2]=u=>i.remarks=u),type:"textarea",rows:3,placeholder:"请输入后台备注"},null,8,["value"])]),_:1}),n(T,{label:"用户端备注",path:"user_remarks"},{default:o(()=>[n(j,{value:i.user_remarks,"onUpdate:value":e[3]||(e[3]=u=>i.user_remarks=u),type:"textarea",rows:3,placeholder:"请输入用户端备注"},null,8,["value"])]),_:1}),n(T,{label:"状态",path:"state"},{default:o(()=>[n(oe,{value:i.state,"onUpdate:value":e[4]||(e[4]=u=>i.state=u),disabled:i.originalState!==0},{default:o(()=>[n(h,null,{default:o(()=>[n(O,{value:1},{default:o(()=>e[9]||(e[9]=[f("成功")])),_:1}),n(O,{value:2},{default:o(()=>e[10]||(e[10]=[f("驳回")])),_:1})]),_:1})]),_:1},8,["value","disabled"]),i.originalState!==0?(R(),P("div",ze," 只有待审核状态才可以修改 ")):U("",!0)]),_:1})]),_:1},8,["model"])]),_:1},8,["show"])],64)}}});export{tt as default};
