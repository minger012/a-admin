var S=Object.defineProperty;var B=Object.getOwnPropertySymbols;var j=Object.prototype.hasOwnProperty,D=Object.prototype.propertyIsEnumerable;var A=(u,l,a)=>l in u?S(u,l,{enumerable:!0,configurable:!0,writable:!0,value:a}):u[l]=a,T=(u,l)=>{for(var a in l||(l={}))j.call(l,a)&&A(u,a,l[a]);if(B)for(var a of B(l))D.call(l,a)&&A(u,a,l[a]);return u};var y=(u,l,a)=>new Promise((b,f)=>{var m=n=>{try{i(a.next(n))}catch(p){f(p)}},s=n=>{try{i(a.throw(n))}catch(p){f(p)}},i=n=>n.done?b(n.value):Promise.resolve(n.value).then(m,s);i((a=a.apply(u,l)).next())});import{a as I,e as P}from"./admin-52MHW-Du.js";import{g as $}from"./role-CZDppl4h.js";import{d as G,u as H,r as v,b as J,O as R,o as K,x as Q,w as r,j as d,i as U,bz as W,a as X,k as Y,l as Z,C as ee,_ as ae,B as oe,D as le,E as te,n as se}from"./index--W9FB2Si.js";const ne=G({__name:"AdminModal",emits:["reloadTable"],setup(u,{expose:l,emit:a}){const b=a,f=H(),m=v(!1),s=v("add"),i=v(),n=v(!1),p=v(!1),h=v([]),o=J({id:null,username:"",password:"",auth_id:null}),V=R(()=>s.value==="add"?"新增管理员":"编辑管理员"),q=R(()=>({username:{required:!0,trigger:["blur","input"],message:"请输入用户名"},password:{required:s.value==="add",trigger:["blur","input"],message:"请输入密码"},auth_id:{required:!0,trigger:["blur","change"],message:"请选择角色",type:"number"}}));function k(){return y(this,null,function*(){try{const t=yield $({pageSize:100,page:1});t.code===1&&(h.value=t.data.list.map(e=>({label:e.name,value:e.id})))}catch(t){console.error("Failed to load role options:",t)}})}function E(){s.value="add",p.value=!1,x(),k(),m.value=!0}function F(t){s.value="edit",p.value=!0,x(),o.id=t.id,o.username=t.username,o.password="",o.auth_id=t.auth_id,k(),m.value=!0}function x(){o.id=null,o.username="",o.password="",o.auth_id=null,i.value&&i.value.restoreValidation()}function C(){m.value=!1}function N(){var t;(t=i.value)==null||t.validate(e=>y(this,null,function*(){if(!e){n.value=!0;try{const _=T({},o);s.value==="edit"&&!_.password&&delete _.password;const w=yield(s.value==="add"?I:P)(_);w.code===1?(f.success(s.value==="add"?"添加成功":"编辑成功"),C(),b("reloadTable")):f.error(w.msg||(s.value==="add"?"添加失败":"编辑失败"))}catch(_){f.error(s.value==="add"?"添加失败":"编辑失败")}finally{n.value=!1}}}))}return l({openAddModal:E,openEditModal:F}),(t,e)=>{const _=Y,g=Z,w=ee,O=ae,M=oe,z=le,L=te;return K(),Q(L,{show:m.value,"onUpdate:show":e[3]||(e[3]=c=>m.value=c),"show-icon":!1,preset:"dialog",title:V.value,"mask-closable":!1},{action:r(()=>[d(z,null,{default:r(()=>[d(M,{onClick:C},{default:r(()=>e[5]||(e[5]=[U("取消")])),_:1}),d(M,{type:"primary",loading:n.value,onClick:N},{default:r(()=>e[6]||(e[6]=[U("确定")])),_:1},8,["loading"])]),_:1})]),default:r(()=>[d(O,{model:o,rules:q.value,ref_key:"formRef",ref:i,"label-placement":"left","label-width":80,class:"py-4"},{default:r(()=>[d(g,{label:"用户名",path:"username"},{default:r(()=>[d(_,{placeholder:"请输入用户名",value:o.username,"onUpdate:value":e[0]||(e[0]=c=>o.username=c),disabled:p.value},null,8,["value","disabled"])]),_:1}),d(g,{label:"密码",path:"password"},W({default:r(()=>[d(_,{type:"password",placeholder:"编辑时可不填写密码",value:o.password,"onUpdate:value":e[1]||(e[1]=c=>o.password=c)},null,8,["value"])]),_:2},[p.value?{name:"help",fn:r(()=>[e[4]||(e[4]=X("span",{class:"text-gray-400"},"不修改密码请留空",-1))]),key:"0"}:void 0]),1024),d(g,{label:"角色",path:"auth_id"},{default:r(()=>[d(w,{value:o.auth_id,"onUpdate:value":e[2]||(e[2]=c=>o.auth_id=c),options:h.value,placeholder:"请选择权限组"},null,8,["value","options"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["show","title"])}}}),pe=se(ne,[["__scopeId","data-v-804a1daf"]]);export{pe as default};
