var ke=Object.defineProperty;var q=Object.getOwnPropertySymbols;var De=Object.prototype.hasOwnProperty,Se=Object.prototype.propertyIsEnumerable;var G=(l,u,p)=>u in l?ke(l,u,{enumerable:!0,configurable:!0,writable:!0,value:p}):l[u]=p,B=(l,u)=>{for(var p in u||(u={}))De.call(u,p)&&G(l,p,u[p]);if(q)for(var p of q(u))Se.call(u,p)&&G(l,p,u[p]);return l};var L=(l,u,p)=>new Promise((c,D)=>{var x=v=>{try{y(p.next(v))}catch(_){D(_)}},T=v=>{try{y(p.throw(v))}catch(_){D(_)}},y=v=>v.done?c(v.value):Promise.resolve(v.value).then(x,T);y((p=p.apply(l,u)).next())});import{B as Ce}from"./Table-B7zsuUw9.js";import{T as he}from"./TableAction-DB_awGjd.js";import{_ as Ie}from"./BasicForm-DYjcmFKt.js";import{u as Re}from"./useForm-nNaFm5KP.js";import{d as X,r as C,s as k,H as K,I as Ue,l as Y,J as Ne,K as Te,L as $e,M as ze,v as V,u as Pe,p as Le,b as Q,O as Me,x as h,w as t,q as Oe,o as w,j as n,h as m,i as r,c as A,y as Be,z as S,a as W,Q as Ee,C as Ve,N as je,B as Fe,D as qe,S as Ge,k as Ke,F as Qe,G as Ae,T as We,U as He,V as Je,W as Xe,_ as Ye,E as Ze}from"./index-BEDOAs2M.js";import{c as et,a as H,b as tt,d as nt}from"./coupon-B3TPwUS_.js";import{u as E,w as lt}from"./xlsx-DaVhO591.js";import{P as at}from"./PlusOutlined-DnK2ELqe.js";import{D as ot}from"./DownloadOutlined-B_HUG7fM.js";import{Q as N}from"./propTypes-C2D30ETy.js";import"./vuedraggable.umd-Dy6826IL.js";import"./useDesignSetting-OypQRMnc.js";import"./componentSetting-CQq0JJwW.js";import"./index-BWiplwgM.js";import"./DownOutlined-jyipYFFO.js";const it=Object.assign(Object.assign({},$e),ze),st=X({__GRID_ITEM__:!0,name:"FormItemGridItem",alias:["FormItemGi"],props:it,setup(){const l=C(null);return{formItemInstRef:l,validate:(...c)=>{const{value:D}=l;if(D)return D.validate(...c)},restoreValidation:()=>{const{value:c}=l;c&&c.restoreValidation()}}},render(){return k(Te,K(this.$.vnode.props||{},Ne),{default:()=>{const l=K(this.$props,Ue);return k(Y,Object.assign({ref:"formItemInstRef"},l),this.$slots)}})}}),rt=[{label:"增值券",value:1},{label:"抵扣券",value:2},{label:"团队券",value:3},{label:"自定义",value:4},{label:"固定金额",value:5}],J=[{label:"全部",value:""},{label:"正常",value:1},{label:"停用",value:2}];function ut(l){const p={1:{text:"增值券",type:"success"},2:{text:"抵扣券",type:"warning"},3:{text:"团队券",type:"info"},4:{text:"自定义",type:"default"},5:{text:"固定金额",type:"error"}}[l]||{text:"未知",type:"default"};return k(V,{type:p.type,bordered:!1},{default:()=>p.text})}function pt(l){return k(V,{type:l===1?"success":"error",bordered:!1},{default:()=>l===1?"正常":"停用"})}function dt(l){return k(V,{type:l===1?"warning":"default",bordered:!1},{default:()=>l===1?"新人券":"普通券"})}const mt=[{type:"selection"},{title:"ID",key:"id",width:80},{title:"优惠券名称",key:"name",width:150},{title:"优惠券描述",key:"intro",width:200,ellipsis:{tooltip:!0}},{title:"是否新人券",key:"is_new",width:120,render(l){return dt(l.is_new)}},{title:"优惠券类型",key:"type",width:120,render(l){return ut(l.type)}},{title:"折扣百分比",key:"discount",width:120,render(l){return`${l.type!=5?l.discount+"%":"-"}`}},{title:"折扣金额",key:"discount_amount",width:120,render(l){return`${l.type==5?"¥"+l.discount_amount:"-"}`}},{title:"使用最低金额",key:"min",width:120,render(l){return l.min?`¥${l.min}`:"无限制"}},{title:"使用最高金额",key:"max",width:120,render(l){return l.max?`¥${l.max}`:"无限制"}},{title:"生效时间",key:"start_time",width:160,render(l){return l.expir_type==2&&l.start_time?new Date(l.start_time*1e3).toLocaleString():"-"}},{title:"过期时间",key:"end_time",width:160,render(l){return l.expir_type==2&&l.end_time?new Date(l.end_time*1e3).toLocaleString():"-"}},{title:"用户券有效天数",key:"expir_day",width:140,render(l){return l.expir_type==1?l.expir_day+"天":"无限制"}},{title:"状态",key:"state",width:100,render(l){return pt(l.state)}},{title:"创建时间",key:"create_time",width:160,render(l){return l.create_time?new Date(l.create_time*1e3).toLocaleString():"-"}},{title:"更新时间",key:"update_time",width:160,render(l){return l.update_time?new Date(l.update_time*1e3).toLocaleString():"-"}}],_t={key:0,class:"text-gray-500"},ft={key:2,class:"text-[#999] text-[12px] pl-[120px] pb-[20px] mt-[-10px]"},Tt=X({__name:"index",setup(l){const u=Pe(),p=Le(),c=C(),D=C(),x=C(!1),T=C(!1),y=C([]),v=C({}),_=C(null),a=Q({id:0,name:"",type:1,intro:"",is_new:0,discount:null,discount_amount:null,min:0,max:0,expir_type:2,expir_day:90,start_time:0,end_time:0,state:1}),Z={name:{required:!0,message:"请输入优惠券名称",trigger:["blur","input"]},type:{required:!0,type:"number",message:"请选择优惠券类型",trigger:["blur","change"]},discount:{required:!0,type:"number",message:"请输入折扣百分比",trigger:["blur","change"]},timeRange:{required:!0,type:"array",message:"请选择有效期",trigger:["blur","change"]}},ee=[{field:"id",component:"NInput",label:"ID",componentProps:{placeholder:"请输入优惠券ID"}},{field:"state",component:"NSelect",label:"状态",componentProps:{placeholder:"请选择状态",options:J},slot:"statusSlot"}],te=Me(()=>{switch(a.type){case 1:return[{label:"+5%",value:5},{label:"+10%",value:10},{label:"+15%",value:15},{label:"+20%",value:20},{label:"+30%",value:30}];case 2:return[{label:"-5%",value:-5},{label:"-10%",value:-10},{label:"-15%",value:-15},{label:"-20%",value:-20},{label:"-30%",value:-30}];case 3:return[{label:"-10%",value:-10},{label:"-20%",value:-20},{label:"-30%",value:-30},{label:"-40%",value:-40},{label:"-50%",value:-50},{label:"-60%",value:-60}];default:return[]}});function ne(){a.discount=null,a.discount_amount=null}const le=Q({width:200,title:"操作",key:"action",fixed:"right",render(o){return k(he,{style:"button",actions:[{label:"编辑",type:"primary",onClick:ue.bind(null,o)},{label:"删除",type:"error",onClick:e=>{e.stopPropagation(),p.warning({title:"确定删除吗？",content:"删除后将无法恢复",positiveText:"确定",negativeText:"取消",onPositiveClick:()=>{pe(o)}})}}]})}}),[ae]=Re({gridProps:{cols:"1 s:1 m:2 l:3 xl:4 2xl:4"},labelWidth:80,schemas:ee});function oe(d){return L(this,arguments,function*({page:o,pageSize:e}){const g=B({page:String(o),pageSize:String(e)},v.value);try{const f=(yield H(g)).data;return{list:f.list||[],page:Number(f.page)||1,pageCount:Number(f.total_page)||0,pageSize:Number(f.page_size)||10,itemCount:Number(f.total)||0}}catch(b){return u.error("获取优惠券列表失败"),{list:[],page:1,pageCount:0,pageSize:10,itemCount:0}}})}function $(){c.value.reload()}function ie(){Object.assign(a,{id:0,name:"",type:1,intro:"",is_new:0,discount:0,discount_amount:0,min:0,max:0,expir_type:2,expir_day:90,start_time:0,end_time:0,state:1}),_.value=null,x.value=!0}function se(){return L(this,null,function*(){T.value=!0,setTimeout(()=>L(this,null,function*(){var o;try{yield(o=D.value)==null?void 0:o.validate(),a.expir_type===2&&_.value&&_.value.length===2&&(a.start_time=Math.floor(_.value[0]/1e3),a.end_time=Math.floor(_.value[1]/1e3));const e={id:a.id,name:a.name,type:a.type,intro:a.intro,is_new:a.is_new,min:a.min,max:a.max,expir_type:a.expir_type,state:a.state};if(a.expir_type===1?e.expir_day=a.expir_day:(e.start_time=a.start_time,e.end_time=a.end_time),a.type===5?e.discount_amount=a.discount_amount:e.discount=a.discount,a.id){const d=yield tt(e);d.code===1?(u.success("修改成功"),x.value=!1,$()):u.error(d.msg||"修改失败")}else{const d=yield nt(e);d.code===1?(u.success("添加成功"),x.value=!1,$()):u.error(d.msg||"添加失败")}}catch(e){console.error("表单提交错误:",e),u.error("表单验证失败，请检查输入")}finally{T.value=!1}}),0)})}const j={1:"#4caf50",2:"#2196f3",3:"#9c27b0",4:"#ff9800",5:"#f44336"};function re(o){const e=j[o.value]||"#999";return k("div",{style:{display:"flex",alignItems:"center"}},[k("span",{style:{display:"inline-block",width:"8px",height:"8px",borderRadius:"50%",backgroundColor:e,marginRight:"8px"}}),k("span",{style:{padding:"2px 4px",borderRadius:"4px"}},o.label)])}function ue(o){Object.assign(a,{id:o.id,name:o.name,type:o.type,intro:o.intro||"",is_new:o.is_new,discount:o.discount,discount_amount:o.discount_amount||0,min:o.min,max:o.max,expir_type:o.expir_type||2,expir_day:o.expir_day||90,start_time:o.start_time,end_time:o.end_time,state:o.state}),a.expir_type===2&&o.start_time&&o.end_time?_.value=[o.start_time*1e3,o.end_time*1e3]:_.value=null,x.value=!0}function pe(o){u.info("正在删除..."),et(o.id).then(e=>{e.code===1?(u.success("删除成功"),$()):u.error(e.msg||"删除失败")})}function de(o){v.value=o,$()}function me(){$()}function _e(){y.value=[]}function fe(){return L(this,null,function*(){let o=[];if(y.value.length>0)o=c.value.getDataSource().filter(d=>y.value.includes(d.id));else try{const e=B({page:"1",pageSize:"999999"},v.value);o=(yield H(e)).data.list||[]}catch(e){u.error("获取数据失败");return}if(o.length===0){u.warning("没有数据可导出");return}ye(o)})}function ye(o){const e={1:"增值券",2:"抵扣券",3:"团队券",4:"自定义",5:"固定金额"},d={0:"普通券",1:"新人券"},g={1:"启用",2:"停用"},b=o.map(s=>({ID:s.id,优惠券名称:s.name,是否新人券:d[s.is_new]||"-",优惠券类型:e[s.type]||"-",折扣百分比:s.type!=5?s.discount+"%":"-",折扣金额:s.type==5?"¥"+s.discount_amount:"-",使用最低金额:s.min?"¥"+s.min:"无限制",使用最高金额:s.max?"¥"+s.max:"无限制",生效时间:s.expir_type==2&&s.start_time?new Date(s.start_time*1e3).toLocaleString():"-",过期时间:s.expir_type==2&&s.end_time?new Date(s.end_time*1e3).toLocaleString():"-",用户券有效天数:s.expir_type==1?s.expir_day+"天":"无限制",状态:g[s.state]||"-",创建时间:s.create_time?new Date(s.create_time*1e3).toLocaleString():"-",更新时间:s.update_time?new Date(s.update_time*1e3).toLocaleString():"-"})),f=E.json_to_sheet(b),z=E.book_new();E.book_append_sheet(z,f,"优惠券列表");const M=`优惠券列表_${new Date().toLocaleDateString().replace(/\//g,"-")}.xlsx`;lt(z,M),u.success(`导出成功，共 ${o.length} 条数据`)}return(o,e)=>{const d=Ve,g=je,b=Fe,f=qe,z=Ge,M=Ke,s=Y,I=Qe,O=Ae,R=st,U=We,P=He,ge=Je,ve=Xe,ce=Ye,xe=Ze,be=Oe;return w(),h(be,{bordered:!1,class:"proCard"},{default:t(()=>[n(m(Ie),{onRegister:m(ae),onSubmit:de,onReset:me},{statusSlot:t(({model:i,field:F})=>[n(d,{value:i[F],"onUpdate:value":we=>i[F]=we,options:m(J)},null,8,["value","onUpdate:value","options"])]),_:1},8,["onRegister"]),n(m(Ce),{columns:m(mt),request:oe,"row-key":i=>i.id,ref_key:"actionRef",ref:c,actionColumn:le,"checked-row-keys":y.value,"onUpdate:checkedRowKeys":e[0]||(e[0]=i=>y.value=i),"scroll-x":2300,striped:!0},{tableTitle:t(()=>[n(f,{class:"flex items-center"},{default:t(()=>[n(b,{type:"primary",onClick:ie},{icon:t(()=>[n(g,null,{default:t(()=>[n(m(at))]),_:1})]),default:t(()=>[e[16]||(e[16]=r(" 新增优惠券 "))]),_:1}),n(b,{onClick:fe},{icon:t(()=>[n(g,null,{default:t(()=>[n(m(ot))]),_:1})]),default:t(()=>[e[17]||(e[17]=r(" 导出 "))]),_:1}),y.value.length>0?(w(),A("span",_t," 已选 "+Be(y.value.length)+" 项 ",1)):S("",!0),y.value.length>0?(w(),h(b,{key:1,text:"",type:"primary",onClick:_e},{default:t(()=>e[18]||(e[18]=[r(" 清除 ")])),_:1})):S("",!0)]),_:1})]),_:1},8,["columns","row-key","actionColumn","checked-row-keys"]),n(xe,{show:x.value,"onUpdate:show":e[15]||(e[15]=i=>x.value=i),"show-icon":!1,preset:"dialog",title:a.id?"编辑优惠券":"新增优惠券",style:{width:"700px"}},{action:t(()=>[n(f,null,{default:t(()=>[n(b,{onClick:e[14]||(e[14]=()=>x.value=!1)},{default:t(()=>e[45]||(e[45]=[r("取消")])),_:1}),n(b,{type:"info",loading:T.value,onClick:se},{default:t(()=>e[46]||(e[46]=[r(" 确定 ")])),_:1},8,["loading"])]),_:1})]),default:t(()=>[n(ce,{model:a,rules:Z,ref_key:"formRef",ref:D,"label-placement":"left","label-width":120,class:"py-4"},{default:t(()=>[n(z,{"title-placement":"left"},{default:t(()=>e[19]||(e[19]=[r("基本信息")])),_:1}),n(s,{label:"优惠券名称",path:"name"},{default:t(()=>[n(M,{placeholder:"请输入优惠券名称",value:a.name,"onUpdate:value":e[1]||(e[1]=i=>a.name=i),maxlength:"50","show-count":""},null,8,["value"])]),_:1}),n(s,{label:"优惠券描述",path:"intro"},{default:t(()=>[n(M,{type:"textarea",placeholder:"请输入优惠券的描述信息",value:a.intro,"onUpdate:value":e[2]||(e[2]=i=>a.intro=i),autosize:{minRows:3,maxRows:5},maxlength:"200","show-count":""},null,8,["value"])]),_:1}),n(s,{label:"是否新人券",path:"is_new"},{default:t(()=>[n(O,{value:a.is_new,"onUpdate:value":e[3]||(e[3]=i=>a.is_new=i)},{default:t(()=>[n(f,null,{default:t(()=>[n(I,{value:0},{default:t(()=>e[20]||(e[20]=[r("否")])),_:1}),n(I,{value:1},{default:t(()=>e[21]||(e[21]=[r("是")])),_:1})]),_:1})]),_:1},8,["value"])]),_:1}),W("div",{class:"border-t-[2px] rounded-[10px]",style:Ee({borderColor:j[a.type]})},[e[34]||(e[34]=W("div",{class:"text-sm font-bold p-4"},"优惠信息",-1)),n(ge,{cols:2,"x-gap":12},{default:t(()=>[n(R,{label:"优惠券类型",path:"type"},{default:t(()=>[n(d,{value:a.type,"onUpdate:value":[e[4]||(e[4]=i=>a.type=i),ne],options:m(rt),placeholder:"请选择优惠券类型","render-label":re},null,8,["value","options"])]),_:1}),[1,2,3].includes(a.type)?(w(),h(R,{key:0,path:"discount"},{label:t(()=>[e[23]||(e[23]=r(" 折扣百分比 ")),n(U,{trigger:"hover"},{trigger:t(()=>[n(g,{size:"14",style:{"margin-left":"4px",cursor:"help"},component:m(N)},null,8,["component"])]),default:t(()=>[e[22]||(e[22]=r(" 增值券为正值，抵扣券和团队券为负值 "))]),_:1})]),default:t(()=>[n(d,{value:a.discount,"onUpdate:value":e[5]||(e[5]=i=>a.discount=i),options:te.value,placeholder:"请选择折扣百分比",style:{width:"100%"}},null,8,["value","options"])]),_:1})):S("",!0),a.type===4?(w(),h(R,{key:1,path:"discount"},{label:t(()=>[e[25]||(e[25]=r(" 折扣百分比 ")),n(U,{trigger:"hover"},{trigger:t(()=>[n(g,{size:"14",style:{"margin-left":"4px",cursor:"help"},component:m(N)},null,8,["component"])]),default:t(()=>[e[24]||(e[24]=r(" 请输入折扣百分比，正数为增值，负数为抵扣 "))]),_:1})]),default:t(()=>[n(P,{value:a.discount,"onUpdate:value":e[6]||(e[6]=i=>a.discount=i),min:-100,max:100,precision:0,placeholder:"请输入折扣百分比",style:{width:"100%"}},{suffix:t(()=>e[26]||(e[26]=[r("%")])),_:1},8,["value"])]),_:1})):S("",!0),a.type===5?(w(),h(R,{key:2,label:"折扣金额",path:"discount_amount"},{default:t(()=>[n(P,{value:a.discount_amount,"onUpdate:value":e[7]||(e[7]=i=>a.discount_amount=i),min:0,precision:2,placeholder:"请输入折扣金额",style:{width:"100%"}},{prefix:t(()=>e[27]||(e[27]=[r("¥")])),_:1},8,["value"])]),_:1})):S("",!0),n(R,{path:"min"},{label:t(()=>[e[29]||(e[29]=r(" 使用最低金额 ")),n(U,{trigger:"hover"},{trigger:t(()=>[n(g,{size:"14",style:{"margin-left":"4px",cursor:"help"},component:m(N)},null,8,["component"])]),default:t(()=>[e[28]||(e[28]=r(" 优惠券使用的最低金额要求，0表示无限制 "))]),_:1})]),default:t(()=>[n(P,{value:a.min,"onUpdate:value":e[8]||(e[8]=i=>a.min=i),min:0,precision:2,placeholder:"0表示无限制",style:{width:"100%"}},{prefix:t(()=>e[30]||(e[30]=[r("¥")])),_:1},8,["value"])]),_:1}),n(R,{path:"max"},{label:t(()=>[e[32]||(e[32]=r(" 使用最高金额 ")),n(U,{trigger:"hover"},{trigger:t(()=>[n(g,{size:"14",style:{"margin-left":"4px",cursor:"help"},component:m(N)},null,8,["component"])]),default:t(()=>[e[31]||(e[31]=r(" 优惠券使用的最高金额限制，0表示无限制 "))]),_:1})]),default:t(()=>[n(P,{value:a.max,"onUpdate:value":e[9]||(e[9]=i=>a.max=i),min:0,precision:2,placeholder:"0表示无限制",style:{width:"100%"}},{prefix:t(()=>e[33]||(e[33]=[r("¥")])),_:1},8,["value"])]),_:1})]),_:1})],4),n(z,{"title-placement":"left"},{default:t(()=>e[35]||(e[35]=[r("有效期设置")])),_:1}),n(s,{label:"有效期类型",path:"expir_type"},{default:t(()=>[n(O,{value:a.expir_type,"onUpdate:value":e[10]||(e[10]=i=>a.expir_type=i)},{default:t(()=>[n(f,null,{default:t(()=>[n(I,{value:2},{default:t(()=>e[36]||(e[36]=[r("有效期范围")])),_:1}),n(I,{value:1},{default:t(()=>e[37]||(e[37]=[r("有效天数")])),_:1})]),_:1})]),_:1},8,["value"])]),_:1}),a.expir_type===2?(w(),h(s,{key:0,path:"timeRange"},{label:t(()=>[e[39]||(e[39]=r(" 有效期范围 ")),n(U,{trigger:"hover"},{trigger:t(()=>[n(g,{size:"14",style:{"margin-left":"4px",cursor:"help"},component:m(N)},null,8,["component"])]),default:t(()=>[e[38]||(e[38]=r(" 只有在此时间段内，优惠券才能被用户使用，否则无法使用 "))]),_:1})]),default:t(()=>[n(ve,{value:_.value,"onUpdate:value":e[11]||(e[11]=i=>_.value=i),type:"datetimerange",clearable:"",style:{width:"100%"}},null,8,["value"])]),_:1})):S("",!0),a.expir_type===1?(w(),h(s,{key:1,path:"expir_day"},{label:t(()=>[e[41]||(e[41]=r(" 有效天数 ")),n(U,{trigger:"hover"},{trigger:t(()=>[n(g,{size:"14",style:{"margin-left":"4px",cursor:"help"},component:m(N)},null,8,["component"])]),default:t(()=>[e[40]||(e[40]=r(" 普通优惠券默认有效期为90天 "))]),_:1})]),default:t(()=>[n(P,{value:a.expir_day,"onUpdate:value":e[12]||(e[12]=i=>a.expir_day=i),min:1,max:3650,precision:0,placeholder:"请输入有效天数",style:{width:"100%"}},{suffix:t(()=>e[42]||(e[42]=[r("天")])),_:1},8,["value"])]),_:1})):S("",!0),a.expir_type===1?(w(),A("div",ft," 注意：此为用户收到优惠券后的有效期，从优惠券发放给用户的那一刻开始计算 (普通优惠券默认90天) ")):S("",!0),n(s,{label:"优惠券状态",path:"state"},{default:t(()=>[n(O,{value:a.state,"onUpdate:value":e[13]||(e[13]=i=>a.state=i)},{default:t(()=>[n(f,null,{default:t(()=>[n(I,{value:1},{default:t(()=>e[43]||(e[43]=[r("启用")])),_:1}),n(I,{value:2},{default:t(()=>e[44]||(e[44]=[r("停用")])),_:1})]),_:1})]),_:1},8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["show","title"])]),_:1})}}});export{Tt as default};
