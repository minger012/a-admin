var b=(d,c,u)=>new Promise((_,p)=>{var r=a=>{try{i(u.next(a))}catch(n){p(n)}},f=a=>{try{i(u.throw(a))}catch(n){p(n)}},i=a=>a.done?_(a.value):Promise.resolve(a.value).then(r,f);i((u=u.apply(d,c)).next())});import{d as q,u as E,r as v,b as N,aa as w,o as S,x as T,w as l,j as t,i as k,dW as V,k as j,l as z,U as O,C as P,_ as W,B as $,D as A,E as F}from"./index-BEDOAs2M.js";const I=q({__name:"DeductModal",props:{visible:{type:Boolean},userData:{}},emits:["update:visible","success"],setup(d,{emit:c}){const u=E(),_=v(),p=v(!1),r=v(!1),f=[{label:"真实扣款",value:1},{label:"虚拟扣款",value:2},{label:"系统扣款",value:3}],i=d,a=c,n=N({id:0,money:0,type:1,user_remarks:""}),h={money:{required:!0,type:"number",message:"请输入扣款金额",trigger:["blur","change"],validator:(s,e)=>!e||e<=0?new Error("扣款金额必须大于0"):!0},type:{required:!0,type:"number",message:"请选择扣款类型",trigger:["change"]},user_remarks:{required:!0,message:"请输入用户端备注",trigger:["blur","input"]}};w(()=>i.visible,s=>{r.value=s,s&&i.userData&&(n.id=i.userData.id,n.money=0,n.type=1,n.user_remarks="")}),w(r,s=>{a("update:visible",s)});const x=()=>{r.value=!1},C=()=>b(this,null,function*(){var s;try{yield(s=_.value)==null?void 0:s.validate(),p.value=!0;const e=yield V(n);e.code===1?(u.success("扣款成功"),r.value=!1,a("success")):u.error(e.msg||"扣款失败")}catch(e){console.error("表单提交错误:",e)}finally{p.value=!1}});return(s,e)=>{const y=j,m=z,D=O,B=P,U=W,g=$,M=A,R=F;return S(),T(R,{show:r.value,"onUpdate:show":e[3]||(e[3]=o=>r.value=o),"show-icon":!1,preset:"dialog",title:"用户扣款",style:{width:"500px"}},{action:l(()=>[t(M,null,{default:l(()=>[t(g,{onClick:x},{default:l(()=>e[4]||(e[4]=[k("取消")])),_:1}),t(g,{type:"error",loading:p.value,onClick:C},{default:l(()=>e[5]||(e[5]=[k("确定扣款")])),_:1},8,["loading"])]),_:1})]),default:l(()=>[t(U,{model:n,rules:h,ref_key:"formRef",ref:_,"label-placement":"left","label-width":100,class:"py-4"},{default:l(()=>[t(m,{label:"用户名"},{default:l(()=>{var o;return[t(y,{value:(o=s.userData)==null?void 0:o.username,disabled:""},null,8,["value"])]}),_:1}),t(m,{label:"扣款金额",path:"money"},{default:l(()=>[t(D,{value:n.money,"onUpdate:value":e[0]||(e[0]=o=>n.money=o),min:0,precision:2,placeholder:"请输入扣款金额",style:{width:"100%"}},null,8,["value"])]),_:1}),t(m,{label:"扣款类型",path:"type"},{default:l(()=>[t(B,{value:n.type,"onUpdate:value":e[1]||(e[1]=o=>n.type=o),options:f,placeholder:"请选择扣款类型"},null,8,["value"])]),_:1}),t(m,{label:"用户端备注",path:"user_remarks"},{default:l(()=>[t(y,{type:"textarea",placeholder:"请输入用户端备注",value:n.user_remarks,"onUpdate:value":e[2]||(e[2]=o=>n.user_remarks=o),autosize:{minRows:2,maxRows:4}},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["show"])}}});export{I as _};
