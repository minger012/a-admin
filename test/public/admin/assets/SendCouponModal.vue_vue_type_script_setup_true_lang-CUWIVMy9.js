var g=(f,v,l)=>new Promise((m,c)=>{var p=o=>{try{u(l.next(o))}catch(r){c(r)}},n=o=>{try{u(l.throw(o))}catch(r){c(r)}},u=o=>o.done?m(o.value):Promise.resolve(o.value).then(p,n);u((l=l.apply(f,v)).next())});import{d as N,u as R,r as _,b as U,aa as y,o as V,x as j,w as s,j as t,i as h,dX as q,k as z,l as A,C as E,_ as I,B as O,D as P,E as T}from"./index-CoBJkS1T.js";import{a as X}from"./coupon-rIV581ox.js";const J=N({__name:"SendCouponModal",props:{visible:{type:Boolean},userData:{}},emits:["update:visible","success"],setup(f,{emit:v}){const l=R(),m=_(),c=_(!1),p=_(!1),n=_(!1),u=_([]),o=f,r=v,i=U({id:0,cid:null}),C={cid:{required:!0,type:"number",message:"请选择优惠券",trigger:["change"]}},k=()=>g(this,null,function*(){try{p.value=!0;const a=yield X({page:"1",pageSize:"100",state:1});a.code===1&&a.data.list&&(u.value=a.data.list.map(e=>({label:`${e.name} (${e.discount}% - ID:${e.id})`,value:e.id})))}catch(a){console.error("加载优惠券列表失败:",a)}finally{p.value=!1}});y(()=>o.visible,a=>{n.value=a,a&&o.userData&&(i.id=o.userData.id,i.cid=null,u.value.length===0&&k())}),y(n,a=>{r("update:visible",a)});const D=()=>{n.value=!1},x=()=>g(this,null,function*(){var a;try{yield(a=m.value)==null?void 0:a.validate(),c.value=!0;const e=yield q({id:i.id,cid:i.cid});e.code===1?(l.success("优惠券发送成功"),n.value=!1,r("success")):l.error(e.msg||"优惠券发送失败")}catch(e){console.error("表单提交错误:",e)}finally{c.value=!1}});return(a,e)=>{const B=z,b=A,$=E,M=I,w=O,S=P,L=T;return V(),j(L,{show:n.value,"onUpdate:show":e[1]||(e[1]=d=>n.value=d),"show-icon":!1,preset:"dialog",title:"发送优惠券",style:{width:"500px"}},{action:s(()=>[t(S,null,{default:s(()=>[t(w,{onClick:D},{default:s(()=>e[2]||(e[2]=[h("取消")])),_:1}),t(w,{type:"primary",loading:c.value,onClick:x},{default:s(()=>e[3]||(e[3]=[h("确定")])),_:1},8,["loading"])]),_:1})]),default:s(()=>[t(M,{model:i,rules:C,ref_key:"formRef",ref:m,"label-placement":"left","label-width":100,class:"py-4"},{default:s(()=>[t(b,{label:"用户名"},{default:s(()=>{var d;return[t(B,{value:(d=a.userData)==null?void 0:d.username,disabled:""},null,8,["value"])]}),_:1}),t(b,{label:"选择优惠券",path:"cid"},{default:s(()=>[t($,{value:i.cid,"onUpdate:value":e[0]||(e[0]=d=>i.cid=d),options:u.value,placeholder:"请选择优惠券",loading:p.value,filterable:"",clearable:""},null,8,["value","options","loading"])]),_:1})]),_:1},8,["model"])]),_:1},8,["show"])}}});export{J as _};
