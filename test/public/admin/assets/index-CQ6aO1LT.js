var q=Object.defineProperty,F=Object.defineProperties;var O=Object.getOwnPropertyDescriptors;var I=Object.getOwnPropertySymbols;var U=Object.prototype.hasOwnProperty,V=Object.prototype.propertyIsEnumerable;var z=(e,t,n)=>t in e?q(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,w=(e,t)=>{for(var n in t||(t={}))U.call(t,n)&&z(e,n,t[n]);if(I)for(var n of I(t))V.call(t,n)&&z(e,n,t[n]);return e},C=(e,t)=>F(e,O(t));var v=(e,t,n)=>new Promise((f,d)=>{var g=s=>{try{u(n.next(s))}catch(p){d(p)}},c=s=>{try{u(n.throw(s))}catch(p){d(p)}},u=s=>s.done?f(s.value):Promise.resolve(s.value).then(g,c);u((n=n.apply(e,t)).next())});import{B as j}from"./Table-B7zsuUw9.js";import{s as r,v as m,d as A,u as G,p as H,r as _,b as J,t as K,ag as Q,x as X,w as Y,q as Z,B as R,D as ee,o as te,j as k,h,a as ae,n as ne}from"./index-BEDOAs2M.js";import{_ as re}from"./BasicForm-DYjcmFKt.js";import{u as oe}from"./useForm-nNaFm5KP.js";import se from"./ExpandedRow-CqMj9Vp6.js";import{d as le,e as ie}from"./plan-CLUviLzz.js";import de from"./EditModal-m1J3_Y5D.js";import"./vuedraggable.umd-Dy6826IL.js";import"./useDesignSetting-OypQRMnc.js";import"./propTypes-C2D30ETy.js";import"./componentSetting-CQq0JJwW.js";import"./index-BWiplwgM.js";import"./DownOutlined-jyipYFFO.js";const ce={0:"待投放",1:"匹配中",2:"投放中",3:"投放失败",4:"等待结算",5:"结算成功"},ue={0:"warning",1:"info",2:"success",3:"error",4:"default",5:"success"},pe=[{type:"expand",renderExpand:e=>r(se,{data:e})},{title:"计划ID",key:"plan_id",width:100},{title:"联单组",key:"fb_id",width:280,className:"td-bg",render(e){return r("div",[r("div",{class:"flex items-center gap-2"},[r("span",`ID: ${e.fb_id}`),r(m,{type:"primary",size:"small",bordered:!0},{default:()=>`共${e.group_count}条`})]),r("div",{class:"mt-1"},[r(m,{type:"success",size:"small",bordered:!0},{default:()=>`${e.item_index}/${e.group_count}`}),e.state==4||e.state==5?r(m,{type:"primary",size:"small",bordered:!0,style:{marginLeft:"8px"}},{default:()=>"已完成"}):null])])}},{title:"用户ID",key:"uid",width:100,className:"td-bg"},{title:"用户简称",key:"short_name",width:120,className:"td-bg"},{title:"订单编号",key:"order_no",width:240,className:"td-bg"},{title:"计划名称",key:"plan_name",width:180,className:"td-bg"},{title:"产品名称",key:"goods_name",width:180,className:"td-bg"},{title:"前台投放",key:"form",width:100,className:"td-bg",render(e){return e.form===1?"是":"否"}},{title:"投放金额",key:"money",width:100,className:"td-bg",render(e){return e.money}},{title:"投放进度",key:"schedule",width:100,className:"td-bg",render(e){return`${e.schedule}%`}},{title:"已投放",key:"putIn",width:100,className:"td-bg",render(e){return e.putIn}},{title:"待投放",key:"wait_putIn",width:100,className:"td-bg",render(e){return e.wait_putIn}},{title:"利润",key:"profit",width:100,className:"td-bg",render(e){return e.profit}},{title:"投放利润率",key:"rate",width:120,className:"td-bg",render(e){let t="default";return e.rate>=80?t="success":e.rate>=50?t="info":e.rate>=20?t="warning":t="error",r(m,{type:t,bordered:!0,size:"small"},{default:()=>`${e.rate}%`})}},{title:"投放状态",key:"state",width:110,fixed:"right",className:"td-bg",render(e){return r(m,{type:ue[e.state]||"default",size:"small",bordered:!0},{default:()=>ce[e.state]||"未知"})}},{title:"更新时间",key:"update_time",width:160,className:"td-bg",render(e){return new Date(e.update_time*1e3).toLocaleString("zh-CN")}}],me={id:"planListTable"},fe=A({__name:"index",setup(e){const t=G(),n=H(),f=_(),d=_(!1),g=_(null),c=_({}),u=[{field:"uid",component:"NInput",label:"用户ID",componentProps:{placeholder:"请输入用户ID"}},{field:"short_name",component:"NInput",label:"用户简称",componentProps:{placeholder:"请输入用户简称"}},{field:"order_no",component:"NInput",label:"订单编号",componentProps:{placeholder:"请输入订单编号"}},{field:"fb_id",component:"NInput",label:"联单组ID",componentProps:{placeholder:"请输入联单组ID"}},{field:"state",component:"NSelect",label:"投放状态",componentProps:{placeholder:"请选择投放状态",options:[{label:"待投放",value:0},{label:"匹配中",value:1},{label:"投放中",value:2},{label:"投放失败",value:3},{label:"等待结算",value:4},{label:"结算成功",value:5}]}},{field:"timeRange",component:"NDatePicker",label:"创建时间",componentProps:{type:"daterange",clearable:!0,shortcuts:{一周内:[Date.now()-7*24*60*60*1e3,Date.now()],一个月内:[Date.now()-30*24*60*60*1e3,Date.now()],三个月内:[Date.now()-90*24*60*60*1e3,Date.now()]}}}],s=J({width:120,title:"操作",key:"action",fixed:"right",render(a){return r(ee,{size:"small"},{default:()=>[r(R,{text:!0,type:"primary",size:"small",onClick:()=>B(a)},{default:()=>"编辑"}),a.state==0?r(R,{text:!0,type:"error",size:"small",onClick:()=>P(a)},{default:()=>"删除"}):null].filter(Boolean)})}}),[p]=oe({gridProps:{cols:"1 s:1 m:2 l:3 xl:4 2xl:4"},labelWidth:120,schemas:u});function E($){return v(this,arguments,function*({page:a,pageSize:i}){const o=w({page:String(a),pageSize:String(i)},c.value);o.timeRange&&o.timeRange.length===2&&(o.sTime=Math.floor(o.timeRange[0]/1e3),o.eTime=Math.floor(o.timeRange[1]/1e3),delete o.timeRange);try{const l=yield ie(o);if(l.code===1){const x=[];return l.data.list.forEach(N=>{N.items.forEach((W,D)=>{x.push(C(w({},W),{group_count:N.count,item_index:D+1,is_group_first:D===0}))})}),{list:x,page:l.data.page,pageCount:l.data.total_page,pageSize:l.data.page_size,itemCount:l.data.total}}else return t.error(l.msg||"获取数据失败"),{list:[],page:1,pageCount:0,pageSize:10,itemCount:0}}catch(l){return console.log(l),t.error("获取用户计划列表失败"),{list:[],page:1,pageCount:0,pageSize:10,itemCount:0}}})}function S(a){return a.is_group_first?"tr-group-first":"tr-group-normal"}function T({expanded:a}){return r("span",{class:"expand-icon"},a?"−":"+")}function b(){f.value.reload()}function B(a){g.value=a,d.value=!0}function P(a){n.warning({title:"确认删除",content:`确认要删除订单 ${a.order_no} 吗？`,positiveText:"确定",negativeText:"取消",onPositiveClick:()=>v(this,null,function*(){try{const i=yield le(a.id);i.code===1?(t.success("删除成功"),b()):t.error(i.msg||"删除失败")}catch(i){t.error("删除失败")}})})}function M(a){c.value=a,b()}function L(){c.value={}}const y=()=>{const a=document.getElementById("planListTable");a&&a.style.setProperty("--plan-list-width",a.offsetWidth+"px")};return K(()=>{y(),window.addEventListener("resize",y)}),Q(()=>{window.removeEventListener("resize",y)}),(a,i)=>{const $=Z;return te(),X($,{bordered:!1,class:"proCard"},{default:Y(()=>[k(h(re),{onRegister:h(p),onSubmit:M,onReset:L},null,8,["onRegister"]),ae("div",me,[k(h(j),{columns:h(pe),request:E,"row-key":o=>o.id,ref_key:"actionRef",ref:f,actionColumn:s,"scroll-x":2600,striped:!1,"row-class-name":S,"render-expand-icon":T},null,8,["columns","row-key","actionColumn"])]),k(de,{show:d.value,"onUpdate:show":i[0]||(i[0]=o=>d.value=o),data:g.value,onSuccess:b},null,8,["show","data"])]),_:1})}}}),Re=ne(fe,[["__scopeId","data-v-6a2ff8d8"]]);export{Re as default};
