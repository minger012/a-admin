var w=(_,l,m)=>new Promise((v,d)=>{var g=o=>{try{r(m.next(o))}catch(y){d(y)}},s=o=>{try{r(m.throw(o))}catch(y){d(y)}},r=o=>o.done?v(o.value):Promise.resolve(o.value).then(g,s);r((m=m.apply(_,l)).next())});import{A as K,d as D,u as O,ac as P,r as k,b as N,t as G,o as M,c as B,j as n,w as a,dy as T,i,y as x,a as H,x as J,a9 as Q,k as W,B as X,D as Y,l as Z,F as ee,G as ne,U as ae,_ as oe,a7 as te,q as se,K as re,V as le}from"./index-CoBJkS1T.js";function ue(_){return K.Post("/admin/order/userMoneyAdd",_,{meta:{isReturnNativeResponse:!0}})}function me(_){return K.Post("/admin/order/userMoneySub",_,{meta:{isReturnNativeResponse:!0}})}const ce={key:0},ie={class:"text-red-500"},pe=D({__name:"index",setup(_){const l=O(),m=P(),v=k(null),d=k(!1),g=k(!1),s=N({id:0,username:"",name:"",balance:0}),r=N({username:""}),o=N({type:"add",money:void 0}),y={type:{required:!0,trigger:["blur","change"],message:"请选择操作类型"},money:{required:!0,trigger:["blur","change"],validator:(t,e)=>e?e<=0?new Error("金额必须大于0"):!0:new Error("请输入金额")}},R=t=>{if(t){const u=`bonusManage_search_${m.info.username||"unknown"}`;localStorage.setItem(u,t)}},F=()=>{const e=`bonusManage_search_${m.info.username||"unknown"}`;return localStorage.getItem(e)||""},I=()=>{const e=`bonusManage_search_${m.info.username||"unknown"}`;localStorage.removeItem(e)},S=()=>w(this,null,function*(){if(!r.username){l.warning("请输入会员账号");return}R(r.username);try{d.value=!0;const t=yield Q({username:r.username,page:1,pageSize:10});if(t.code===1){const e=t.data.list.find(u=>u.username.toLowerCase()===r.username.toLowerCase());e?(Object.assign(s,{id:e.id,username:e.username,name:e.name,balance:Number(e.money||"0")}),l.success("会员信息获取成功")):(h(),l.error("未找到该会员"))}else h(),l.error(t.msg||"会员信息获取失败")}catch(t){h(),l.error("会员信息获取出错，请稍后重试"),console.error("获取会员信息错误:",t)}finally{d.value=!1}}),h=()=>{Object.assign(s,{id:0,username:"",balance:0})},L=()=>{r.username="",h(),o.money=void 0,o.type="add",I()},V=()=>w(this,null,function*(){var t;if(!s.username){l.warning("请先搜索会员信息");return}(t=v.value)==null||t.validate(e=>w(this,null,function*(){if(!e)try{g.value=!0;const u=Number(o.money||"0"),p={username:s.username,money:u,type:3};let c;o.type==="add"?c=yield ue(p):c=yield me(p),c.code===1?(l.success("操作成功"),o.type==="add"?s.balance+=u:s.balance=Math.max(0,s.balance-u),o.money=void 0):l.error(c.msg||"操作失败")}catch(u){l.error("操作出错，请稍后重试"),console.error("提交表单错误:",u)}finally{g.value=!1}}))});return G(()=>{const t=F();t&&(r.username=t,S())}),(t,e)=>{const u=W,p=X,c=Y,f=Z,C=ee,A=ne,$=ae,j=oe,q=te,U=se,E=re,z=le;return M(),B("div",null,[n(U,{bordered:!1,class:"proCard",title:"赠送彩金"},{default:a(()=>[n(z,{cols:1,"x-gap":12},{default:a(()=>[n(E,null,{default:a(()=>[n(U,{segmented:{content:!0},bordered:!1,size:"small"},{header:a(()=>[n(c,null,{default:a(()=>[n(u,{value:r.username,"onUpdate:value":e[0]||(e[0]=b=>r.username=b),placeholder:"请输入会员账号",onKeydown:T(S,["enter"])},null,8,["value"]),n(p,{type:"primary",onClick:S,loading:d.value},{default:a(()=>e[3]||(e[3]=[i(" 搜索 ")])),_:1},8,["loading"]),n(p,{onClick:L},{default:a(()=>e[4]||(e[4]=[i("重置")])),_:1})]),_:1})]),default:a(()=>[s.username?(M(),B("div",ce,[n(j,{model:o,rules:y,ref_key:"formRef",ref:v,"label-placement":"left","label-width":100,class:"py-4"},{default:a(()=>[n(f,{label:"会员账号"},{default:a(()=>[i(x(s.username),1)]),_:1}),n(f,{label:"会员姓名"},{default:a(()=>[i(x(s.name),1)]),_:1}),n(f,{label:"账号余额"},{default:a(()=>[H("span",ie,x(s.balance),1)]),_:1}),n(f,{label:"操作类型",path:"type"},{default:a(()=>[n(A,{value:o.type,"onUpdate:value":e[1]||(e[1]=b=>o.type=b),name:"type"},{default:a(()=>[n(c,null,{default:a(()=>[n(C,{value:"add"},{default:a(()=>e[5]||(e[5]=[i("彩金加款")])),_:1}),n(C,{value:"sub"},{default:a(()=>e[6]||(e[6]=[i("彩金扣款")])),_:1})]),_:1})]),_:1},8,["value"])]),_:1}),n(f,{label:"金额",path:"money"},{default:a(()=>[n($,{value:o.money,"onUpdate:value":e[2]||(e[2]=b=>o.money=b),min:0,precision:2,clearable:"",placeholder:"请输入金额"},null,8,["value"])]),_:1}),n(f,null,{default:a(()=>[n(p,{type:"primary",class:"ml-[100px]",onClick:V,loading:g.value},{default:a(()=>e[7]||(e[7]=[i(" 确认提交 ")])),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])])):(M(),J(q,{key:1,description:"请先搜索会员账号"}))]),_:1})]),_:1})]),_:1})]),_:1})])}}});export{pe as default};
