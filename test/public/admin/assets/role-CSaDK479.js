var g=(c,a,r)=>new Promise((p,i)=>{var f=t=>{try{d(r.next(t))}catch(l){i(l)}},_=t=>{try{d(r.throw(t))}catch(l){i(l)}},d=t=>t.done?p(t.value):Promise.resolve(t.value).then(f,_);d((r=r.apply(c,a)).next())});import{B as w}from"./Table-yWmXchEz.js";import{T as R}from"./TableAction-DEAt9_Pl.js";import{d as v,g as x}from"./role-CBIkQ5O6.js";import{f as M}from"./dateUtil-vET3Clkl.js";import B from"./RoleModal-BK78Gxzj.js";import{P as z}from"./PlusOutlined-C1XCBWs4.js";import{d as D,u as N,p as S,r as k,b as E,c as P,j as s,w as m,q,s as A,o as V,h as y,i as j,N as I,B as K}from"./index-BUaCiTCS.js";import"./vuedraggable.umd-DngLu4Z2.js";import"./useDesignSetting-IaSTxNx8.js";import"./propTypes-CzR-Mwfa.js";import"./componentSetting-CQq0JJwW.js";import"./index-CEAvHuK6.js";import"./DownOutlined-oqXgzy95.js";const L=[{title:"id",key:"id"},{title:"角色名称",key:"name"},{title:"说明",key:"desc"},{title:"创建时间",key:"create_time",width:160,render(c){return c.create_time?M(new Date(c.create_time*1e3)):"-"}}],oe=D({__name:"role",setup(c){const a=N(),r=S(),p=k(),i=k(),f=E({width:200,title:"操作",key:"action",fixed:"right",render(e){return A(R,{style:"button",actions:[{label:"编辑",onClick:b.bind(null,e)},{label:"删除",onClick:C.bind(null,e),type:"error"}]})}}),_=e=>g(this,null,function*(){const o={pageSize:e.pageSize,page:e.page,rnd:Math.random()};try{const u=yield x(o),{data:n}=u;return{list:n.list||[],page:n.page,pageCount:n.total_page,pageSize:n.page_size,itemCount:n.total}}catch(u){return a.error("获取角色列表失败"),{list:[],page:1,pageCount:0,pageSize:10,itemCount:0}}});function d(){i.value.openAddModal()}function t(e){console.log(e)}function l(){p.value.reload()}function b(e){i.value.openEditModal(e)}function C(e){r.warning({title:"删除确认",content:`确定要删除角色 "${e.name}" 吗？`,positiveText:"确定",negativeText:"取消",onPositiveClick:()=>g(this,null,function*(){try{a.loading("删除中...");const o=yield v(e.name);o.code==1?(a.success("删除成功"),l()):a.error(o.msg||"删除失败")}catch(o){a.error("删除失败: "+(o.message||"未知错误"))}})})}return(e,o)=>{const u=I,n=K,h=q;return V(),P("div",null,[s(h,{bordered:!1,class:"mt-4 proCard"},{default:m(()=>[s(y(w),{columns:y(L),request:_,"row-key":T=>T.id,ref_key:"actionRef",ref:p,actionColumn:f,"onUpdate:checkedRowKeys":t},{tableTitle:m(()=>[s(n,{type:"primary",onClick:d},{icon:m(()=>[s(u,null,{default:m(()=>[s(y(z))]),_:1})]),default:m(()=>[o[0]||(o[0]=j(" 新增角色 "))]),_:1})]),_:1},8,["columns","row-key","actionColumn"])]),_:1}),s(B,{ref_key:"roleModalRef",ref:i,onReloadTable:l},null,512)])}}});export{oe as default};
