var it=Object.defineProperty,lt=Object.defineProperties;var rt=Object.getOwnPropertyDescriptors;var Fe=Object.getOwnPropertySymbols;var ct=Object.prototype.hasOwnProperty,ut=Object.prototype.propertyIsEnumerable;var Re=(e,t,n)=>t in e?it(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,O=(e,t)=>{for(var n in t||(t={}))ct.call(t,n)&&Re(e,n,t[n]);if(Fe)for(var n of Fe(t))ut.call(t,n)&&Re(e,n,t[n]);return e},Q=(e,t)=>lt(e,rt(t));var U=(e,t,n)=>new Promise((s,o)=>{var l=c=>{try{u(n.next(c))}catch(m){o(m)}},f=c=>{try{u(n.throw(c))}catch(m){o(m)}},u=c=>c.done?s(c.value):Promise.resolve(c.value).then(l,f);u((n=n.apply(e,t)).next())});import{a_ as Pe,a$ as dt,b0 as ft,b1 as gt,b2 as mt,b3 as pt,b4 as vt,b5 as ht,b6 as Ct,b7 as qe,b8 as bt,b9 as _t,ba as wt,bb as kt,bc as yt,bd as St,be as Nt,bf as Dt,bg as Ke,bh as We,d as X,o as H,c as q,a as D,bi as Ot,aw as xt,r as z,b as Tt,O as F,bj as be,au as Lt,bk as fe,bl as ge,h as a,n as Le,az as Y,x as $e,w,j as h,i as ae,ai as Ee,N as we,m as Ye,B as $t,D as zt,T as ze,S as je,bm as Ft,bn as Ze,aa as ke,k as Rt,U as Pt,C as Et,a4 as Ge,W as Vt,bo as It,s as j,bp as Ht,bq as se,ax as Qe,ao as xe,br as A,bs as pe,ae as Ve,bt as ie,bu as At,aj as Bt,bv as Xe,z as _e,y as Te,bw as Mt,t as Je,$ as et,bx as De,by as Ut,a6 as qt,bz as Kt,bA as Wt,X as Yt,a8 as jt}from"./index-C4bwFPRU.js";import{D as Zt}from"./vuedraggable.umd-DcUfH-TH.js";import{S as Gt,u as Qt,C as Xt,a as Jt,R as en}from"./useDesignSetting-DbD-gdTl.js";import{p as he,s as tn,Q as nn}from"./propTypes-CjHlpx3C.js";import{c as on}from"./componentSetting-CQq0JJwW.js";import{t as sn,a as an,u as ln}from"./index-CsSSQVOk.js";var Ie=Pe?Pe.isConcatSpreadable:void 0;function rn(e){return dt(e)||ft(e)||!!(Ie&&e&&e[Ie])}function cn(e,t,n,s,o){var l=-1,f=e.length;for(n||(n=rn),o||(o=[]);++l<f;){var u=e[l];n(u)?gt(o,u):o[o.length]=u}return o}function un(e){var t=e==null?0:e.length;return t?cn(e):[]}function dn(e){return mt(pt(e,void 0,un),e+"")}function fn(e){var t=e==null?0:e.length;return t?e[t-1]:void 0}function gn(e,t){return t.length<2?e:vt(e,ht(t,0,-1))}function mn(e,t){return Ct(e,t)}function pn(e,t){return t=qe(t,e),e=gn(e,t),e==null||delete e[bt(fn(t))]}function vn(e){return _t(e)?void 0:e}var hn=1,Cn=2,bn=4,_n=dn(function(e,t){var n={};if(e==null)return n;var s=!1;t=wt(t,function(l){return l=qe(l,e),s||(s=l.length>1),l}),kt(e,yt(e),n),s&&(n=St(n,hn|Cn|bn,vn));for(var o=t.length;o--;)pn(n,t[o]);return n});function He(e,t){var n;Nt(1,arguments);var s=Dt((n=void 0)!==null&&n!==void 0?n:2);if(s!==2&&s!==1&&s!==0)throw new RangeError("additionalDigits must be 0, 1 or 2");if(!(typeof e=="string"||Object.prototype.toString.call(e)==="[object String]"))return new Date(NaN);var o=Sn(e),l;if(o.date){var f=Nn(o.date,s);l=Dn(f.restDateString,f.year)}if(!l||isNaN(l.getTime()))return new Date(NaN);var u=l.getTime(),c=0,m;if(o.time&&(c=On(o.time),isNaN(c)))return new Date(NaN);if(o.timezone){if(m=xn(o.timezone),isNaN(m))return new Date(NaN)}else{var y=new Date(u+c),L=new Date(0);return L.setFullYear(y.getUTCFullYear(),y.getUTCMonth(),y.getUTCDate()),L.setHours(y.getUTCHours(),y.getUTCMinutes(),y.getUTCSeconds(),y.getUTCMilliseconds()),L}return new Date(u+c+m)}var ve={dateTimeDelimiter:/[T ]/,timeZoneDelimiter:/[Z ]/i,timezone:/([Z+-].*)$/},wn=/^-?(?:(\d{3})|(\d{2})(?:-?(\d{2}))?|W(\d{2})(?:-?(\d{1}))?|)$/,kn=/^(\d{2}(?:[.,]\d*)?)(?::?(\d{2}(?:[.,]\d*)?))?(?::?(\d{2}(?:[.,]\d*)?))?$/,yn=/^([+-])(\d{2})(?::?(\d{2}))?$/;function Sn(e){var t={},n=e.split(ve.dateTimeDelimiter),s;if(n.length>2)return t;if(/:/.test(n[0])?s=n[0]:(t.date=n[0],s=n[1],ve.timeZoneDelimiter.test(t.date)&&(t.date=e.split(ve.timeZoneDelimiter)[0],s=e.substr(t.date.length,e.length))),s){var o=ve.timezone.exec(s);o?(t.time=s.replace(o[1],""),t.timezone=o[1]):t.time=s}return t}function Nn(e,t){var n=new RegExp("^(?:(\\d{4}|[+-]\\d{"+(4+t)+"})|(\\d{2}|[+-]\\d{"+(2+t)+"})$)"),s=e.match(n);if(!s)return{year:NaN,restDateString:""};var o=s[1]?parseInt(s[1]):null,l=s[2]?parseInt(s[2]):null;return{year:l===null?o:l*100,restDateString:e.slice((s[1]||s[2]).length)}}function Dn(e,t){if(t===null)return new Date(NaN);var n=e.match(wn);if(!n)return new Date(NaN);var s=!!n[4],o=ue(n[1]),l=ue(n[2])-1,f=ue(n[3]),u=ue(n[4]),c=ue(n[5])-1;if(s)return Fn(t,u,c)?Tn(t,u,c):new Date(NaN);var m=new Date(0);return!$n(t,l,f)||!zn(t,o)?new Date(NaN):(m.setUTCFullYear(t,l,Math.max(o,f)),m)}function ue(e){return e?parseInt(e):1}function On(e){var t=e.match(kn);if(!t)return NaN;var n=Oe(t[1]),s=Oe(t[2]),o=Oe(t[3]);return Rn(n,s,o)?n*Ke+s*We+o*1e3:NaN}function Oe(e){return e&&parseFloat(e.replace(",","."))||0}function xn(e){if(e==="Z")return 0;var t=e.match(yn);if(!t)return 0;var n=t[1]==="+"?-1:1,s=parseInt(t[2]),o=t[3]&&parseInt(t[3])||0;return Pn(s,o)?n*(s*Ke+o*We):NaN}function Tn(e,t,n){var s=new Date(0);s.setUTCFullYear(e,0,4);var o=s.getUTCDay()||7,l=(t-1)*7+n+1-o;return s.setUTCDate(s.getUTCDate()+l),s}var Ln=[31,null,31,30,31,30,31,31,30,31,30,31];function tt(e){return e%400===0||e%4===0&&e%100!==0}function $n(e,t,n){return t>=0&&t<=11&&n>=1&&n<=(Ln[t]||(tt(e)?29:28))}function zn(e,t){return t>=1&&t<=(tt(e)?366:365)}function Fn(e,t,n){return t>=1&&t<=53&&n>=0&&n<=6}function Rn(e,t,n){return e===24?t===0&&n===0:n>=0&&n<60&&t>=0&&t<60&&e>=0&&e<25}function Pn(e,t){return t>=0&&t<=59}const En={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 1024 1024"},Vn=D("path",{d:"M840 836H184c-4.4 0-8 3.6-8 8v60c0 4.4 3.6 8 8 8h656c4.4 0 8-3.6 8-8v-60c0-4.4-3.6-8-8-8zm0-724H184c-4.4 0-8 3.6-8 8v60c0 4.4 3.6 8 8 8h656c4.4 0 8-3.6 8-8v-60c0-4.4-3.6-8-8-8zM610.8 378c6 0 9.4-7 5.7-11.7L515.7 238.7a7.14 7.14 0 0 0-11.3 0L403.6 366.3a7.23 7.23 0 0 0 5.7 11.7H476v268h-62.8c-6 0-9.4 7-5.7 11.7l100.8 127.5c2.9 3.7 8.5 3.7 11.3 0l100.8-127.5c3.7-4.7.4-11.7-5.7-11.7H548V378h62.8z",fill:"currentColor"},null,-1),In=[Vn],Hn=X({name:"ColumnHeightOutlined",render:function(t,n){return H(),q("svg",En,In)}}),An={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 1024 1024"},Bn=D("path",{d:"M909.3 506.3L781.7 405.6a7.23 7.23 0 0 0-11.7 5.7V476H548V254h64.8c6 0 9.4-7 5.7-11.7L517.7 114.7a7.14 7.14 0 0 0-11.3 0L405.6 242.3a7.23 7.23 0 0 0 5.7 11.7H476v222H254v-64.8c0-6-7-9.4-11.7-5.7L114.7 506.3a7.14 7.14 0 0 0 0 11.3l127.5 100.8c4.7 3.7 11.7.4 11.7-5.7V548h222v222h-64.8c-6 0-9.4 7-5.7 11.7l100.8 127.5c2.9 3.7 8.5 3.7 11.3 0l100.8-127.5c3.7-4.7.4-11.7-5.7-11.7H548V548h222v64.8c0 6 7 9.4 11.7 5.7l127.5-100.8a7.3 7.3 0 0 0 .1-11.4z",fill:"currentColor"},null,-1),Mn=[Bn],Un=X({name:"DragOutlined",render:function(t,n){return H(),q("svg",An,Mn)}}),qn={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 1024 1024"},Kn=D("path",{d:"M904 512h-56c-4.4 0-8 3.6-8 8v320H184V184h320c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H144c-17.7 0-32 14.3-32 32v736c0 17.7 14.3 32 32 32h736c17.7 0 32-14.3 32-32V520c0-4.4-3.6-8-8-8z",fill:"currentColor"},null,-1),Wn=D("path",{d:"M355.9 534.9L354 653.8c-.1 8.9 7.1 16.2 16 16.2h.4l118-2.9c2-.1 4-.9 5.4-2.3l415.9-415c3.1-3.1 3.1-8.2 0-11.3L785.4 114.3c-1.6-1.6-3.6-2.3-5.7-2.3s-4.1.8-5.7 2.3l-415.8 415a8.3 8.3 0 0 0-2.3 5.6zm63.5 23.6L779.7 199l45.2 45.1l-360.5 359.7l-45.7 1.1l.7-46.4z",fill:"currentColor"},null,-1),Yn=[Kn,Wn],nt=X({name:"FormOutlined",render:function(t,n){return H(),q("svg",qn,Yn)}}),jn={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 1024 1024"},Zn=D("path",{d:"M762 164h-64c-4.4 0-8 3.6-8 8v688c0 4.4 3.6 8 8 8h64c4.4 0 8-3.6 8-8V172c0-4.4-3.6-8-8-8zm-508 0v72.4c0 9.5 4.2 18.4 11.4 24.5L564.6 512L265.4 763.1c-7.2 6.1-11.4 15-11.4 24.5V860c0 6.8 7.9 10.5 13.1 6.1L689 512L267.1 157.9A7.95 7.95 0 0 0 254 164z",fill:"currentColor"},null,-1),Gn=[Zn],Qn=X({name:"VerticalLeftOutlined",render:function(t,n){return H(),q("svg",jn,Gn)}}),Xn={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 1024 1024"},Jn=D("path",{d:"M326 164h-64c-4.4 0-8 3.6-8 8v688c0 4.4 3.6 8 8 8h64c4.4 0 8-3.6 8-8V172c0-4.4-3.6-8-8-8zm444 72.4V164c0-6.8-7.9-10.5-13.1-6.1L335 512l421.9 354.1c5.2 4.4 13.1.7 13.1-6.1v-72.4c0-9.4-4.2-18.4-11.4-24.5L459.4 512l299.2-251.1c7.2-6.1 11.4-15.1 11.4-24.5z",fill:"currentColor"},null,-1),eo=[Jn],to=X({name:"VerticalRightOutlined",render:function(t,n){return H(),q("svg",Xn,eo)}}),ot=Symbol("s-table");function no(e){xt(ot,e)}function st(){return Ot(ot)}const oo=X({name:"ColumnSetting",components:{SettingOutlined:Gt,DragOutlined:Un,Draggable:Zt,VerticalRightOutlined:to,VerticalLeftOutlined:Qn},setup(){const{getDarkTheme:e}=Qt(),t=st(),n=z([]),s=z([]),o=Tt({selection:!1,checkAll:!0,checkList:[],defaultCheckList:[]}),l=F(()=>o.selection);be(()=>{t.getColumns().length&&f()});function f(){const d=m(),p=d.map(b=>b.key);o.checkList=p,o.defaultCheckList=p;const k=d.filter(b=>b.key!="action"&&b.title!="操作");n.value.length||(n.value=fe(k),s.value=fe(k))}function u(d){o.selection&&d.unshift("selection"),c(d)}function c(d){t.setColumns(d)}function m(){let d=[];return t.getColumns().forEach(p=>{d.push(O({},p))}),d}function y(){o.checkList=[...o.defaultCheckList],o.checkAll=!0;let p=t.getCacheColumns().map(k=>Q(O({},k),{fixed:void 0}));c(p),n.value=p}function L(d){let p=t.getCacheColumns(!0);d?(c(p),o.checkList=p):(c([]),o.checkList=[])}function R(){const d=ge(a(n));n.value=d,c(d)}function r(d){let p=t.getCacheColumns();d?(p.unshift({type:"selection",key:"selection"}),c(p)):(p.splice(0,1),c(p))}function g(d){return d.draggedContext.element.draggable!==!1}function C(d,p){if(!o.checkList.includes(d.key))return;let k=m();const b=d.fixed===p?void 0:p;let I=k.findIndex(K=>K.key===d.key);I!==-1&&(k[I].fixed=b),t.setCacheColumnsField(d.key,{fixed:b}),n.value[I].fixed=b,c(k)}return Q(O({},Lt(o)),{columnsList:n,getDarkTheme:e,onChange:u,onCheckAll:L,onSelection:r,onMove:g,resetColumns:y,fixedColumn:C,draggableEnd:R,getSelection:l})}}),so={class:"cursor-pointer table-toolbar-right-icon"},ao={class:"table-toolbar-inner-popover-title"},io={class:"table-toolbar-inner"},lo={class:"fixed-item"};function ro(e,t,n,s,o,l){const f=Y("SettingOutlined"),u=we,c=Ye,m=$t,y=zt,L=Y("DragOutlined"),R=Y("VerticalRightOutlined"),r=ze,g=je,C=Y("VerticalLeftOutlined"),d=Y("Draggable"),p=Ft,k=Ze;return H(),$e(r,{trigger:"hover"},{trigger:w(()=>[D("div",so,[h(k,{trigger:"click",width:230,class:"toolbar-popover",placement:"bottom-end"},{trigger:w(()=>[h(u,{size:"18"},{default:w(()=>[h(f)]),_:1})]),header:w(()=>[D("div",ao,[h(y,null,{default:w(()=>[h(c,{checked:e.checkAll,"onUpdate:checked":[t[0]||(t[0]=b=>e.checkAll=b),e.onCheckAll]},{default:w(()=>t[4]||(t[4]=[ae("列展示")])),_:1},8,["checked","onUpdate:checked"]),h(c,{checked:e.selection,"onUpdate:checked":[t[1]||(t[1]=b=>e.selection=b),e.onSelection]},{default:w(()=>t[5]||(t[5]=[ae("勾选列")])),_:1},8,["checked","onUpdate:checked"]),h(m,{text:"",type:"info",size:"small",class:"mt-1",onClick:e.resetColumns},{default:w(()=>t[6]||(t[6]=[ae("重置")])),_:1},8,["onClick"])]),_:1})])]),default:w(()=>[D("div",io,[h(p,{value:e.checkList,"onUpdate:value":[t[3]||(t[3]=b=>e.checkList=b),e.onChange]},{default:w(()=>[h(d,{modelValue:e.columnsList,"onUpdate:modelValue":t[2]||(t[2]=b=>e.columnsList=b),animation:"300","item-key":"key",filter:".no-draggable",move:e.onMove,onEnd:e.draggableEnd},{item:w(({element:b})=>[D("div",{class:Ee(["table-toolbar-inner-checkbox",{"table-toolbar-inner-checkbox-dark":e.getDarkTheme===!0,"no-draggable":b.draggable===!1}])},[D("span",{class:Ee(["drag-icon",{"drag-icon-hidden":b.draggable===!1}])},[h(u,{size:"18"},{default:w(()=>[h(L)]),_:1})],2),h(c,{value:b.key,label:b.title},null,8,["value","label"]),D("div",lo,[h(r,{trigger:"hover",placement:"bottom"},{trigger:w(()=>[h(u,{size:"18",color:b.fixed==="left"?"#2080f0":void 0,class:"cursor-pointer",onClick:I=>e.fixedColumn(b,"left")},{default:w(()=>[h(R)]),_:2},1032,["color","onClick"])]),default:w(()=>[t[7]||(t[7]=D("span",null,"固定到左侧",-1))]),_:2},1024),h(g,{vertical:""}),h(r,{trigger:"hover",placement:"bottom"},{trigger:w(()=>[h(u,{size:"18",color:b.fixed==="right"?"#2080f0":void 0,class:"cursor-pointer",onClick:I=>e.fixedColumn(b,"right")},{default:w(()=>[h(C)]),_:2},1032,["color","onClick"])]),default:w(()=>[t[8]||(t[8]=D("span",null,"固定到右侧",-1))]),_:2},1024)])],2)]),_:1},8,["modelValue","move","onEnd"])]),_:1},8,["value","onUpdate:value"])])]),_:1})])]),default:w(()=>[t[9]||(t[9]=D("span",null,"列设置",-1))]),_:1})}const co=Le(oo,[["render",ro]]);function uo(e){const t=z(a(e).loading);ke(()=>a(e).loading,o=>{t.value=o});const n=F(()=>a(t));function s(o){t.value=o}return{getLoading:n,setLoading:s}}var at=(e=>(e.NInput="on-input",e.NInputNumber="on-input",e.NSelect="on-update:value",e.NSwitch="on-update:value",e.NCheckbox="on-update:value",e.NDatePicker="on-update:value",e.NTimePicker="on-update:value",e))(at||{});const J=new Map;J.set("NInput",Rt);J.set("NInputNumber",Pt);J.set("NSelect",Et);J.set("NSwitch",Ge);J.set("NCheckbox",Ye);J.set("NDatePicker",Vt);J.set("NTimePicker",It);const fo=({component:e="NInput",rule:t=!0,ruleMessage:n,popoverVisible:s},{attrs:o})=>{const l=J.get(e),f=j(l,o);return t?j(Ze,{"display-directive":"show",show:!!s,manual:"manual"},{trigger:()=>f,default:()=>j("span",{style:{color:"red",width:"90px",display:"inline-block"}},{default:()=>n})}):f};function go(e){return!e||!e.getBoundingClientRect?0:e.getBoundingClientRect()}function mo(e){const t=document.documentElement,n=t.scrollLeft,s=t.scrollTop,o=t.clientLeft,l=t.clientTop,f=window.pageXOffset,u=window.pageYOffset,c=go(e),{left:m,top:y,width:L,height:R}=c,r=(f||n)-(o||0),g=(u||s)-(l||0),C=m+f,d=y+u,p=C-r,k=d-g,b=window.document.documentElement.clientWidth,I=window.document.documentElement.clientHeight;return{left:p,top:k,right:b-L-p,bottom:I-R-k,rightIncludeBody:b-p,bottomIncludeBody:I-k}}function Ae(e,t,n){e&&t&&n&&e.addEventListener(t,n,!1)}const Ce=new Map;let Be;Ht||(Ae(document,"mousedown",e=>Be=e),Ae(document,"mouseup",e=>{for(const{documentHandler:t}of Ce.values())t(e,Be)}));function Me(e,t){let n=[];return Array.isArray(t.arg)?n=t.arg:n.push(t.arg),function(s,o){const l=t.instance.popperRef,f=s.target,u=o.target,c=!t||!t.instance,m=!f||!u,y=e.contains(f)||e.contains(u),L=e===f,R=n.length&&n.some(g=>g==null?void 0:g.contains(f))||n.length&&n.includes(u),r=l&&(l.contains(f)||l.contains(u));c||m||y||L||R||r||t.value()}}const po={beforeMount(e,t){Ce.set(e,{documentHandler:Me(e,t),bindingFn:t.value})},updated(e,t){Ce.set(e,{documentHandler:Me(e,t),bindingFn:t.value})},unmounted(e){Ce.delete(e)}};function Ue(e){return e==="NInput"?"请输入":["NPicker","NSelect","NCheckbox","NRadio","NSwitch","NDatePicker","NTimePicker"].includes(e)?"请选择":""}const vo=X({name:"EditableCell",components:{FormOutlined:nt,CloseOutlined:Xt,CheckOutlined:Jt,CellComponent:fo},directives:{clickOutside:po},props:{value:{type:[String,Number,Boolean,Object],default:""},record:{type:Object},column:{type:Object,default:()=>({})},index:he.number},setup(e){const t=st(),n=z(!1),s=z(),o=z(!1),l=z(""),f=z([]),u=z(e.value),c=z(e.value),m=F(()=>{var i;return((i=e.column)==null?void 0:i.editComponent)||"NInput"}),y=F(()=>{var i;return(i=e.column)==null?void 0:i.editRule}),L=F(()=>a(l)&&a(o)),R=F(()=>{const i=a(m);return["NCheckbox","NRadio"].includes(i)}),r=F(()=>{var G,ee,me,le;const i=(ee=(G=e.column)==null?void 0:G.editComponentProps)!=null?ee:{},v=(le=(me=e.column)==null?void 0:me.editComponent)!=null?le:null,_=a(m),T={},S=a(R);let P=S?"checked":"value";const x=a(u);let $=S?pe(x)&&A(x)?x:!!x:x;_==="NDatePicker"&&(xe($)?i.valueFormat?P="formatted-value":$=He($).getTime():se($)&&(i.valueFormat?P="formatted-value":$=$.map(N=>He(N).getTime())));const E=v?at[v]:void 0;return Q(O(O({placeholder:Ue(a(m))},T),_n(i,"onChange")),{[E]:k,[P]:$})}),g=F(()=>{var x,$;const{editComponentProps:i,editValueMap:v}=e.column,_=a(u);if(v&&ie(v))return v(_);if(!a(m).includes("NSelect"))return _;const P=((x=i==null?void 0:i.options)!=null?x:a(f)||[]).find(E=>`${E.value}`==`${_}`);return($=P==null?void 0:P.label)!=null?$:_}),C=F(()=>{const{align:i="center"}=e.column;return`edit-cell-align-${i}`}),d=F(()=>{const{editable:i}=e.record||{};return!!i});be(()=>{c.value=e.value}),be(()=>{const{editable:i}=e.column;(A(i)||A(a(d)))&&(n.value=!!i||a(d))});function p(){var i;a(d)||a((i=e.column)==null?void 0:i.editRow)||(l.value="",n.value=!0,Qe(()=>{var _;const v=a(s);(_=v==null?void 0:v.focus)==null||_.call(v)}))}function k(v){return U(this,arguments,function*(i){var P,x,$,E,G;const _=a(m),T=(x=(P=e.column)==null?void 0:P.editComponentProps)!=null?x:{};i?i!=null&&i.target&&Reflect.has(i.target,"value")?u.value=i.target.value:_==="NCheckbox"?u.value=i.target.checked:(xe(i)||A(i)||pe(i))&&(u.value=i):u.value=i,_==="NDatePicker"&&(pe(u.value)?T.valueFormat&&(u.value=Ve(u.value,T.valueFormat)):se(u.value)&&T.valueFormat&&(u.value=u.value.map(ee=>{Ve(ee,T.valueFormat)})));const S=(E=($=e.column)==null?void 0:$.editComponentProps)==null?void 0:E.onChange;S&&ie(S)&&S(...arguments),(G=t.emit)==null||G.call(t,"edit-change",{column:e.column,value:a(u),record:ge(e.record)}),yield b()})}function b(){return U(this,null,function*(){const{column:i,record:v}=e,{editRule:_}=i,T=a(u);if(_){if(A(_)&&!T&&!pe(T)){o.value=!0;const S=a(m);return l.value=Ue(S),!1}if(ie(_)){const S=yield _(T,v);return S?(l.value=S,o.value=!0,!1):(l.value="",!0)}}return l.value="",!0})}function I(i=!0,v=!0){return U(this,null,function*(){var E;if(v&&!(yield b()))return!1;const{column:_,index:T,record:S}=e;if(!S)return!1;const{key:P}=_,x=a(u);if(!P)return;tn(S,P,x),i&&((E=t.emit)==null||E.call(t,"edit-end",{record:S,index:T,key:P,value:x})),n.value=!1})}function K(){return U(this,null,function*(){var i;(i=e.column)!=null&&i.editRow||(yield I())})}function M(){var S;n.value=!1,u.value=c.value;const{column:i,index:v,record:_}=e,{key:T}=i;o.value=!0,l.value="",(S=t.emit)==null||S.call(t,"edit-cancel",{record:_,index:v,key:T,value:a(u)})}function W(){var v;if((v=e.column)!=null&&v.editable||a(d))return;a(m).includes("NInput")&&M()}function te(i){f.value=i}function Z(i,v){var _;e.record&&(se(e.record[i])?(_=e.record[i])==null||_.push(v):e.record[i]=[v])}return e.record&&(Z("submitCbs",I),Z("validCbs",b),Z("cancelCbs",M),e.column.key&&(e.record.editValueRefs||(e.record.editValueRefs={}),e.record.editValueRefs[e.column.key]=u),e.record.onCancelEdit=()=>{var i,v;se((i=e.record)==null?void 0:i.cancelCbs)&&((v=e.record)==null||v.cancelCbs.forEach(_=>_()))},e.record.onSubmitEdit=()=>U(this,null,function*(){var i,v,_,T;if(se((i=e.record)==null?void 0:i.submitCbs)){const S=(((v=e.record)==null?void 0:v.validCbs)||[]).map(E=>E());return(yield Promise.all(S)).every(E=>!!E)?((((_=e.record)==null?void 0:_.submitCbs)||[]).forEach(E=>E(!1,!1)),(T=t.emit)==null||T.call(t,"edit-row-end"),!0):void 0}})),{isEdit:n,handleEdit:p,currentValueRef:u,handleSubmit:I,handleChange:k,handleCancel:M,elRef:s,getComponent:m,getRule:y,onClickOutside:W,ruleMessage:l,getRuleVisible:L,getComponentProps:r,handleOptionsChange:te,getWrapperClass:C,getRowEditable:d,getValues:g,handleEnter:K}}}),ho={class:"editable-cell"},Co={key:0,class:"flex editable-cell-content"},bo={class:"editable-cell-content-comp"},_o={key:0,class:"editable-cell-action"};function wo(e,t,n,s,o,l){const f=Y("CellComponent"),u=Y("CheckOutlined"),c=we,m=Y("CloseOutlined"),y=Y("FormOutlined"),L=At("click-outside");return H(),q("div",ho,[e.isEdit?Bt((H(),q("div",Co,[D("div",bo,[h(f,Xe(e.getComponentProps,{component:e.getComponent,popoverVisible:e.getRuleVisible,ruleMessage:e.ruleMessage,rule:e.getRule,class:e.getWrapperClass,ref:"elRef",onOptionsChange:e.handleOptionsChange,onPressEnter:e.handleEnter}),null,16,["component","popoverVisible","ruleMessage","rule","class","onOptionsChange","onPressEnter"])]),e.getRowEditable?_e("",!0):(H(),q("div",_o,[h(c,{class:"mx-2 cursor-pointer",title:"保存"},{default:w(()=>[h(u,{onClick:e.handleSubmit},null,8,["onClick"])]),_:1}),h(c,{class:"mx-2 cursor-pointer",title:"取消"},{default:w(()=>[h(m,{onClick:e.handleCancel},null,8,["onClick"])]),_:1})]))])),[[L,e.onClickOutside]]):(H(),q("div",{key:1,class:"flex items-center editable-cell-content",onClick:t[0]||(t[0]=(...R)=>e.handleEdit&&e.handleEdit(...R))},[ae(Te(e.getValues)+" ",1),e.column.editRow?_e("",!0):(H(),$e(c,{key:0,class:"ml-1 edit-icon"},{default:w(()=>[h(y)]),_:1}))]))])}const ko=Le(vo,[["render",wo]]);function yo(e){return(t,n)=>{const s=e.key,o=t[s];return t.onEdit=(l,f=!1)=>U(this,null,function*(){var u,c;return f||(t.editable=l),!l&&f?(yield(u=t.onSubmitEdit)==null?void 0:u.call(t))?(t.editable=!1,!0):!1:(!l&&!f&&((c=t.onCancelEdit)==null||c.call(t)),!0)}),j(ko,{value:o,record:t,column:e,index:n})}}function So(e){const t=z(a(e).columns);let n=a(e).columns;const s=F(()=>{const r=fe(a(t));return c(e,r),r||[]}),{hasPermission:o}=Mt();function l(r){const g=r.ifShow;let C=!0;return A(g)&&(C=g),ie(g)&&(C=g(r)),C}const f=(r,g)=>j(ze,null,{trigger:()=>r,default:()=>g}),u=F(()=>{const r=a(s);return fe(r).filter(C=>o(C.auth)&&l(C)).map(C=>{C.ellipsis=typeof C.ellipsis=="undefined"?{tooltip:!0}:!1;const{edit:d}=C;if(d&&(C.render=yo(C),d)){const p=C.title;C.title=()=>f(j("div",{class:"flex items-center"},[j("span",{style:{"margin-right":"5px"}},p),j(we,{size:14},{default:()=>j(nt)})]),"该列可编辑")}return C})});ke(()=>a(e).columns,r=>{t.value=r,n=r});function c(r,g){const{actionColumn:C}=a(r);C&&!g.find(d=>d.key==="action")&&g.push(O({},C))}function m(r){const g=fe(r);if(!se(g))return;if(!g.length){t.value=[];return}const C=n.map(d=>d.key);if(!xe(g[0]))t.value=g;else{const d=[];n.forEach(p=>{r.includes(p.key)&&d.push(O({},p))}),mn(C,g)||d.sort((p,k)=>C.indexOf(p.key)-C.indexOf(k.key)),t.value=d}}function y(){return ge(a(s)).map(g=>Q(O({},g),{title:g.title,key:g.key,fixed:g.fixed||void 0}))}function L(r){return r?n.map(g=>g.key):n}function R(r,g){!r||!g||n.forEach(C=>{if(C.key===r){Object.assign(C,g);return}})}return{getColumnsRef:s,getCacheColumns:L,setCacheColumnsField:R,setColumns:m,getColumns:y,getPageColumns:u}}const{table:No}=on,{apiSetting:Do,defaultPageSize:Oo,pageSizes:xo}=No,To=Oo,de=Do,Lo=xo;function $o(e,{getPaginationInfo:t,setPagination:n,setLoading:s,tableData:o},l){const f=z([]);be(()=>{o.value=a(f)}),ke(()=>a(e).dataSource,()=>{const{dataSource:r}=a(e);r&&(f.value=r)},{immediate:!0});const u=F(()=>{const{rowKey:r}=a(e);return r||(()=>"key")}),c=F(()=>{const r=a(f);return!r||r.length===0?a(f):a(f)});function m(r){return U(this,null,function*(){try{s(!0);const{request:g,pagination:C,beforeRequest:d,afterRequest:p}=a(e);if(!g)return;const k=de.pageField,b=de.sizeField,I=de.totalField,K=de.listField,M=de.countField;let W={};const{page:te=1,pageSize:Z=10}=a(t);A(C)&&!C||A(t)?W={}:(W[k]=r&&r[k]||te,W[b]=Z);let i=O(O({},W),r);d&&ie(d)&&(i=(yield d(i))||i);const v=yield g(i),_=v[I],T=v[k],S=v[M],P=v[K]?v[K]:[];if(_){const $=Math.ceil(S/Z);if(te>$)return n({page:$,itemCount:S}),yield m(r)}let x=v[K]?v[K]:[];p&&ie(p)&&(x=(yield p(x))||x),f.value=x,n({page:T,pageCount:_,itemCount:S}),r&&r[k]&&n({page:r[k]||1}),l("fetch-success",{items:a(x),resultTotal:_})}catch(g){console.error(g),l("fetch-error",g),f.value=[],n({pageCount:0})}finally{s(!1)}})}Je(()=>{setTimeout(()=>{m()},16)});function y(r){f.value=r}function L(){return c.value}function R(r){return U(this,null,function*(){yield m(r)})}return{fetch:m,getRowKey:u,getDataSourceRef:c,getDataSource:L,setTableData:y,reload:R}}function zo(e){const t=z({}),n=z(!0);ke(()=>a(e).pagination,c=>{!A(c)&&c&&(t.value=O(O({},a(t)),c!=null?c:{}))});const s=F(()=>{const{pagination:c}=a(e);return!a(n)||A(c)&&!c?!1:O(O({page:1,pageSize:To,pageSizes:Lo,showSizePicker:!0,showQuickJumper:!0,prefix:m=>`共 ${m.itemCount} 条`},A(c)?{}:c),a(t))});function o(c){const m=a(s);t.value=O(O({},A(m)?{}:m),c)}function l(){return a(s)}function f(){return a(n)}function u(c){return U(this,null,function*(){n.value=c})}return{getPagination:l,getPaginationInfo:s,setShowPagination:u,getShowPagination:f,setPagination:o}}const Fo=Q(O({},et.props),{title:{type:String,default:null},titleTooltip:{type:String,default:null},size:{type:String,default:"medium"},dataSource:{type:[Object],default:()=>[]},columns:{type:[Array],default:()=>[],required:!0},beforeRequest:{type:Function,default:null},request:{type:Function,default:null},afterRequest:{type:Function,default:null},rowKey:{type:[String,Function],default:void 0},pagination:{type:[Object,Boolean],default:()=>{}},showPagination:{type:[String,Boolean],default:"auto"},actionColumn:{type:Object,default:null},canResize:he.bool.def(!0),resizeHeightOffset:he.number.def(0),striped:he.bool.def(!1)});function Ro(e,t=150,n){let s=()=>{e()};s=ln(s,t);const l=()=>{window.addEventListener("resize",s)},f=()=>{window.removeEventListener("resize",s)};return sn(()=>{l()}),an(()=>{f()}),[l,f]}const Po={class:"table-toolbar"},Eo={class:"flex items-center table-toolbar-left"},Vo={key:0,class:"table-toolbar-left-title"},Io={class:"flex items-center leading-none table-toolbar-right"},Ho={class:"mr-2 table-toolbar-right-icon"},Ao={class:"table-toolbar-right-icon"},Bo={class:"s-table"},Mo=X({__name:"Table",props:O({},Fo),emits:["fetch-success","fetch-error","update:checked-row-keys","edit-end","edit-cancel","edit-row-end","edit-change"],setup(e,{expose:t,emit:n}){const s=[{type:"menu",label:"紧凑",key:"small"},{type:"menu",label:"默认",key:"medium"},{type:"menu",label:"宽松",key:"large"}],o=n,l=e,f=z(150),u=z(null),c=z(null);let m;const y=z(l.striped||!1),L=z([]),R=z(),r=F(()=>O(O({},l),a(R))),g=z(a(r).size||"medium"),{getLoading:C,setLoading:d}=uo(r),{getPaginationInfo:p,setPagination:k}=zo(r),{getDataSourceRef:b,getDataSource:I,getRowKey:K,reload:M}=$o(r,{getPaginationInfo:p,setPagination:k,tableData:L,setLoading:d},o),{getPageColumns:W,setColumns:te,getColumns:Z,getCacheColumns:i,setCacheColumnsField:v}=So(r);function _(N){k({page:N}),M()}function T(N){k({page:1,pageSize:N}),M()}function S(N){g.value=N}const P=F(()=>g.value),x=F(()=>{const N=a(b),V=N.length?`${a(f)}px`:"auto";return Q(O({},a(r)),{loading:a(C),columns:ge(a(W)),rowKey:a(K),data:N,size:a(P),remote:!0,"max-height":V,title:""})}),$=F(()=>ge(a(p)));function E(N){R.value=O(O({},a(R)),N)}const G=N=>y.value=N,ee={reload:M,setColumns:te,setLoading:d,setProps:E,getColumns:Z,getDataSource:I,getPageColumns:W,getCacheColumns:i,setCacheColumnsField:v,emit:o},me=F(()=>{const{canResize:N}=a(r);return N});function le(){return U(this,null,function*(){const N=a(u);if(!N||!a(me))return;const V=N==null?void 0:N.$el,re=V.querySelector(".n-data-table-thead "),{bottomIncludeBody:ne}=mo(re),ye=64;let ce=2,Se=24;if(!A(a($)))if(m=V.querySelector(".n-data-table__pagination"),m){const Ne=m.offsetHeight;ce+=Ne||0}else ce+=28;let oe=ne-(ye+ce+Se+(l.resizeHeightOffset||0));const B=l.maxHeight;oe=B&&B<oe?B:oe,f.value=oe})}return Ro(le,280),Je(()=>{Qe(()=>{le()})}),no(Q(O({},ee),{wrapRef:c,getBindValues:x})),t(ee),(N,V)=>{const re=we,ne=ze,ye=Ge,ce=je,Se=jt,oe=et;return H(),q(Yt,null,[D("div",Po,[D("div",Eo,[l.title?(H(),q("div",Vo,[ae(Te(l.title)+" ",1),l.titleTooltip?(H(),$e(ne,{key:0,trigger:"hover"},{trigger:w(()=>[h(re,{size:"18",class:"ml-1 text-gray-400 cursor-pointer"},{default:w(()=>[h(a(nn))]),_:1})]),default:w(()=>[ae(" "+Te(l.titleTooltip),1)]),_:1})):_e("",!0)])):_e("",!0),De(N.$slots,"tableTitle",{},void 0,!0)]),D("div",Io,[De(N.$slots,"toolbar",{},void 0,!0),h(ne,{trigger:"hover"},{trigger:w(()=>[D("div",Ho,[h(ye,{value:y.value,"onUpdate:value":[V[0]||(V[0]=B=>y.value=B),G]},null,8,["value"])])]),default:w(()=>[V[3]||(V[3]=D("span",null,"表格斑马纹",-1))]),_:1}),h(ce,{vertical:""}),h(ne,{trigger:"hover"},{trigger:w(()=>[D("div",{class:"table-toolbar-right-icon",onClick:V[1]||(V[1]=(...B)=>a(M)&&a(M)(...B))},[h(re,{size:"18"},{default:w(()=>[h(a(en))]),_:1})])]),default:w(()=>[V[4]||(V[4]=D("span",null,"刷新",-1))]),_:1}),h(ne,{trigger:"hover"},{trigger:w(()=>[D("div",Ao,[h(Se,{onSelect:S,trigger:"click",options:s,value:g.value,"onUpdate:value":V[2]||(V[2]=B=>g.value=B)},{default:w(()=>[h(re,{size:"18"},{default:w(()=>[h(a(Hn))]),_:1})]),_:1},8,["value"])])]),default:w(()=>[V[5]||(V[5]=D("span",null,"密度",-1))]),_:1}),h(co)])]),D("div",Bo,[h(oe,Xe({ref_key:"tableElRef",ref:u},x.value,{striped:y.value,pagination:$.value,"onUpdate:page":_,"onUpdate:pageSize":T}),Ut({_:2},[qt(Object.keys(N.$slots),B=>({name:B,fn:w(Ne=>[De(N.$slots,B,Kt(Wt(Ne)),void 0,!0)])}))]),1040,["striped","pagination"])])],64)}}}),Go=Le(Mo,[["__scopeId","data-v-da026ba7"]]);export{Go as B};
