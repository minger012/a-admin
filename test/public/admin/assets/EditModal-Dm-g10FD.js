var T=Object.defineProperty,$=Object.defineProperties;var A=Object.getOwnPropertyDescriptors;var U=Object.getOwnPropertySymbols;var G=Object.prototype.hasOwnProperty,H=Object.prototype.propertyIsEnumerable;var q=(m,i,r)=>i in m?T(m,i,{enumerable:!0,configurable:!0,writable:!0,value:r}):m[i]=r,P=(m,i)=>{for(var r in i||(i={}))G.call(i,r)&&q(m,r,i[r]);if(U)for(var r of U(i))H.call(i,r)&&q(m,r,i[r]);return m},M=(m,i)=>$(m,A(i));var N=(m,i,r)=>new Promise((f,p)=>{var v=d=>{try{c(r.next(d))}catch(e){p(e)}},_=d=>{try{c(r.throw(d))}catch(e){p(e)}},c=d=>d.done?f(d.value):Promise.resolve(d.value).then(v,_);c((r=r.apply(m,i)).next())});import{f as J}from"./plan-vryGIZvw.js";import{d as K,u as L,r as k,O as w,aa as Q,o as B,x as V,w as o,j as u,i as y,a as O,y as W,z as X,U as Y,l as Z,C as ee,D as le,k as ae,_ as te,B as ue,E as ne,n as se}from"./index--W9FB2Si.js";const re={class:"expected-profit"},ie={class:"profit-value"},oe=K({__name:"EditModal",props:{show:{type:Boolean},data:{}},emits:["update:show","success"],setup(m,{emit:i}){const r=m,f=i,p=L(),v=k(null),_=k(!1),c=k(0),d=w({get:()=>r.show,set:a=>f("update:show",a)}),e=k({id:0,show_num:0,click_num:0,click_price:0,cd:0,min:0,max:0,rate:0,state:0,remarks:"",money:0}),g=w(()=>e.value.money*e.value.rate/100),R=w(()=>{const a=c.value;return[{label:"待投放",value:0},{label:"匹配中",value:1},{label:"投放中",value:2},{label:"投放失败",value:3},{label:"等待结算",value:4},{label:"结算成功",value:5}].map(t=>{let n=!1;return a===0?n=t.value!==0&&t.value!==3:a===1?n=t.value!==1&&t.value!==2&&t.value!==3:a===4?n=t.value!==4&&t.value!==5:n=t.value!==a,M(P({},t),{disabled:n})})}),S={show_num:{required:!0,type:"number",message:"请输入展示数",trigger:"blur"},click_num:{required:!0,type:"number",message:"请输入点击数",trigger:"blur"},click_price:{required:!0,type:"number",message:"请输入点击单价",trigger:"blur"},cd:{required:!0,type:"number",message:"请输入消耗时间",trigger:"blur"},min:{required:!0,type:"number",message:"请输入最低投放金额",trigger:"blur"},max:{required:!0,type:"number",message:"请输入最高投放金额",trigger:"blur"},rate:{required:!0,type:"number",message:"请输入投放利润率",trigger:"blur"},state:{required:!0,type:"number",message:"请选择投放状态",trigger:"change"}};Q(()=>r.data,a=>{a&&(c.value=a.state,e.value={id:a.id,show_num:a.show_num,click_num:a.click_num,click_price:a.click_price,cd:a.cd,min:a.min,max:a.max,rate:a.rate,state:a.state,remarks:a.remarks||"",money:a.money})},{immediate:!0});function x(){if(e.value.money>0&&e.value.click_num>0&&e.value.click_price>0){const l=e.value.click_num*e.value.click_price/e.value.money*100;e.value.rate=Number(l.toFixed(2))}}function D(){if(g.value>0){const t=Math.random()*1.9+.1,n=Math.ceil(g.value/t),h=Math.random()*.15+.05,b=Math.ceil(n/h);e.value.show_num=b,e.value.click_num=n,e.value.click_price=Number(t.toFixed(2))}}function E(){return N(this,null,function*(){var a,l;try{yield(a=v.value)==null?void 0:a.validate(),_.value=!0;const t={id:e.value.id,show_num:e.value.show_num,click_num:e.value.click_num,click_price:e.value.click_price,cd:e.value.cd,min:e.value.min,max:e.value.max,rate:e.value.rate,state:e.value.state,remarks:e.value.remarks},n=yield J(t);n.code===1?(p.success("保存成功"),(l=v.value)==null||l.restoreValidation(),f("success"),d.value=!1):p.error(n.msg||"保存失败")}catch(t){console.error("表单验证失败:",t)}finally{_.value=!1}})}function F(){var a;d.value=!1,(a=v.value)==null||a.restoreValidation()}return(a,l)=>{const t=Y,n=Z,h=ee,b=le,j=ae,z=te,C=ue,I=ne;return B(),V(I,{show:d.value,"onUpdate:show":l[9]||(l[9]=s=>d.value=s),preset:"card",title:"编辑用户计划",style:{width:"500px"},"mask-closable":!1},{footer:o(()=>[u(b,{justify:"end"},{default:o(()=>[u(C,{onClick:F},{default:o(()=>l[11]||(l[11]=[y("取消")])),_:1}),u(C,{type:"primary",onClick:E,loading:_.value},{default:o(()=>l[12]||(l[12]=[y("保存")])),_:1},8,["loading"])]),_:1})]),default:o(()=>[u(z,{ref_key:"formRef",ref:v,model:e.value,rules:S,"label-placement":"left","label-width":"120"},{default:o(()=>[u(n,{label:"展示数",path:"show_num"},{default:o(()=>[u(t,{value:e.value.show_num,"onUpdate:value":l[0]||(l[0]=s=>e.value.show_num=s),min:0,placeholder:"请输入展示数",style:{width:"100%"}},null,8,["value"])]),_:1}),u(n,{label:"点击数",path:"click_num"},{default:o(()=>[u(t,{value:e.value.click_num,"onUpdate:value":[l[1]||(l[1]=s=>e.value.click_num=s),x],min:0,placeholder:"请输入点击数",disabled:c.value!==0&&c.value!==1,style:{width:"100%"}},null,8,["value","disabled"])]),_:1}),u(n,{label:"投放状态",path:"state"},{default:o(()=>[u(h,{value:e.value.state,"onUpdate:value":l[2]||(l[2]=s=>e.value.state=s),options:R.value,placeholder:"请选择投放状态"},null,8,["value","options"])]),_:1}),u(n,{label:"点击单价",path:"click_price"},{default:o(()=>[u(t,{value:e.value.click_price,"onUpdate:value":[l[3]||(l[3]=s=>e.value.click_price=s),x],min:0,precision:2,placeholder:"请输入点击单价",disabled:c.value!==0&&c.value!==1,style:{width:"100%"}},null,8,["value","disabled"])]),_:1}),u(n,{label:"消耗时间(分钟)",path:"cd"},{default:o(()=>[u(t,{value:e.value.cd,"onUpdate:value":l[4]||(l[4]=s=>e.value.cd=s),min:0,placeholder:"请输入消耗时间",style:{width:"100%"}},null,8,["value"])]),_:1}),u(n,{label:"最低投放金额",path:"min"},{default:o(()=>[u(t,{value:e.value.min,"onUpdate:value":l[5]||(l[5]=s=>e.value.min=s),min:0,disabled:c.value!==0,placeholder:"请输入最低投放金额",style:{width:"100%"}},null,8,["value","disabled"])]),_:1}),u(n,{label:"最高投放金额",path:"max"},{default:o(()=>[u(t,{value:e.value.max,"onUpdate:value":l[6]||(l[6]=s=>e.value.max=s),min:0,disabled:c.value!==0,placeholder:"请输入最高投放金额",style:{width:"100%"}},null,8,["value","disabled"])]),_:1}),u(n,{label:"投放利润率(%)",path:"rate"},{default:o(()=>[u(b,null,{default:o(()=>[u(t,{value:e.value.rate,"onUpdate:value":[l[7]||(l[7]=s=>e.value.rate=s),D],min:0,disabled:c.value!==0&&c.value!==1,placeholder:"请输入投放利润率",style:{width:"200px"}},null,8,["value","disabled"]),O("span",re,[l[10]||(l[10]=y(" 预期利润: ")),O("span",ie,"¥"+W(g.value.toFixed(2)),1)])]),_:1})]),_:1}),e.value.state===3?(B(),V(n,{key:0,label:"失败备注",path:"remarks"},{default:o(()=>[u(j,{value:e.value.remarks,"onUpdate:value":l[8]||(l[8]=s=>e.value.remarks=s),type:"textarea",placeholder:"请输入失败备注",rows:3},null,8,["value"])]),_:1})):X("",!0)]),_:1},8,["model"])]),_:1},8,["show"])}}}),ve=se(oe,[["__scopeId","data-v-1ef39caa"]]);export{ve as default};
