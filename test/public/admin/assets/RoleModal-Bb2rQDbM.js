var I=Object.defineProperty,L=Object.defineProperties;var O=Object.getOwnPropertyDescriptors;var x=Object.getOwnPropertySymbols;var P=Object.prototype.hasOwnProperty,S=Object.prototype.propertyIsEnumerable;var M=(e,a,l)=>a in e?I(e,a,{enumerable:!0,configurable:!0,writable:!0,value:l}):e[a]=l,T=(e,a)=>{for(var l in a||(a={}))P.call(a,l)&&M(e,l,a[l]);if(x)for(var l of x(a))S.call(a,l)&&M(e,l,a[l]);return e},B=(e,a)=>L(e,O(a));var C=(e,a,l)=>new Promise((v,_)=>{var r=o=>{try{p(l.next(o))}catch(u){_(u)}},s=o=>{try{p(l.throw(o))}catch(u){_(u)}},p=o=>o.done?v(o.value):Promise.resolve(o.value).then(r,s);p((l=l.apply(e,a)).next())});import{a as z,e as G}from"./role-CrdDRdET.js";import{d as H,u as J,r as y,b as Q,O as W,o as X,x as Y,w as c,j as i,i as R,h as Z,k as $,l as ee,bB as le,_ as ae,B as ne,D as de,E as te,n as oe}from"./index-FB6W5mBG.js";const ie=[{id:1,pid:0,label:"管理员管理",key:"1",children:[{id:101,pid:1,label:"角色管理",key:"101"},{id:102,pid:1,label:"用户管理",key:"102"}]},{id:2,pid:0,label:"产品库",key:"2",children:[{id:201,pid:2,label:"产品库",key:"201"}]},{id:3,pid:0,label:"计划库",key:"3",children:[{id:301,pid:3,label:"计划管理",key:"301"}]},{id:4,pid:0,label:"优惠券",key:"4",children:[{id:401,pid:4,label:"优惠券库",key:"401"},{id:402,pid:4,label:"用户优惠券",key:"402"}]},{id:5,pid:0,label:"授权码",key:"5",children:[{id:501,pid:5,label:"授权码管理",key:"501"}]},{id:6,pid:0,label:"财务管理",key:"6",children:[{id:601,pid:6,label:"充值记录",key:"601"},{id:602,pid:6,label:"提现记录",key:"602"},{id:603,pid:6,label:"资金明细",key:"603"}]},{id:7,pid:0,label:"用户计划管理",key:"7",children:[{id:701,pid:7,label:"用户计划列表",key:"701"}]},{id:8,pid:0,label:"系统设置",key:"8",children:[]},{id:9,pid:0,label:"数据统计",key:"9",children:[{id:901,pid:9,label:"注册统计",key:"901"},{id:902,pid:9,label:"充值提现统计",key:"902"}]},{id:10,pid:0,label:"用户管理",key:"10",children:[{id:1001,pid:10,label:"用户管理",key:"1001"}]},{id:11,pid:0,label:"用户反馈",key:"11",children:[{id:1101,pid:11,label:"用户通知",key:"1101"}]}];function se(e){return e?e.split(","):[]}function K(e){return e.join(",")}const ue=H({__name:"RoleModal",emits:["reloadTable"],setup(e,{expose:a,emit:l}){const v=l,_=J(),r=y(!1),s=y("add"),p=y(),o=y(!1),u=y([]),n=Q({id:null,name:"",desc:"",auth:""}),U=W(()=>s.value==="add"?"新增角色":"编辑角色"),V={name:{required:!0,trigger:["blur","input"],message:"请输入角色名称"}};function j(d){u.value=d,n.auth=K(d)}function A(){s.value="add",h(),r.value=!0}function D(d){s.value="edit",h(),n.id=d.id,n.name=d.name,n.desc=d.desc||"",n.auth=d.auth||"",u.value=se(d.auth),r.value=!0}function h(){n.id=null,n.name="",n.desc="",n.auth="",u.value=[],p.value&&p.value.restoreValidation()}function g(){r.value=!1}function E(){var d;(d=p.value)==null||d.validate(t=>C(this,null,function*(){if(!t){o.value=!0;try{const m=s.value==="add"?z:G,f=B(T({},n),{auth:K(u.value)}),b=yield m(f);b.code==1?(_.success(s.value==="add"?"添加成功":"编辑成功"),v("reloadTable"),g()):_.error(b.msg||(s.value==="add"?"添加失败":"编辑失败"))}catch(m){_.error(s.value==="add"?"添加失败":"编辑失败")}finally{o.value=!1}}}))}return a({openAddModal:A,openEditModal:D}),(d,t)=>{const m=$,f=ee,b=le,F=ae,w=ne,N=de,q=te;return X(),Y(q,{show:r.value,"onUpdate:show":t[2]||(t[2]=k=>r.value=k),"show-icon":!1,preset:"dialog",title:U.value,"mask-closable":!1},{action:c(()=>[i(N,null,{default:c(()=>[i(w,{onClick:g},{default:c(()=>t[3]||(t[3]=[R("取消")])),_:1}),i(w,{type:"primary",loading:o.value,onClick:E},{default:c(()=>t[4]||(t[4]=[R("确定")])),_:1},8,["loading"])]),_:1})]),default:c(()=>[i(F,{model:n,rules:V,ref_key:"formRef",ref:p,"label-placement":"left","label-width":80,class:"py-4"},{default:c(()=>[i(f,{label:"角色名称",path:"name"},{default:c(()=>[i(m,{placeholder:"请输入角色名称",value:n.name,"onUpdate:value":t[0]||(t[0]=k=>n.name=k)},null,8,["value"])]),_:1}),i(f,{label:"说明",path:"desc"},{default:c(()=>[i(m,{type:"textarea",placeholder:"请输入说明",value:n.desc,"onUpdate:value":t[1]||(t[1]=k=>n.desc=k)},null,8,["value"])]),_:1}),i(f,{label:"权限",path:"auth"},{default:c(()=>[i(b,{"block-line":"",cascade:"",checkable:"","virtual-scroll":!0,data:Z(ie),"checked-keys":u.value,style:{"max-height":"400px",overflow:"auto"},"onUpdate:checkedKeys":j},null,8,["data","checked-keys"])]),_:1})]),_:1},8,["model"])]),_:1},8,["show","title"])}}}),_e=oe(ue,[["__scopeId","data-v-1e548ee0"]]);export{_e as default};
