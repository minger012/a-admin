var J=Object.defineProperty;var N=Object.getOwnPropertySymbols;var K=Object.prototype.hasOwnProperty,Z=Object.prototype.propertyIsEnumerable;var B=(_,r,s)=>r in _?J(_,r,{enumerable:!0,configurable:!0,writable:!0,value:s}):_[r]=s,$=(_,r)=>{for(var s in r||(r={}))K.call(r,s)&&B(_,s,r[s]);if(N)for(var s of N(r))Z.call(r,s)&&B(_,s,r[s]);return _};var O=(_,r,s)=>new Promise((f,c)=>{var C=p=>{try{k(s.next(p))}catch(w){c(w)}},M=p=>{try{k(s.throw(p))}catch(w){c(w)}},k=p=>p.done?f(p.value):Promise.resolve(p.value).then(C,M);k((s=s.apply(_,r)).next())});import ee from"./RankingList-BNubLpTU.js";import{f as te}from"./statistics-Cim6qAMZ.js";import{S as ae}from"./SearchOutlined-xLFF1osG.js";import{d as le,u as ne,r as b,t as ue,o as z,x as V,w as u,j as a,a as v,y as I,c as se,a6 as oe,i as U,X as re,z as ie,h as de,s as D,v as S,D as _e,B as ce,W as pe,k as me,l as ge,C as ve,N as fe,_ as ye,q as he,$ as be,n as ke}from"./index-C4bwFPRU.js";import{_ as we}from"./ButtonGroup-BJvOPcgS.js";const De={class:"summary-item"},Se={class:"summary-value"},Ce={class:"summary-item"},Me={class:"summary-value"},Te={class:"ranking-box"},xe=le({__name:"UserRechargeStats",setup(_){const r=ne(),s=b(!1),f=b("本年"),c=b(null),C=[{label:"今日",value:"今日"},{label:"本周",value:"本周"},{label:"本月",value:"本月"},{label:"本年",value:"本年"},{label:"自定义",value:"自定义"}],M={1:{label:"真实充值",type:"info"},2:{label:"虚拟充值",type:"warning"},3:{label:"系统赠送",type:"success"}},k={0:{label:"失败",type:"error"},1:{label:"成功",type:"success"}},p={0:{label:"未退款",type:"default"},1:{label:"退回成功",type:"success"},2:{label:"退回失败",type:"error"}},w=[{label:"真实充值",value:1},{label:"虚拟充值",value:2},{label:"系统赠送",value:3}],Y=[{label:"成功",value:1},{label:"失败",value:0}],P=[{label:"未退款",value:0},{label:"退回成功",value:1},{label:"退回失败",value:2}],n=b({user_id:"",nickname:"",recharge_type:null,status:null,refund_status:null}),m=b({total_recharge_count:0,total_recharge_amount:0,top_users:[],detail_list:[]}),j=[{title:"ID",key:"id",width:60,fixed:"left"},{title:"用户ID",key:"user_id",width:80},{title:"用户昵称",key:"nickname",width:100},{title:"FB ID",key:"fb_id",width:160},{title:"充值金额",key:"recharge_amount",width:100,render(t){return`¥${t.recharge_amount}`}},{title:"充值方式",key:"payment_method",width:100,render(t){return D(S,{type:"info",bordered:!1,size:"small"},{default:()=>t.payment_method})}},{title:"状态",key:"status",width:80,render(t){const e=k[t.status];return D(S,{type:e.type,bordered:!1,size:"small"},{default:()=>e.label})}},{title:"充值类型",key:"recharge_type",width:100,render(t){const e=M[t.recharge_type]||{};return D(S,{type:e.type,bordered:!1,size:"small"},{default:()=>e.label})}},{title:"虚拟充值退款状态",key:"refund_status",width:140,render(t){const e=p[t.refund_status]||{};return D(S,{type:e.type,bordered:!1,size:"small"},{default:()=>e.label})}},{title:"用户备注",key:"user_remark",width:120,ellipsis:{tooltip:!0}},{title:"后台备注",key:"admin_remark",width:120,ellipsis:{tooltip:!0}},{title:"创建时间",key:"create_time",width:160}],i=b({page:1,pageSize:10,pageCount:1,itemCount:0,showSizePicker:!0,pageSizes:[10,20,50],onChange:void 0,onUpdatePageSize:void 0});function q(t){return new Intl.NumberFormat("zh-CN",{minimumFractionDigits:2,maximumFractionDigits:2}).format(t)}function E(){const t=new Date,e=new Date(t.getFullYear(),t.getMonth(),t.getDate()),l=new Date(t.getFullYear(),t.getMonth(),t.getDate(),23,59,59,999);if(c.value&&c.value.length===2){const d=new Date(c.value[0]);d.setHours(0,0,0,0);const y=new Date(c.value[1]);return y.setHours(23,59,59,999),{start_date:Math.floor(d.getTime()/1e3),end_date:Math.floor(y.getTime()/1e3)}}switch(f.value){case"今日":return{start_date:Math.floor(e.getTime()/1e3),end_date:Math.floor(l.getTime()/1e3)};case"本周":const d=new Date(e);return d.setDate(e.getDate()-e.getDay()),{start_date:Math.floor(d.getTime()/1e3),end_date:Math.floor(l.getTime()/1e3)};case"本月":const y=new Date(t.getFullYear(),t.getMonth(),1);return{start_date:Math.floor(y.getTime()/1e3),end_date:Math.floor(l.getTime()/1e3)};case"本年":default:const T=new Date(t.getFullYear(),0,1);return{start_date:Math.floor(T.getTime()/1e3),end_date:Math.floor(l.getTime()/1e3)}}}function g(){return O(this,null,function*(){try{s.value=!0;const t=E(),e=$({limit:String(i.value.pageSize),page:String(i.value.page)},t);n.value.user_id&&(e.user_id=parseInt(n.value.user_id)),n.value.nickname&&(e.nickname=n.value.nickname),n.value.recharge_type!==null&&(e.recharge_type=n.value.recharge_type),n.value.status!==null&&(e.status=n.value.status),n.value.refund_status!==null&&(e.virtual_state=String(n.value.refund_status));const l=yield te(e);l.code===1&&l.data?(m.value.total_recharge_count=l.data.total_withdraw_count||0,m.value.total_recharge_amount=l.data.total_withdraw_amount||0,m.value.top_users=l.data.top_users||[],m.value.detail_list=l.data.detail_list||[],l.data.pagination&&(i.value.page=l.data.pagination.page,i.value.pageCount=l.data.pagination.pageCount,i.value.itemCount=l.data.pagination.itemCount,i.value.onChange=d=>{i.value.page=d,g()},i.value.onUpdatePageSize=d=>{i.value.pageSize=d,i.value.page=1,g()})):r.error(l.message||"加载数据失败")}catch(t){console.error("加载数据失败:",t),r.error("加载数据失败")}finally{s.value=!1}})}function H(t){f.value=t,t!=="自定义"&&(c.value=null),g()}function L(t){t&&g()}function Q(){i.value.page=1,g()}function W(){n.value={user_id:"",nickname:"",recharge_type:null,status:null,refund_status:null},i.value.page=1,g()}return ue(()=>{g()}),(t,e)=>{const l=_e,d=ce,y=we,T=pe,F=me,h=ge,x=ve,X=fe,A=ye,R=he,G=be;return z(),V(l,{vertical:"",size:"large"},{default:u(()=>[a(l,{justify:"space-between",align:"start"},{default:u(()=>[a(l,{size:"large"},{default:u(()=>[v("div",De,[e[6]||(e[6]=v("div",{class:"summary-label"},"总充值次数",-1)),v("div",Se,I(m.value.total_recharge_count)+"次",1)]),v("div",Ce,[e[7]||(e[7]=v("div",{class:"summary-label"},"总充值金额",-1)),v("div",Me,"￥"+I(q(m.value.total_recharge_amount)),1)])]),_:1}),v("div",Te,[a(ee,{title:"充值排行榜",items:m.value.top_users},null,8,["items"])])]),_:1}),a(l,null,{default:u(()=>[a(y,null,{default:u(()=>[(z(),se(re,null,oe(C,o=>a(d,{key:o.value,type:f.value===o.value?"primary":"default",onClick:ze=>H(o.value)},{default:u(()=>[U(I(o.label),1)]),_:2},1032,["type","onClick"])),64))]),_:1}),f.value==="自定义"?(z(),V(T,{key:0,value:c.value,"onUpdate:value":[e[0]||(e[0]=o=>c.value=o),L],type:"daterange",clearable:""},null,8,["value"])):ie("",!0)]),_:1}),a(R,{bordered:!1},{default:u(()=>[a(A,{inline:"","label-placement":"left"},{default:u(()=>[a(h,{label:"用户ID"},{default:u(()=>[a(F,{value:n.value.user_id,"onUpdate:value":e[1]||(e[1]=o=>n.value.user_id=o),placeholder:"请输入",style:{width:"150px"},clearable:""},null,8,["value"])]),_:1}),a(h,{label:"用户昵称"},{default:u(()=>[a(F,{value:n.value.nickname,"onUpdate:value":e[2]||(e[2]=o=>n.value.nickname=o),placeholder:"请输入",style:{width:"150px"},clearable:""},null,8,["value"])]),_:1}),a(h,{label:"充值类型"},{default:u(()=>[a(x,{value:n.value.recharge_type,"onUpdate:value":e[3]||(e[3]=o=>n.value.recharge_type=o),options:w,placeholder:"请选择",style:{width:"150px"},clearable:""},null,8,["value"])]),_:1}),a(h,{label:"状态"},{default:u(()=>[a(x,{value:n.value.status,"onUpdate:value":e[4]||(e[4]=o=>n.value.status=o),options:Y,placeholder:"请选择",style:{width:"150px"},clearable:""},null,8,["value"])]),_:1}),a(h,{label:"虚拟充值退款状态"},{default:u(()=>[a(x,{value:n.value.refund_status,"onUpdate:value":e[5]||(e[5]=o=>n.value.refund_status=o),options:P,placeholder:"请选择",style:{width:"150px"},clearable:""},null,8,["value"])]),_:1}),a(h,null,{default:u(()=>[a(l,null,{default:u(()=>[a(d,{type:"primary",onClick:Q},{icon:u(()=>[a(X,null,{default:u(()=>[a(de(ae))]),_:1})]),default:u(()=>[e[8]||(e[8]=U(" 查询 "))]),_:1}),a(d,{onClick:W},{default:u(()=>e[9]||(e[9]=[U("重置")])),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),a(R,{bordered:!1},{default:u(()=>[a(G,{columns:j,data:m.value.detail_list,pagination:i.value,bordered:!1,"scroll-x":2e3,loading:s.value},null,8,["data","pagination","loading"])]),_:1})]),_:1})}}}),$e=ke(xe,[["__scopeId","data-v-dcb63db9"]]);export{$e as default};
