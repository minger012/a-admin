var T=Object.defineProperty;var I=Object.getOwnPropertySymbols;var v=Object.prototype.hasOwnProperty,C=Object.prototype.propertyIsEnumerable;var S=(e,a,t)=>a in e?T(e,a,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[a]=t,w=(e,a)=>{for(var t in a||(a={}))v.call(a,t)&&S(e,t,a[t]);if(I)for(var t of I(a))C.call(a,t)&&S(e,t,a[t]);return e};var k=(e,a,t)=>new Promise((b,h)=>{var p=s=>{try{g(t.next(s))}catch(u){h(u)}},D=s=>{try{g(t.throw(s))}catch(u){h(u)}},g=s=>s.done?b(s.value):Promise.resolve(s.value).then(p,D);g((t=t.apply(e,a)).next())});import{B as F}from"./Table-BxPYim8H.js";import{s as L,v as P,d as M,u as z,r as R,c as E,j as c,w as d,X as j,q,o as O,h as _,N as V,i as $,B as W,D as X}from"./index--W9FB2Si.js";import{_ as A}from"./BasicForm-QjO4c9-O.js";import{u as G}from"./useForm-BHF_BjGC.js";import{u as x}from"./coupon-BE4e-etT.js";import{u as y,w as H}from"./xlsx-DaVhO591.js";import{D as J}from"./DownloadOutlined-B-LhstHD.js";import"./vuedraggable.umd-B1pj_Zeo.js";import"./useDesignSetting-BH2ledVX.js";import"./propTypes-DHDRA3s2.js";import"./componentSetting-CQq0JJwW.js";import"./index-Tz6qLsBu.js";import"./DownOutlined-CqNoZsnt.js";const K=[{label:"全部",value:""},{label:"未使用",value:1},{label:"已使用",value:2}];function Q(e){return L(P,{type:e===1?"warning":"success",bordered:!1},{default:()=>e===1?"未使用":"已使用"})}const U=[{title:"ID",key:"id",width:80},{title:"用户ID",key:"uid",width:120},{title:"用户简称",key:"user_name",width:150,render(e){return e.user_name||"-"}},{title:"优惠券ID",key:"cid",width:100},{title:"FB_ID",key:"fb_id",width:150},{title:"优惠券名称",key:"name",width:180,ellipsis:{tooltip:!0}},{title:"状态",key:"state",width:100,render(e){return Q(e.state)}},{title:"过期时间",key:"end_time",width:160,render(e){return e.end_time?new Date(e.end_time*1e3).toLocaleString():"-"}},{title:"更新时间",key:"update_time",width:160,render(e){return e.update_time?new Date(e.update_time*1e3).toLocaleString():"-"}},{title:"创建时间",key:"create_time",width:160,render(e){return e.create_time?new Date(e.create_time*1e3).toLocaleString():"-"}}],ue=M({__name:"index",setup(e){const a=z(),t=R(),b=[{field:"fb_id",component:"NInput",label:"FB ID",componentProps:{placeholder:"请输入FB ID"}},{field:"uid",component:"NInput",label:"用户ID",componentProps:{placeholder:"请输入用户ID"}},{field:"cid",component:"NInput",label:"优惠券ID",componentProps:{placeholder:"请输入优惠券ID"}},{field:"state",component:"NSelect",label:"状态",componentProps:{placeholder:"请选择",options:K}},{field:"dateRange",component:"NDatePicker",label:"创建时间",componentProps:{type:"datetimerange",clearable:!0,style:{width:"100%"}}}],[h]=G({gridProps:{cols:"1 s:1 m:2 l:3 xl:4 2xl:4"},labelWidth:80,schemas:b}),p=R({}),D=f=>k(this,[f],function*({page:l,pageSize:n}){const r=w({page:String(l),pageSize:String(n)},p.value);r.dateRange&&r.dateRange.length===2&&(r.sTime=Math.floor(r.dateRange[0]/1e3),r.eTime=Math.floor(r.dateRange[1]/1e3),delete r.dateRange);try{const i=(yield x(r)).data;return{list:i.list||[],page:Number(i.page)||1,pageCount:Number(i.total_page)||0,pageSize:Number(i.page_size)||10,itemCount:Number(i.total)||0}}catch(m){return a.error("获取用户优惠券列表失败"),{list:[],page:1,pageCount:0,pageSize:10,itemCount:0}}});function g(l){p.value=l,u()}function s(){p.value={},u()}function u(){t.value.reload()}function N(){return k(this,null,function*(){let l=[];try{const n=w({page:"1",pageSize:"999999"},p.value);n.dateRange&&n.dateRange.length===2&&(n.sTime=Math.floor(n.dateRange[0]/1e3),n.eTime=Math.floor(n.dateRange[1]/1e3),delete n.dateRange),l=(yield x(n)).data.list||[]}catch(n){a.error("获取数据失败");return}if(l.length===0){a.warning("没有数据可导出");return}B(l)})}function B(l){const n={1:"未使用",2:"已使用"},f=l.map(o=>({ID:o.id,用户ID:o.uid,用户简称:o.user_name||"-",优惠券ID:o.cid,FB_ID:o.fb_id,优惠券名称:o.name,状态:n[o.state]||"-",过期时间:o.end_time?new Date(o.end_time*1e3).toLocaleString():"-",更新时间:o.update_time?new Date(o.update_time*1e3).toLocaleString():"-",创建时间:o.create_time?new Date(o.create_time*1e3).toLocaleString():"-"})),r=y.json_to_sheet(f),m=y.book_new();y.book_append_sheet(m,r,"用户优惠券列表");const i=`用户优惠券列表_${new Date().toLocaleDateString().replace(/\//g,"-")}.xlsx`;H(m,i),a.success(`导出成功，共 ${l.length} 条数据`)}return(l,n)=>{const f=q,r=W,m=X;return O(),E(j,null,[c(f,{bordered:!1},{default:d(()=>[c(_(A),{onRegister:_(h),onSubmit:g,onReset:s},null,8,["onRegister"])]),_:1}),c(f,{bordered:!1,class:"mt-3"},{default:d(()=>[c(_(F),{columns:_(U),request:D,"row-key":i=>i.id,ref_key:"actionRef",ref:t,"scroll-x":1400,striped:!0},{tableTitle:d(()=>[c(m,{class:"flex items-center"},{default:d(()=>[c(r,{onClick:N},{icon:d(()=>[c(_(V),null,{default:d(()=>[c(_(J))]),_:1})]),default:d(()=>[n[0]||(n[0]=$(" 导出 "))]),_:1})]),_:1})]),_:1},8,["columns","row-key"])]),_:1})],64)}}});export{ue as default};
