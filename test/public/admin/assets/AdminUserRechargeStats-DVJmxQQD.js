var j=Object.defineProperty;var P=Object.getOwnPropertySymbols;var A=Object.prototype.hasOwnProperty,T=Object.prototype.propertyIsEnumerable;var B=(r,s,t)=>s in r?j(r,s,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[s]=t,D=(r,s)=>{for(var t in s||(s={}))A.call(s,t)&&B(r,t,s[t]);if(P)for(var t of P(s))T.call(s,t)&&B(r,t,s[t]);return r};var x=(r,s,t)=>new Promise((i,m)=>{var h=c=>{try{n(t.next(c))}catch(v){m(v)}},w=c=>{try{n(t.throw(c))}catch(v){m(v)}},n=c=>c.done?i(c.value):Promise.resolve(c.value).then(h,w);n((t=t.apply(r,s)).next())});import{_ as q}from"./FilterBar.vue_vue_type_script_setup_true_lang-gfuIPf8k.js";import{_ as E}from"./ViewSwitch.vue_vue_type_script_setup_true_lang-BVFIkSef.js";import{b as G,c as H}from"./statistics-Cim6qAMZ.js";import{d as J,u as K,r as y,t as L,o as $,x as O,w as g,j as o,a as u,y as I,c as F,s as f,v as S,B as Q,D as W,$ as X,q as Y,n as Z}from"./index-C4bwFPRU.js";import"./admin-Bh8KwK6n.js";import"./ButtonGroup-BJvOPcgS.js";const ee={class:"summary-item"},ae={class:"summary-value"},te={class:"summary-item"},ne={class:"summary-value"},se={class:"summary-item"},le={class:"summary-value"},oe={key:0},re={class:"flex mb-4 gap-4"},ie={key:1},de=J({__name:"AdminUserRechargeStats",setup(r){const s=K(),t=y("summary"),i=y(!1),m=y({start_date:void 0,end_date:void 0,admin_username:void 0}),h={1:{label:"真实充值",type:"info"},2:{label:"虚拟充值",type:"warning"},3:{label:"系统赠送",type:"success"}},w={0:{label:"失败",type:"error"},1:{label:"成功",type:"success"}},n=y({total_recharge_count:0,total_recharge_amount:0,day_average_amount:0,type_stats:[],status_stats:[],day_stats:[],day_details:[]}),c=[{title:"充值类型",key:"type",width:120,render(a){const e=h[a.type];return f(S,{type:e.type,bordered:!1},{default:()=>e.label})}},{title:"充值笔数",key:"recharge_count",width:120},{title:"充值金额",key:"recharge_amount",width:150,render(a){return`¥${p(a.recharge_amount)}`}},{title:"占比",key:"percentage",width:100,render(a){return`${a.percentage.toFixed(2)}%`}}],v=[{title:"充值状态",key:"status",width:120,render(a){const e=w[a.status];return f(S,{type:e.type,bordered:!1},{default:()=>e.label})}},{title:"充值笔数",key:"recharge_count",width:120},{title:"充值金额",key:"recharge_amount",width:150,render(a){return`¥${p(a.recharge_amount)}`}},{title:"占比",key:"percentage",width:100,render(a){return`${a.percentage.toFixed(2)}%`}}],U=[{title:"日期",key:"date",width:150},{title:"充值笔数",key:"recharge_count",width:120},{title:"充值金额",key:"recharge_amount",width:150,render(a){return`¥${p(a.recharge_amount)}`}},{title:"操作",key:"action",width:150,render(a){return f(Q,{text:!0,type:"primary",size:"small",onClick:()=>N(a)},{default:()=>"查看明细"})}}],V=[{title:"ID",key:"id",width:80},{title:"日期",key:"date",width:120},{title:"充值类型",key:"type",width:120,render(a){const e=h[a.type];return f(S,{type:e.type,bordered:!1},{default:()=>e.label})}},{title:"充值状态",key:"status",width:100,render(a){const e=w[a.status];return f(S,{type:e.type,bordered:!1},{default:()=>e.label})}},{title:"充值笔数",key:"recharge_count",width:100},{title:"充值金额",key:"recharge_amount",width:150,render(a){return`¥${p(a.recharge_amount)}`}}],_=y({page:1,pageSize:10,pageCount:1,itemCount:0,showSizePicker:!1,onChange:void 0}),l=y({page:1,pageSize:10,pageCount:1,itemCount:0,showSizePicker:!0,pageSizes:[10,20,50],onChange:void 0,onUpdatePageSize:void 0});function p(a){return new Intl.NumberFormat("zh-CN",{minimumFractionDigits:2,maximumFractionDigits:2}).format(a)}function z(){return x(this,null,function*(){try{i.value=!0;const a=D({limit:String(_.value.pageSize),page:String(_.value.page),view_type:"summary"},m.value),e=yield G(a);e.code===1&&e.data?(n.value.total_recharge_count=e.data.total_recharge_count||0,n.value.total_recharge_amount=e.data.total_recharge_amount||0,n.value.day_average_amount=e.data.day_average_amount||0,n.value.type_stats=e.data.type_stats||[],n.value.status_stats=e.data.status_stats||[],n.value.day_stats=e.data.day_stats||[],n.value.day_details=e.data.day_details||[],e.data.pagination&&(_.value.page=e.data.pagination.page,_.value.pageCount=e.data.pagination.pageCount,_.value.itemCount=e.data.pagination.itemCount,_.value.onChange=d=>{_.value.page=d,z()})):s.error(e.message||"加载数据失败")}catch(a){console.error("加载数据失败:",a),s.error("加载数据失败")}finally{i.value=!1}})}function b(){return x(this,null,function*(){try{i.value=!0;const a=D({limit:String(l.value.pageSize),page:String(l.value.page),view_type:"detail"},m.value),e=yield H(a);e.code===1&&e.data?(n.value.day_details=e.data.day_details||[],e.data.pagination&&(l.value.page=e.data.pagination.page,l.value.pageCount=e.data.pagination.pageCount,l.value.itemCount=e.data.pagination.itemCount,l.value.onChange=d=>{l.value.page=d,b()},l.value.onUpdatePageSize=d=>{l.value.pageSize=d,l.value.page=1,b()})):s.error(e.message||"加载明细数据失败")}catch(a){console.error("加载明细数据失败:",a),s.error("加载明细数据失败")}finally{i.value=!1}})}function M(a){console.log("筛选条件:",a),m.value={start_date:a.startDate,end_date:a.endDate,admin_username:a.adminUsername},t.value==="summary"?(_.value.page=1,z()):(l.value.page=1,b())}function N(a){console.log("查看明细:",a),t.value="detail",l.value.page=1,b()}return L(()=>{z()}),(a,e)=>{const d=W,k=X,C=Y;return $(),O(d,{vertical:"",size:"large"},{default:g(()=>[o(d,{justify:"space-between",align:"start"},{default:g(()=>[o(d,{size:"large"},{default:g(()=>[u("div",ee,[e[1]||(e[1]=u("div",{class:"summary-label"},"总充值笔数",-1)),u("div",ae,I(n.value.total_recharge_count),1)]),u("div",te,[e[2]||(e[2]=u("div",{class:"summary-label"},"总充值金额",-1)),u("div",ne,"￥"+I(p(n.value.total_recharge_amount)),1)]),u("div",se,[e[3]||(e[3]=u("div",{class:"summary-label"},"日均充值金额",-1)),u("div",le,"￥"+I(p(n.value.day_average_amount)),1)])]),_:1}),o(q,{onChange:M})]),_:1}),o(d,null,{default:g(()=>[o(E,{modelValue:t.value,"onUpdate:modelValue":e[0]||(e[0]=R=>t.value=R)},null,8,["modelValue"])]),_:1}),t.value==="summary"?($(),F("div",oe,[u("div",re,[o(C,{bordered:!1,title:"充值类型统计",class:"flex-1"},{default:g(()=>[o(k,{columns:c,data:n.value.type_stats,pagination:!1,bordered:!1,loading:i.value},null,8,["data","loading"])]),_:1}),o(C,{bordered:!1,title:"充值状态统计",class:"flex-1"},{default:g(()=>[o(k,{columns:v,data:n.value.status_stats,pagination:!1,bordered:!1,loading:i.value},null,8,["data","loading"])]),_:1})]),o(C,{bordered:!1,title:"按日统计"},{default:g(()=>[o(k,{columns:U,data:n.value.day_stats,pagination:_.value,bordered:!1,loading:i.value},null,8,["data","pagination","loading"])]),_:1})])):($(),F("div",ie,[o(C,{bordered:!1,title:"明细统计"},{default:g(()=>[o(k,{columns:V,data:n.value.day_details,pagination:l.value,bordered:!1,loading:i.value},null,8,["data","pagination","loading"])]),_:1})]))]),_:1})}}}),ve=Z(de,[["__scopeId","data-v-86cb5690"]]);export{ve as default};
