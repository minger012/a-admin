var Z=Object.defineProperty;var T=Object.getOwnPropertySymbols;var ee=Object.prototype.hasOwnProperty,te=Object.prototype.propertyIsEnumerable;var P=(t,o,n)=>o in t?Z(t,o,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[o]=n,S=(t,o)=>{for(var n in o||(o={}))ee.call(o,n)&&P(t,n,o[n]);if(T)for(var n of T(o))te.call(o,n)&&P(t,n,o[n]);return t};var D=(t,o,n)=>new Promise((v,_)=>{var w=u=>{try{f(n.next(u))}catch(b){_(b)}},m=u=>{try{f(n.throw(u))}catch(b){_(b)}},f=u=>u.done?v(u.value):Promise.resolve(u.value).then(w,m);f((n=n.apply(t,o)).next())});import{B as ne}from"./Table-BsfMaboV.js";import{s as E,v as U,A as L,d as oe,u as ae,r as h,b as le,x as B,w as a,q as re,o as I,j as i,h as y,i as x,c as se,y as ie,z as M,C as ue,N as ce,B as pe,D as me,k as de,l as _e,_ as fe,E as ge}from"./index-C4bwFPRU.js";import{_ as ye}from"./BasicForm-CLt3-8U8.js";import{u as he}from"./useForm-CXmAmMFN.js";import{u as C,w as we}from"./xlsx-DaVhO591.js";import{D as be}from"./DownloadOutlined-D74mhVoi.js";import"./vuedraggable.umd-DcUfH-TH.js";import"./useDesignSetting-DbD-gdTl.js";import"./propTypes-CjHlpx3C.js";import"./componentSetting-CQq0JJwW.js";import"./index-CsSSQVOk.js";import"./DownOutlined-DA6TRB-L.js";const F=[{label:"全部",value:""},{label:"充值",value:1},{label:"提现",value:2},{label:"广告结算",value:3},{label:"广告投放",value:4},{label:"后台扣除",value:5},{label:"投资失败",value:6},{label:"提现失败",value:7}],$=[{label:"全部",value:""},{label:"增加",value:1},{label:"减少",value:2}];function ke(t){const n={1:{text:"充值",type:"success"},2:{text:"提现",type:"warning"},3:{text:"广告结算",type:"success"},4:{text:"广告投放",type:"warning"},5:{text:"后台扣除",type:"error"},6:{text:"投资失败",type:"error"},7:{text:"提现失败",type:"error"}}[t]||{text:"未知",type:"default"};return E(U,{type:n.type,bordered:!1},{default:()=>n.text})}function ve(t){return E(U,{type:t>0?"success":"error",bordered:!1},{default:()=>t>0?"增加":"减少"})}const De=[{type:"selection",fixed:"left"},{title:"ID",key:"id",width:80},{title:"用户ID",key:"uid",width:100},{title:"用户简称",key:"username",width:120},{title:"FB_ID",key:"fb_id",width:120},{title:"所属管理者",key:"admin_username",width:120},{title:"交易金额",key:"money",width:120,render(t){return`${t.cha}`}},{title:"交易类型",key:"type",width:120,render(t){return ke(t.type)}},{title:"资金方向",key:"cha",width:100,render(t){return ve(t.cha)}},{title:"计划订单编号",key:"order_no",width:150},{title:"用户优惠券ID",key:"coupon_id",width:120},{title:"优惠金额",key:"coupon_money",width:120,render(t){return t.coupon_money?`${t.coupon_money} 元`:"-"}},{title:"备注",key:"remarks",width:200},{title:"更新时间",key:"update_time",width:180,render(t){return t.update_time?new Date(t.update_time*1e3).toLocaleString():"-"}},{title:"创建时间",key:"create_time",width:180,render(t){return t.create_time?new Date(t.create_time*1e3).toLocaleString():"-"}}];function z(t){return L.Post("/admin/flow/list",t,{meta:{isReturnNativeResponse:!0}})}function xe(t){return L.Post("/admin/flow/edit",t,{meta:{isReturnNativeResponse:!0}})}const Re={key:0,class:"text-gray-500"},Le=oe({__name:"index",setup(t){const o=ae(),n=h(),v=h(),_=h(!1),w=h(!1),m=h([]),f=h({}),u=le({id:0,remarks:""}),b={remarks:{required:!0,message:"请输入备注",trigger:["blur","input"]}},q=[{field:"uid",component:"NInput",label:"用户ID",componentProps:{placeholder:"请输入用户ID"}},{field:"username",component:"NInput",label:"用户简称",componentProps:{placeholder:"请输入用户简称"}},{field:"fb_id",component:"NInput",label:"FB_ID",componentProps:{placeholder:"请输入FB_ID"}},{field:"admin_username",component:"NInput",label:"所属管理者",componentProps:{placeholder:"请输入所属管理者"}},{field:"type",component:"NSelect",label:"交易类型",componentProps:{placeholder:"请选择交易类型",options:F,clearable:!0},slot:"statusSlot"},{field:"cha",component:"NSelect",label:"资金方向",componentProps:{placeholder:"请选择资金方向",options:$,clearable:!0},slot:"chaSlot"},{field:"order_no",component:"NInput",label:"计划订单编号",componentProps:{placeholder:"请输入计划订单编号"}},{field:"timeRange",component:"NDatePicker",label:"创建时间",componentProps:{type:"daterange",clearable:!0,shortcuts:{一周内:[Date.now()-7*24*60*60*1e3,Date.now()],一个月内:[Date.now()-30*24*60*60*1e3,Date.now()],三个月内:[Date.now()-90*24*60*60*1e3,Date.now()]}}}],[O]=he({gridProps:{cols:"1 s:1 m:2 l:3 xl:4 2xl:4"},labelWidth:120,schemas:q});function V(g){return D(this,arguments,function*({page:l,pageSize:e}){const r=S({page:String(l),pageSize:String(e)},f.value);r.timeRange&&r.timeRange.length===2&&(r.sTime=Math.floor(r.timeRange[0]/1e3),r.eTime=Math.floor(r.timeRange[1]/1e3),delete r.timeRange);try{const d=(yield z(r)).data;return{list:d.list||[],page:Number(d.page)||1,pageCount:Number(d.total_page)||0,pageSize:Number(d.page_size)||10,itemCount:Number(d.total)||0}}catch(p){return o.error("获取资金明细列表失败"),{list:[],page:1,pageCount:0,pageSize:10,itemCount:0}}})}function R(){n.value.reload()}function j(){m.value=[]}function A(){return D(this,null,function*(){let l=[];if(m.value.length>0)l=n.value.getDataSource().filter(g=>m.value.includes(g.id));else try{const e=S({page:"1",pageSize:"999999"},f);if(e.timeRange&&e.timeRange.length===2){const r=e.timeRange[0]instanceof Date?e.timeRange[0]:new Date(e.timeRange[0]),p=e.timeRange[1]instanceof Date?e.timeRange[1]:new Date(e.timeRange[1]);!isNaN(r.getTime())&&!isNaN(p.getTime())&&(e.sTime=Math.floor(r.getTime()/1e3),e.eTime=Math.floor(p.getTime()/1e3)),delete e.timeRange}l=(yield z(e)).data.list||[]}catch(e){o.error("获取数据失败");return}if(l.length===0){o.warning("没有数据可导出");return}K(l)})}function K(l){const e={1:"充值",2:"提现",3:"购物",4:"退款",5:"系统调整"},g=l.map(s=>({ID:s.id,用户ID:s.uid,用户简称:s.username||"-",FB_ID:s.fb_id||"-",所属管理者:s.admin_username||"-",订单号:s.order_no||"-",交易类型:e[s.type]||"-",变动金额:s.cha>0?`+${s.cha}`:s.cha,备注:s.remarks||"-",创建时间:s.create_time?new Date(s.create_time*1e3).toLocaleString():"-"})),r=C.json_to_sheet(g),p=C.book_new();C.book_append_sheet(p,r,"资金明细");const d=`资金明细_${new Date().toLocaleDateString().replace(/\//g,"-")}.xlsx`;we(p,d),o.success(`导出成功，共 ${l.length} 条数据`)}function W(){return D(this,null,function*(){var l;w.value=!0;try{yield(l=v.value)==null?void 0:l.validate();const e=yield xe({id:u.id,remarks:u.remarks});e.code===1?(o.success("修改成功"),_.value=!1,R()):o.error(e.msg||"修改失败")}catch(e){console.error("表单提交错误:",e),o.error("表单验证失败，请检查输入")}finally{w.value=!1}})}function G(l){f.value=l,R()}function H(){R()}return(l,e)=>{const g=ue,r=ce,p=pe,d=me,s=de,J=_e,Q=fe,X=ge,Y=re;return I(),B(Y,{bordered:!1,class:"proCard"},{default:a(()=>[i(y(ye),{onRegister:y(O),onSubmit:G,onReset:H},{statusSlot:a(({model:c,field:k})=>[i(g,{value:c[k],"onUpdate:value":N=>c[k]=N,options:y(F)},null,8,["value","onUpdate:value","options"])]),chaSlot:a(({model:c,field:k})=>[i(g,{value:c[k],"onUpdate:value":N=>c[k]=N,options:y($)},null,8,["value","onUpdate:value","options"])]),_:1},8,["onRegister"]),i(y(ne),{columns:y(De),request:V,"row-key":c=>c.id,ref_key:"actionRef",ref:n,"checked-row-keys":m.value,"onUpdate:checkedRowKeys":e[0]||(e[0]=c=>m.value=c),"scroll-x":1800,striped:!0},{tableTitle:a(()=>[i(d,{class:"flex items-center"},{default:a(()=>[i(p,{onClick:A},{icon:a(()=>[i(r,null,{default:a(()=>[i(y(be))]),_:1})]),default:a(()=>[e[4]||(e[4]=x(" 导出 "))]),_:1}),m.value.length>0?(I(),se("span",Re," 已选 "+ie(m.value.length)+" 项 ",1)):M("",!0),m.value.length>0?(I(),B(p,{key:1,text:"",type:"primary",onClick:j},{default:a(()=>e[5]||(e[5]=[x(" 清除 ")])),_:1})):M("",!0)]),_:1})]),_:1},8,["columns","row-key","checked-row-keys"]),i(X,{show:_.value,"onUpdate:show":e[3]||(e[3]=c=>_.value=c),"show-icon":!1,preset:"dialog",title:"编辑备注",style:{width:"500px"}},{action:a(()=>[i(d,null,{default:a(()=>[i(p,{onClick:e[2]||(e[2]=()=>_.value=!1)},{default:a(()=>e[6]||(e[6]=[x("取消")])),_:1}),i(p,{type:"info",loading:w.value,onClick:W},{default:a(()=>e[7]||(e[7]=[x(" 确定 ")])),_:1},8,["loading"])]),_:1})]),default:a(()=>[i(Q,{model:u,rules:b,ref_key:"formRef",ref:v,"label-placement":"left","label-width":80,class:"py-4"},{default:a(()=>[i(J,{label:"备注",path:"remarks"},{default:a(()=>[i(s,{type:"textarea",placeholder:"请输入备注",value:u.remarks,"onUpdate:value":e[1]||(e[1]=c=>u.remarks=c),autosize:{minRows:3,maxRows:5}},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["show"])]),_:1})}}});export{Le as default};
