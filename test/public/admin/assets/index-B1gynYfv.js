var j=Object.defineProperty;var N=Object.getOwnPropertySymbols;var W=Object.prototype.hasOwnProperty,G=Object.prototype.propertyIsEnumerable;var R=(e,o,t)=>o in e?j(e,o,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[o]=t,C=(e,o)=>{for(var t in o||(o={}))W.call(o,t)&&R(e,t,o[t]);if(N)for(var t of N(o))G.call(o,t)&&R(e,t,o[t]);return e};var x=(e,o,t)=>new Promise((h,c)=>{var _=i=>{try{s(t.next(i))}catch(f){c(f)}},b=i=>{try{s(t.throw(i))}catch(f){c(f)}},s=i=>i.done?h(i.value):Promise.resolve(i.value).then(_,b);s((t=t.apply(e,o)).next())});import{B as H}from"./Table-BcXbUTxg.js";import{s as B,v as T,A as z,d as J,u as K,r as g,b as Q,x as X,w as a,q as Y,o as Z,j as l,h as d,z as ee,i as S,C as te,B as oe,D as ne,k as ae,l as le,_ as re,E as se,N as ie}from"./index-FB6W5mBG.js";import{_ as ue}from"./BasicForm-BufV-4It.js";import{u as pe}from"./useForm-C7YbISyA.js";import"./vuedraggable.umd-C_5yRcwU.js";import"./useDesignSetting-BvT0Exi7.js";import"./propTypes-j0pcPl7w.js";import"./componentSetting-CQq0JJwW.js";import"./index-BgGIYSO9.js";import"./DownOutlined-BL5GVzwF.js";const I=[{label:"全部",value:""},{label:"充值",value:1},{label:"提现",value:2},{label:"广告结算",value:3},{label:"广告投放",value:4},{label:"后台扣除",value:5},{label:"投资失败",value:6},{label:"提现失败",value:7}],P=[{label:"全部",value:""},{label:"增加",value:1},{label:"扣除",value:2}];function ce(e){const t={1:{text:"充值",type:"success"},2:{text:"提现",type:"warning"},3:{text:"广告结算",type:"success"},4:{text:"广告投放",type:"warning"},5:{text:"后台扣除",type:"error"},6:{text:"投资失败",type:"error"},7:{text:"提现失败",type:"error"}}[e]||{text:"未知",type:"default"};return B(T,{type:t.type,bordered:!1},{default:()=>t.text})}function me(e){return B(T,{type:e===1?"success":"error",bordered:!1},{default:()=>e===1?"增加":"扣除"})}const de=[{title:"ID",key:"id",width:80},{title:"用户ID",key:"uid",width:100},{title:"用户简称",key:"username",width:120},{title:"FB_ID",key:"fb_id",width:120},{title:"所属管理者",key:"admin_username",width:120},{title:"交易金额",key:"money",width:120,render(e){return`${e.money} 元`}},{title:"交易类型",key:"type",width:120,render(e){return ce(e.type)}},{title:"资金方向",key:"cha",width:100,render(e){return me(e.cha)}},{title:"计划订单编号",key:"order_no",width:150},{title:"用户优惠券ID",key:"coupon_id",width:120},{title:"优惠金额",key:"coupon_money",width:120,render(e){return e.coupon_money?`${e.coupon_money} 元`:"-"}},{title:"备注",key:"remarks",width:200},{title:"更新时间",key:"update_time",width:180,render(e){return e.update_time?new Date(e.update_time*1e3).toLocaleString():"-"}},{title:"创建时间",key:"create_time",width:180,render(e){return e.create_time?new Date(e.create_time*1e3).toLocaleString():"-"}}];function _e(e){return z.Post("/admin/flow/list",e,{meta:{isReturnNativeResponse:!0}})}function fe(e){return z.Post("/admin/flow/edit",e,{meta:{isReturnNativeResponse:!0}})}const Se=J({__name:"index",setup(e){const o=K(),t=g(),h=g(),c=g(!1),_=g(!1),b=g({}),s=Q({id:0,remarks:""}),i={remarks:{required:!0,message:"请输入备注",trigger:["blur","input"]}},f=[{field:"uid",component:"NInput",label:"用户ID",componentProps:{placeholder:"请输入用户ID"}},{field:"username",component:"NInput",label:"用户简称",componentProps:{placeholder:"请输入用户简称"}},{field:"fb_id",component:"NInput",label:"FB_ID",componentProps:{placeholder:"请输入FB_ID"}},{field:"admin_username",component:"NInput",label:"所属管理者",componentProps:{placeholder:"请输入所属管理者"}},{field:"type",component:"NSelect",label:"交易类型",componentProps:{placeholder:"请选择交易类型",options:I,clearable:!0},slot:"statusSlot"},{field:"cha",component:"NSelect",label:"资金方向",componentProps:{placeholder:"请选择资金方向",options:P,clearable:!0},slot:"chaSlot"},{field:"order_no",component:"NInput",label:"计划订单编号",componentProps:{placeholder:"请输入计划订单编号"}},{field:"timeRange",component:"NDatePicker",label:"创建时间",componentProps:{type:"daterange",clearable:!0,shortcuts:{一周内:[Date.now()-7*24*60*60*1e3,Date.now()],一个月内:[Date.now()-30*24*60*60*1e3,Date.now()],三个月内:[Date.now()-90*24*60*60*1e3,Date.now()]}}}],[F]=pe({gridProps:{cols:"1 s:1 m:2 l:3 xl:4 2xl:4"},labelWidth:120,schemas:f});function M(D){return x(this,arguments,function*({page:m,pageSize:n}){const u=C({page:String(m),pageSize:String(n)},b.value);u.timeRange&&u.timeRange.length===2&&(u.sTime=Math.floor(u.timeRange[0]/1e3),u.eTime=Math.floor(u.timeRange[1]/1e3),delete u.timeRange);try{const p=(yield _e(u)).data;return{list:p.list||[],page:Number(p.page)||1,pageCount:Number(p.total_page)||0,pageSize:Number(p.page_size)||10,itemCount:Number(p.total)||0}}catch(w){return o.error("获取资金明细列表失败"),{list:[],page:1,pageCount:0,pageSize:10,itemCount:0}}})}function v(){t.value.reload()}function U(){return x(this,null,function*(){var m;_.value=!0;try{yield(m=h.value)==null?void 0:m.validate();const n=yield fe({id:s.id,remarks:s.remarks});n.code===1?(o.success("修改成功"),c.value=!1,v()):o.error(n.msg||"修改失败")}catch(n){console.error("表单提交错误:",n),o.error("表单验证失败，请检查输入")}finally{_.value=!1}})}function ye(){o.info("导出功能开发中...")}function V(m){b.value=m,v()}function $(){v()}return(m,n)=>{const D=te,u=ie,w=oe,p=ne,E=ae,L=le,q=re,O=se,A=Y;return Z(),X(A,{bordered:!1,class:"proCard"},{default:a(()=>[l(d(ue),{onRegister:d(F),onSubmit:V,onReset:$},{statusSlot:a(({model:r,field:y})=>[l(D,{value:r[y],"onUpdate:value":k=>r[y]=k,options:d(I)},null,8,["value","onUpdate:value","options"])]),chaSlot:a(({model:r,field:y})=>[l(D,{value:r[y],"onUpdate:value":k=>r[y]=k,options:d(P)},null,8,["value","onUpdate:value","options"])]),_:1},8,["onRegister"]),l(d(H),{columns:d(de),request:M,"row-key":r=>r.id,ref_key:"actionRef",ref:t,"scroll-x":1800,striped:!0},{tableTitle:a(()=>[l(p,null,{default:a(()=>[ee("",!0)]),_:1})]),_:1},8,["columns","row-key"]),l(O,{show:c.value,"onUpdate:show":n[2]||(n[2]=r=>c.value=r),"show-icon":!1,preset:"dialog",title:"编辑备注",style:{width:"500px"}},{action:a(()=>[l(p,null,{default:a(()=>[l(w,{onClick:n[1]||(n[1]=()=>c.value=!1)},{default:a(()=>n[4]||(n[4]=[S("取消")])),_:1}),l(w,{type:"info",loading:_.value,onClick:U},{default:a(()=>n[5]||(n[5]=[S(" 确定 ")])),_:1},8,["loading"])]),_:1})]),default:a(()=>[l(q,{model:s,rules:i,ref_key:"formRef",ref:h,"label-placement":"left","label-width":80,class:"py-4"},{default:a(()=>[l(L,{label:"备注",path:"remarks"},{default:a(()=>[l(E,{type:"textarea",placeholder:"请输入备注",value:s.remarks,"onUpdate:value":n[0]||(n[0]=r=>s.remarks=r),autosize:{minRows:3,maxRows:5}},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["show"])]),_:1})}}});export{Se as default};
