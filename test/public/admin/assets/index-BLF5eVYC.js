var P=(n,i,R)=>new Promise((F,D)=>{var z=b=>{try{h(R.next(b))}catch(d){D(d)}},o=b=>{try{h(R.throw(b))}catch(d){D(d)}},h=b=>b.done?F(b.value):Promise.resolve(b.value).then(z,o);h((R=R.apply(n,i)).next())});import{B as _e}from"./Table-BcXbUTxg.js";import{T as K}from"./TableAction-CTGB6Be_.js";import{_ as ye}from"./BasicForm-BufV-4It.js";import{u as ce}from"./useForm-C7YbISyA.js";import{E as ge}from"./EditOutlined-C-6o3zR1.js";import{A as q,s as f,N as be,v as I,d as we,u as ve,r as g,b as M,t as ke,a2 as he,c as Re,j as t,w as a,a1 as Ne,q as Se,o as Me,h as w,a as xe,i as u,y as _,B as N,C as Ce,k as Ue,l as Ae,U as Pe,_ as Fe,D as De,E as Te,F as Be,G as Ie,a3 as qe,a4 as ze}from"./index-FB6W5mBG.js";import"./vuedraggable.umd-C_5yRcwU.js";import"./useDesignSetting-BvT0Exi7.js";import"./propTypes-j0pcPl7w.js";import"./componentSetting-CQq0JJwW.js";import"./index-BgGIYSO9.js";import"./DownOutlined-BL5GVzwF.js";function Le(n){return q.Post("/admin/withdraw/list",n,{meta:{isReturnNativeResponse:!0}})}function Ee(n){return q.Post("/admin/withdraw/del",{id:n},{meta:{isReturnNativeResponse:!0}})}function $e(n){return q.Post("/admin/withdraw/withdrawAudit",n,{meta:{isReturnNativeResponse:!0}})}function Ve(n,i){return q.Post("/admin/withdraw/withdrawSystemRemarks",{id:n,system_remarks:i},{meta:{isReturnNativeResponse:!0}})}const Oe={0:"未审核",1:"审核成功",2:"审核驳回"},We={0:"warning",1:"success",2:"error"},je={1:"人工",2:"会员"},Je=[{title:"序号",width:100,key:"id"},{title:"账号",width:120,key:"username"},{title:"持卡人姓名",width:120,key:"name"},{title:"银行",width:200,key:"card",render(n){return f("span",{style:{wordBreak:"break-all"}},{default:()=>n.bank||"--"})}},{title:"卡号",width:200,key:"card",render(n){return f("span",{style:{wordBreak:"break-all"}},{default:()=>n.card})}},{title:"提现金额",width:120,key:"money",render(n){return f("span",{style:{color:"red"}},{default:()=>`${n.money.toFixed(2)}`})}},{title:"提现前金额",width:120,key:"before_money",render(n){return f("span",{},{default:()=>`${n.before_money.toFixed(2)}`})}},{title:"提现后金额",width:120,key:"after_money",render(n){const i=Number(n.before_money)-Number(n.money);return f("span",{},{default:()=>`${i.toFixed(2)}`})}},{title:"类型",width:100,key:"type",render(n){return f("span",{},{default:()=>je[n.type]||""})}},{title:"系统备注",width:200,key:"system_remarks",render(n){return f("div",{style:{display:"flex",alignItems:"center"}},[f("span",{style:{flex:1,wordBreak:"break-word",whiteSpace:"normal",overflow:"hidden",textOverflow:"ellipsis"}},n.system_remarks||"--"),f(be,{size:16,style:{cursor:"pointer",marginLeft:"5px",color:"#2080f0",flexShrink:0},onClick:i=>{i.stopPropagation(),window.dispatchEvent(new CustomEvent("edit-system-remarks",{detail:n}))}},{default:()=>f(ge)})])}},{title:"状态",width:100,key:"state",render(n){return f(I,{type:We[n.state]},{default:()=>Oe[n.state]})}},{title:"操作人",key:"admin_name",width:120},{title:"备注信息",width:160,key:"remarks"},{title:"创建时间",key:"create_time",width:160,render(n){const i=new Date(n.create_time*1e3);return f("span",{},{default:()=>i.toLocaleString()})}},{title:"审核时间",key:"audit_time",width:160,render(n){const i=n.audit_time?new Date(n.audit_time*1e3):"-";return f("span",{},{default:()=>i.toLocaleString()})}},{title:"是否锁单",key:"lock",width:100,render(n){return f(I,{type:n.lock===1?"error":"success"},{default:()=>n.lock===1?"已锁定":"未锁定"})}}],Ge={class:"text-right"},ut=we({__name:"index",setup(n){const i=ve(),R=g(),F=g(),D=g(),z=g(),o=M({username:"",admin_name:"",type:"",state:"",timeRange:[],mMoney:null,bMoney:null,page:1,pageSize:10}),h=g(!1),b=g(!1),d=M({username:"",cardholderName:"",bank:"",cardNumber:"",withdrawalAmount:0,type:"",remarkInfo:""}),x=g(!1),L=g(!1),m=M({id:0,username:"",withdrawalAmount:0,state:1,system_remarks:""}),C=g(!1),E=g(!1),v=M({id:0,username:"",system_remarks:""}),T=g(!1),s=M({}),V=r=>{const e=r.detail;v.id=e.id,v.username=e.username,v.system_remarks=e.system_remarks||"",C.value=!0};ke(()=>{window.addEventListener("edit-system-remarks",V)}),he(()=>{window.removeEventListener("edit-system-remarks",V)});const H={username:{required:!0,trigger:["blur","input"],message:"请输入用户名"},cardholderName:{required:!0,trigger:["blur","input"],message:"请输入持卡人姓名"},bank:{required:!0,trigger:["blur","input"],message:"请输入银行"},cardNumber:{required:!0,trigger:["blur","input"],message:"请输入卡号"},withdrawalAmount:{required:!0,trigger:["blur","input"],message:"请输入提现金额"},type:{required:!0,trigger:["blur","change"],message:"请选择类型"}},Q={state:{required:!0,trigger:["blur","change"],message:"请选择审核结果"},system_remarks:{required:!1,trigger:["blur","input"],message:"请输入系统备注"}},X=[{field:"admin_name",component:"NInput",label:"操作人",componentProps:{placeholder:"请输入操作人"}},{field:"username",component:"NInput",label:"用户名",componentProps:{placeholder:"请输入用户名"}},{field:"type",component:"NSelect",label:"类型",componentProps:{placeholder:"请选择类型",options:[{label:"全部",value:""},{label:"人工",value:1},{label:"会员",value:2}],clearable:!0}},{field:"timeRange",component:"NDatePicker",label:"时间范围",componentProps:{type:"daterange",clearable:!0,format:"yyyy-MM-dd"}},{field:"mMoney",component:"NInputNumber",label:"最小金额",componentProps:{placeholder:"请输入最小金额",clearable:!0}},{field:"bMoney",component:"NInputNumber",label:"最大金额",componentProps:{placeholder:"请输入最大金额",clearable:!0}},{field:"state",component:"NSelect",label:"状态",defaultValue:"",slot:"statusSlot",componentProps:{placeholder:"请选择状态"}}],Y=M({width:140,title:"操作",key:"action",fixed:"right",render(r){return r.state===0?f(K,{style:"button",actions:[{label:"审核",onClick:ne.bind(null,r),type:"primary"},{label:"删除",onClick:re.bind(null,r),type:"error"}]}):f(K,{style:"button",actions:[{label:"查看",onClick:()=>oe(r)}]})}}),[Z,{getFieldsValue:Ke}]=ce({gridProps:{cols:"1 s:1 m:2 l:3 xl:4 2xl:4"},labelWidth:80,schemas:X}),O=g("");function ee(r){return P(this,null,function*(){o.page=r.page||1,o.pageSize=r.pageSize||10;const e={};if(e.page=String(o.page),e.pageSize=String(o.pageSize),o.username&&(e.username=o.username),o.admin_name&&(e.admin_name=o.admin_name),o.type!==""&&(e.type=parseInt(o.type)),o.timeRange&&o.timeRange.length===2){const p=o.timeRange[0]instanceof Date?o.timeRange[0]:new Date(o.timeRange[0]),U=o.timeRange[1]instanceof Date?o.timeRange[1]:new Date(o.timeRange[1]);!isNaN(p.getTime())&&!isNaN(U.getTime())&&(e.sTime=Math.floor(p.getTime()/1e3),e.eTime=Math.floor(U.getTime()/1e3))}o.mMoney!==null&&o.mMoney!==void 0&&(e.mMoney=parseFloat(String(o.mMoney))),o.bMoney!==null&&o.bMoney!==void 0&&(e.bMoney=parseFloat(String(o.bMoney))),o.state!==""&&(e.state=o.state);try{const p=yield Le(e);return p.code===1?(O.value=p.data.money,{list:p.data.list||[],page:p.data.page,pageCount:p.data.total_page,pageSize:p.data.page_size,itemCount:p.data.total||0}):(i.error(p.msg||"获取提现列表数据失败"),{list:[],page:1,pageCount:1,pageSize:10,itemCount:0})}catch(p){return console.error("获取提现列表数据失败:",p),i.error("获取提现列表数据失败"),{list:[],page:1,pageCount:1,pageSize:10,itemCount:0}}})}function te(r){console.log(r)}function S(){R.value.reload()}function ae(){var r;(r=F.value)==null||r.validate(e=>{e||(b.value=!0,setTimeout(()=>{b.value=!1,h.value=!1,i.success("新增提现成功"),S()},500))})}function le(){return P(this,null,function*(){L.value=!0;try{const r=yield $e({id:m.id,state:Number(m.state),system_remarks:m.system_remarks});r.code===1?(x.value=!1,i.success("审核操作成功"),S()):i.error(r.msg||"审核操作失败")}catch(r){console.error("审核提现失败:",r),i.error("审核提现失败")}finally{L.value=!1}})}function ne(r){m.id=r.id,m.username=r.username,m.withdrawalAmount=r.money,m.state="1",m.system_remarks="",x.value=!0}function oe(r){Object.assign(s,JSON.parse(JSON.stringify(r))),T.value=!0}function re(r){return P(this,null,function*(){try{const e=yield Ee(r.id);e.code===1?(i.success("删除成功"),S()):i.error(e.msg||"删除失败")}catch(e){console.error("删除提现记录失败:",e),i.error("删除提现记录失败")}})}function se(){return P(this,null,function*(){E.value=!0;try{const r=yield Ve(v.id,v.system_remarks);r.code===1?(C.value=!1,i.success("系统备注更新成功"),S()):i.error(r.msg||"系统备注更新失败")}catch(r){console.error("更新系统备注失败:",r),i.error("更新系统备注失败")}finally{E.value=!1}})}function ue(r){Object.assign(o,r),S()}function ie(){o.username="",o.admin_name="",o.type="",o.state="",o.timeRange=[],o.mMoney=null,o.bMoney=null,S()}return(r,e)=>{const p=Ce,U=Se,de=I,k=Ue,c=Ae,W=Pe,$=Fe,A=De,B=Te,j=Be,me=Ie,y=qe,J=I,pe=ze;return Me(),Re(Ne,null,[t(U,{bordered:!1},{default:a(()=>[t(w(ye),{onRegister:w(Z),onSubmit:ue,onReset:ie},{statusSlot:a(({model:l,field:G})=>[t(p,{value:l[G],"onUpdate:value":fe=>l[G]=fe,options:[{label:"全部",value:""},{label:"未审核",value:0},{label:"已通过",value:1},{label:"已拒绝",value:2}]},null,8,["value","onUpdate:value"])]),_:1},8,["onRegister"])]),_:1}),t(U,{bordered:!1,class:"mt-3"},{default:a(()=>[t(w(_e),{columns:w(Je),request:ee,"row-key":l=>l.id,ref_key:"actionRef",ref:R,actionColumn:Y,"onUpdate:checkedRowKeys":te,"scroll-x":2400,striped:!0},{toolbar:a(()=>[xe("div",Ge,[e[21]||(e[21]=u("充值总额：")),t(de,{type:"warning"},{default:a(()=>[u(_(O.value),1)]),_:1})])]),_:1},8,["columns","row-key","actionColumn"]),t(B,{show:h.value,"onUpdate:show":e[8]||(e[8]=l=>h.value=l),"show-icon":!1,preset:"dialog",title:"新增提现"},{action:a(()=>[t(A,null,{default:a(()=>[t(w(N),{onClick:e[7]||(e[7]=()=>h.value=!1)},{default:a(()=>e[22]||(e[22]=[u("取消")])),_:1}),t(w(N),{type:"info",loading:b.value,onClick:ae},{default:a(()=>e[23]||(e[23]=[u("确定")])),_:1},8,["loading"])]),_:1})]),default:a(()=>[t($,{model:d,rules:H,ref_key:"formRef",ref:F,"label-placement":"left","label-width":100,class:"py-4"},{default:a(()=>[t(c,{label:"用户名",path:"username"},{default:a(()=>[t(k,{placeholder:"请输入用户名",value:d.username,"onUpdate:value":e[0]||(e[0]=l=>d.username=l)},null,8,["value"])]),_:1}),t(c,{label:"持卡人姓名",path:"cardholderName"},{default:a(()=>[t(k,{placeholder:"请输入持卡人姓名",value:d.cardholderName,"onUpdate:value":e[1]||(e[1]=l=>d.cardholderName=l)},null,8,["value"])]),_:1}),t(c,{label:"银行",path:"bank"},{default:a(()=>[t(k,{placeholder:"请输入银行",value:d.bank,"onUpdate:value":e[2]||(e[2]=l=>d.bank=l)},null,8,["value"])]),_:1}),t(c,{label:"卡号",path:"cardNumber"},{default:a(()=>[t(k,{placeholder:"请输入卡号",value:d.cardNumber,"onUpdate:value":e[3]||(e[3]=l=>d.cardNumber=l)},null,8,["value"])]),_:1}),t(c,{label:"提现金额",path:"withdrawalAmount"},{default:a(()=>[t(W,{value:d.withdrawalAmount,"onUpdate:value":e[4]||(e[4]=l=>d.withdrawalAmount=l),"show-button":!1,placeholder:"请输入提现金额"},null,8,["value"])]),_:1}),t(c,{label:"类型",path:"type"},{default:a(()=>[t(p,{value:d.type,"onUpdate:value":e[5]||(e[5]=l=>d.type=l),options:[{label:"银行卡",value:"银行卡"},{label:"支付宝",value:"支付宝"},{label:"微信",value:"微信"}],placeholder:"请选择类型"},null,8,["value"])]),_:1}),t(c,{label:"备注信息",path:"remarkInfo"},{default:a(()=>[t(k,{type:"textarea",placeholder:"请输入备注信息",value:d.remarkInfo,"onUpdate:value":e[6]||(e[6]=l=>d.remarkInfo=l)},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["show"]),t(B,{show:x.value,"onUpdate:show":e[14]||(e[14]=l=>x.value=l),"show-icon":!1,preset:"dialog",title:"提现审核"},{action:a(()=>[t(A,null,{default:a(()=>[t(w(N),{onClick:e[13]||(e[13]=()=>x.value=!1)},{default:a(()=>e[26]||(e[26]=[u("取消")])),_:1}),t(w(N),{type:"primary",loading:L.value,onClick:le},{default:a(()=>e[27]||(e[27]=[u("确认")])),_:1},8,["loading"])]),_:1})]),default:a(()=>[t($,{model:m,rules:Q,ref_key:"auditFormRef",ref:D,"label-placement":"left","label-width":100,class:"py-4"},{default:a(()=>[t(c,{label:"用户名"},{default:a(()=>[t(k,{value:m.username,"onUpdate:value":e[9]||(e[9]=l=>m.username=l),disabled:""},null,8,["value"])]),_:1}),t(c,{label:"提现金额"},{default:a(()=>[t(W,{value:m.withdrawalAmount,"onUpdate:value":e[10]||(e[10]=l=>m.withdrawalAmount=l),disabled:"","show-button":!1},null,8,["value"])]),_:1}),t(c,{label:"审核结果",path:"state"},{default:a(()=>[t(me,{value:m.state,"onUpdate:value":e[11]||(e[11]=l=>m.state=l)},{default:a(()=>[t(A,null,{default:a(()=>[t(j,{value:"1"},{default:a(()=>e[24]||(e[24]=[u("通过")])),_:1}),t(j,{value:"2"},{default:a(()=>e[25]||(e[25]=[u("拒绝")])),_:1})]),_:1})]),_:1},8,["value"])]),_:1}),t(c,{label:"系统备注",path:"system_remarks"},{default:a(()=>[t(k,{type:"textarea",placeholder:"请输入系统备注",value:m.system_remarks,"onUpdate:value":e[12]||(e[12]=l=>m.system_remarks=l)},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["show"]),t(B,{show:C.value,"onUpdate:show":e[18]||(e[18]=l=>C.value=l),"show-icon":!1,preset:"dialog",title:"编辑系统备注"},{action:a(()=>[t(A,null,{default:a(()=>[t(w(N),{onClick:e[17]||(e[17]=()=>C.value=!1)},{default:a(()=>e[28]||(e[28]=[u("取消")])),_:1}),t(w(N),{type:"info",loading:E.value,onClick:se},{default:a(()=>e[29]||(e[29]=[u("确定")])),_:1},8,["loading"])]),_:1})]),default:a(()=>[t($,{model:v,ref_key:"sysRemarksFormRef",ref:z,"label-placement":"left","label-width":100,class:"py-4"},{default:a(()=>[t(c,{label:"用户名"},{default:a(()=>[t(k,{value:v.username,"onUpdate:value":e[15]||(e[15]=l=>v.username=l),disabled:""},null,8,["value"])]),_:1}),t(c,{label:"系统备注",path:"system_remarks"},{default:a(()=>[t(k,{type:"textarea",placeholder:"请输入系统备注",value:v.system_remarks,"onUpdate:value":e[16]||(e[16]=l=>v.system_remarks=l)},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["show"]),t(B,{show:T.value,"onUpdate:show":e[20]||(e[20]=l=>T.value=l),preset:"card",style:{width:"800px"},title:"提现详情"},{action:a(()=>[t(A,null,{default:a(()=>[t(w(N),{onClick:e[19]||(e[19]=()=>T.value=!1)},{default:a(()=>e[30]||(e[30]=[u("关闭")])),_:1})]),_:1})]),default:a(()=>[t(pe,{bordered:"",column:2,class:"py-4"},{default:a(()=>[t(y,{label:"用户名"},{default:a(()=>[u(_(s.username),1)]),_:1}),t(y,{label:"持卡人姓名"},{default:a(()=>[u(_(s.name),1)]),_:1}),t(y,{label:"银行"},{default:a(()=>[u(_(s.bank||"无"),1)]),_:1}),t(y,{label:"卡号"},{default:a(()=>[u(_(s.card||"无"),1)]),_:1}),t(y,{label:"类型"},{default:a(()=>[u(_(s.type===1?"人工":s.type===2?"会员":"未知"),1)]),_:1}),t(y,{label:"状态"},{default:a(()=>[t(J,{type:s.state===1?"success":s.state===2?"error":"warning"},{default:a(()=>[u(_(s.state===1?"已通过":s.state===2?"已拒绝":"未审核"),1)]),_:1},8,["type"])]),_:1}),t(y,{label:"锁单状态"},{default:a(()=>[t(J,{type:s.lock===1?"error":"success"},{default:a(()=>[u(_(s.lock===1?"已锁定":"未锁定"),1)]),_:1},8,["type"])]),_:1}),t(y,{label:"提现金额"},{default:a(()=>[u(_(s.money?s.money.toFixed(2):"0.00"),1)]),_:1}),t(y,{label:"提现前金额"},{default:a(()=>[u(_(s.before_money?s.before_money.toFixed(2):"0.00"),1)]),_:1}),t(y,{label:"提现后金额"},{default:a(()=>[u(_(s.before_money&&s.money?(s.before_money-s.money).toFixed(2):"0.00"),1)]),_:1}),t(y,{label:"备注"},{default:a(()=>[u(_(s.remarks||"无"),1)]),_:1}),t(y,{label:"系统备注"},{default:a(()=>[u(_(s.system_remarks||"无"),1)]),_:1}),t(y,{label:"操作人"},{default:a(()=>[u(_(s.admin_name||"无"),1)]),_:1}),t(y,{label:"创建时间",span:2},{default:a(()=>[u(_(s.create_time?new Date(s.create_time*1e3).toLocaleString():"无"),1)]),_:1})]),_:1})]),_:1},8,["show"])]),_:1})],64)}}});export{ut as default};
