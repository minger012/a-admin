var $=Object.defineProperty;var b=Object.getOwnPropertySymbols;var F=Object.prototype.hasOwnProperty,j=Object.prototype.propertyIsEnumerable;var D=(d,n,e)=>n in d?$(d,n,{enumerable:!0,configurable:!0,writable:!0,value:e}):d[n]=e,k=(d,n)=>{for(var e in n||(n={}))F.call(n,e)&&D(d,e,n[e]);if(b)for(var e of b(n))j.call(n,e)&&D(d,e,n[e]);return d};var S=(d,n,e)=>new Promise((u,m)=>{var i=g=>{try{v(e.next(g))}catch(s){m(s)}},f=g=>{try{v(e.throw(g))}catch(s){m(s)}},v=g=>g.done?u(g.value):Promise.resolve(g.value).then(i,f);v((e=e.apply(d,n)).next())});import{_ as A}from"./FilterBar.vue_vue_type_script_setup_true_lang-Clb7vmgJ.js";import{_ as I}from"./ViewSwitch.vue_vue_type_script_setup_true_lang-CAhWDPpa.js";import{g as M,a as N}from"./statistics-D62jMcgO.js";import{d as W,u as q,r as c,t as E,o as z,x as T,w as _,j as l,a as p,y as x,c as P,s as G,B as H,D as J,$ as K,q as L,n as O}from"./index-BEDOAs2M.js";import"./admin-3ONY92Rh.js";import"./ButtonGroup-B1x3NxWM.js";const Q={class:"summary-item"},R={class:"summary-value"},X={class:"summary-item"},Y={class:"summary-value"},Z={key:0},aa={key:1},ea=W({__name:"AdminWelcomeStats",setup(d){const n=q(),e=c("summary"),u=c(!1),m=c({start_date:void 0,end_date:void 0,admin_username:void 0}),i=c({total_register_count:0,day_average_count:0,month_stats:[],day_stats:[],day_details:[]}),f=[{title:"月份",key:"month",width:200},{title:"邀请人数",key:"register_count",width:150},{title:"占比",key:"percentage",width:150,render(t){return`${t.percentage.toFixed(2)}%`}}],v=[{title:"日期",key:"date",width:150},{title:"邀请人数",key:"register_count",width:150},{title:"占总邀请比例",key:"percentage",width:150,render(t){return`${t.percentage.toFixed(2)}%`}},{title:"操作",key:"action",width:150,render(t){return G(H,{text:!0,type:"primary",size:"small",onClick:()=>U(t)},{default:()=>"查看明细"})}}],g=[{title:"ID",key:"id",width:80},{title:"日期",key:"date",width:150},{title:"年份",key:"year",width:100},{title:"月份",key:"month",width:100},{title:"日",key:"day",width:100},{title:"周",key:"week",width:100},{title:"邀请人数",key:"register_count",width:120}],s=c({page:1,pageSize:10,pageCount:1,itemCount:0,showSizePicker:!1,onChange:void 0}),o=c({page:1,pageSize:10,pageCount:1,itemCount:0,showSizePicker:!0,pageSizes:[10,20,50],onChange:void 0,onUpdatePageSize:void 0});function h(){return S(this,null,function*(){try{u.value=!0;const t=k({limit:String(s.value.pageSize),page:String(s.value.page),view_type:"summary"},m.value),a=yield M(t);a.code===1&&a.data?(i.value.total_register_count=a.data.total_register_count||0,i.value.day_average_count=a.data.day_average_count||0,i.value.month_stats=a.data.month_stats||[],i.value.day_stats=a.data.day_stats||[],i.value.day_details=a.data.day_details||[],a.data.pagination&&(s.value.page=a.data.pagination.page,s.value.pageCount=a.data.pagination.pageCount,s.value.itemCount=a.data.pagination.itemCount,s.value.onChange=r=>{s.value.page=r,h()})):n.error(a.message||"加载数据失败")}catch(t){console.error("加载数据失败:",t),n.error("加载数据失败")}finally{u.value=!1}})}function y(){return S(this,null,function*(){try{u.value=!0;const t=k({limit:String(o.value.pageSize),page:String(o.value.page),view_type:"detail"},m.value),a=yield N(t);a.code===1&&a.data?(i.value.day_details=a.data.day_details||[],a.data.pagination&&(o.value.page=a.data.pagination.page,o.value.pageSize=a.data.pagination.pageSize,o.value.pageCount=a.data.pagination.pageCount,o.value.itemCount=a.data.pagination.itemCount,o.value.onChange=r=>{o.value.page=r,y()},o.value.onUpdatePageSize=r=>{o.value.pageSize=r,o.value.page=1,y()})):n.error(a.message||"加载明细数据失败")}catch(t){console.error("加载明细数据失败:",t),n.error("加载明细数据失败")}finally{u.value=!1}})}function B(t){console.log("筛选条件:",t),m.value={start_date:t.startDate,end_date:t.endDate,admin_username:t.adminUsername},e.value==="summary"?(s.value.page=1,h()):(o.value.page=1,y())}function U(t){console.log("查看明细:",t),e.value="detail",o.value.page=1,y()}return E(()=>{h()}),(t,a)=>{const r=J,w=K,C=L;return z(),T(r,{vertical:"",size:"large"},{default:_(()=>[l(r,{justify:"space-between",align:"start"},{default:_(()=>[l(r,{size:"large"},{default:_(()=>[p("div",Q,[a[1]||(a[1]=p("div",{class:"summary-label"},"总邀请用户数",-1)),p("div",R,x(i.value.total_register_count),1)]),p("div",X,[a[2]||(a[2]=p("div",{class:"summary-label"},"日均邀请用户数",-1)),p("div",Y,x(i.value.day_average_count.toFixed(2)),1)])]),_:1}),l(A,{onChange:B})]),_:1}),l(r,null,{default:_(()=>[l(I,{modelValue:e.value,"onUpdate:modelValue":a[0]||(a[0]=V=>e.value=V)},null,8,["modelValue"])]),_:1}),e.value==="summary"?(z(),P("div",Z,[l(C,{bordered:!1,title:"按月统计",class:"mb-4"},{default:_(()=>[l(w,{columns:f,data:i.value.month_stats,pagination:!1,bordered:!1,loading:u.value},null,8,["data","loading"])]),_:1}),l(C,{bordered:!1,title:"按日统计"},{default:_(()=>[l(w,{columns:v,data:i.value.day_stats,pagination:s.value,bordered:!1,loading:u.value},null,8,["data","pagination","loading"])]),_:1})])):(z(),P("div",aa,[l(C,{bordered:!1,title:"明细统计"},{default:_(()=>[l(w,{columns:g,data:i.value.day_details,pagination:o.value,bordered:!1,loading:u.value},null,8,["data","pagination","loading"])]),_:1})]))]),_:1})}}}),ra=O(ea,[["__scopeId","data-v-5fd62810"]]);export{ra as default};
