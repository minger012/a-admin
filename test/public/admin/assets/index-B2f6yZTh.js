var G=Object.defineProperty;var I=Object.getOwnPropertySymbols;var H=Object.prototype.hasOwnProperty,J=Object.prototype.propertyIsEnumerable;var C=(e,n,o)=>n in e?G(e,n,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[n]=o,M=(e,n)=>{for(var o in n||(n={}))H.call(n,o)&&C(e,o,n[o]);if(I)for(var o of I(n))J.call(n,o)&&C(e,o,n[o]);return e};var D=(e,n,o)=>new Promise((_,u)=>{var w=p=>{try{y(o.next(p))}catch(f){u(f)}},a=p=>{try{y(o.throw(p))}catch(f){u(f)}},y=p=>p.done?_(p.value):Promise.resolve(p.value).then(w,a);y((o=o.apply(e,n)).next())});import{B as Q}from"./Table-BxPYim8H.js";import{T as Y}from"./TableAction-BhlWyVlW.js";import{_ as Z}from"./BasicForm-QjO4c9-O.js";import{u as ee}from"./useForm-BHF_BjGC.js";import{f as P}from"./dateUtil-DkzBes-4.js";import{s as c,a0 as te,v as x,A as O,d as ae,u as ne,p as ie,r as R,b as B,c as z,j as d,w as m,X as oe,q as se,o as S,h,i as N,y as F,z as j,x as le,a as V,N as re,B as ue,D as ce}from"./index--W9FB2Si.js";import{u as T,w as pe}from"./xlsx-DaVhO591.js";import{D as de}from"./DownloadOutlined-B-LhstHD.js";import"./vuedraggable.umd-B1pj_Zeo.js";import"./useDesignSetting-BH2ledVX.js";import"./propTypes-DHDRA3s2.js";import"./componentSetting-CQq0JJwW.js";import"./index-Tz6qLsBu.js";import"./DownOutlined-CqNoZsnt.js";const me={0:"失败",1:"成功"},fe={0:"error",1:"success"},ge={1:"真实充值",2:"虚拟充值",3:"系统赠送"},_e={0:"未退回",1:"已退回"},ye=[{type:"selection",fixed:"left"},{title:"ID",key:"id",width:80,fixed:"left"},{title:"用户ID",key:"uid",width:100},{title:"用户简称",key:"username",width:120},{title:"FB_ID",key:"fb_id",width:180},{title:"所属管理者",key:"admin_id",width:120},{title:"充值金额",key:"money",width:120,render(e){return c("span",{style:{color:"#f5222d",fontWeight:"bold"}},{default:()=>`${e.money.toFixed(2)}`})}},{title:"充值截图",key:"image",width:100,render(e){return e.image?c(te,{width:50,height:50,src:e.image,objectFit:"cover"}):c("span",{},"-")}},{title:"充值方式",key:"type",width:120,render(e){return c(x,{type:e.type===1?"success":e.type===2?"warning":"info"},ge[e.type]||"-")}},{title:"状态",key:"state",width:100,render(e){return c(x,{type:fe[e.state]},{default:()=>me[e.state]||"-"})}},{title:"虚拟充值退回状态",key:"virtual_state",width:150,render(e){return e.type!==2?c("span",{},"-"):c(x,{type:e.virtual_state===1?"success":"default"},{default:()=>_e[e.virtual_state]||"-"})}},{title:"后台备注",key:"remarks",width:180,ellipsis:{tooltip:!0}},{title:"用户端备注",key:"user_remarks",width:180,ellipsis:{tooltip:!0}},{title:"更新时间",key:"update_time",width:160,render(e){return c("span",{},{default:()=>e.update_time?P(e.update_time):"-"})}},{title:"创建时间",key:"create_time",width:160,render(e){return c("span",{},{default:()=>e.create_time?P(e.create_time):"-"})}}];function L(e){return O.Post("/admin/order/list",e,{meta:{isReturnNativeResponse:!0}})}function he(e){return O.Post("/admin/order/del",{id:e},{meta:{isReturnNativeResponse:!0}})}const be={key:0,class:"text-gray-500"},ke={class:"text-[#2d8cf0]"},je=ae({__name:"index",setup(e){const n=ne(),o=ie(),_=R(),u=R([]),w=[{field:"uid",component:"NInputNumber",label:"用户ID",componentProps:{placeholder:"请输入用户ID",clearable:!0}},{field:"username",component:"NInput",label:"用户账号",componentProps:{placeholder:"请输入用户账号",clearable:!0}},{field:"admin_username",component:"NInput",label:"所属管理者",componentProps:{placeholder:"请输入管理员账号",clearable:!0}},{field:"fb_id",component:"NInput",label:"FB_ID",componentProps:{placeholder:"请输入订单号",clearable:!0}},{field:"type",component:"NSelect",label:"充值方式",defaultValue:"",componentProps:{placeholder:"请选择充值方式",options:[{label:"全部",value:""},{label:"真实充值",value:1},{label:"虚拟充值",value:2},{label:"系统赠送",value:3}],clearable:!0}},{field:"timeRange",component:"NDatePicker",label:"创建时间",componentProps:{type:"daterange",clearable:!0}}],a=B({uid:null,username:"",admin_username:"",fb_id:"",type:"",timeRange:null,page:1,pageSize:10}),y=B({width:120,title:"操作",key:"action",fixed:"right",render(i){return c(Y,{style:"button",actions:[{label:"删除",disabled:i.state===1,onClick:E.bind(null,i),type:"error"}]})}}),[p]=ee({gridProps:{cols:"1 s:1 m:2 l:3 xl:4 2xl:4"},labelWidth:100,schemas:w}),f=R("");function A(i){return D(this,null,function*(){a.page=i.page||1,a.pageSize=i.pageSize||10;const t={};if(t.page=String(a.page),t.pageSize=String(a.pageSize),a.uid!==null&&a.uid!==void 0&&(t.uid=a.uid),a.username&&(t.username=a.username),a.admin_username&&(t.admin_username=a.admin_username),a.fb_id&&(t.fb_id=a.fb_id),a.type!==""&&(t.type=parseInt(a.type)),a.timeRange&&a.timeRange.length===2){const r=a.timeRange[0]instanceof Date?a.timeRange[0]:new Date(a.timeRange[0]),l=a.timeRange[1]instanceof Date?a.timeRange[1]:new Date(a.timeRange[1]);!isNaN(r.getTime())&&!isNaN(l.getTime())&&(t.sTime=Math.floor(r.getTime()/1e3),t.eTime=Math.floor(l.getTime()/1e3))}return L(t).then(r=>{const{data:l}=r;return f.value=l.money||"0",{list:l.list||[],page:l.page,pageCount:l.total_page,pageSize:l.page_size,itemCount:l.total}}).catch(()=>(n.error("获取充值列表失败"),{list:[],page:1,pageCount:0,pageSize:10,itemCount:0}))})}function v(){_.value.reload()}function E(i){if(i.state===1){n.warning("成功状态的充值记录不可删除");return}o.warning({title:"删除确认",content:"确定要删除该充值记录吗？",positiveText:"确定",negativeText:"取消",onPositiveClick:()=>{n.loading("删除中..."),he(i.id).then(t=>{t.code==1?(n.success("删除成功"),v()):n.error(t.msg||"删除失败")}).catch(()=>{n.error("删除失败")})}})}function $(i){Object.assign(a,i),v()}function q(){a.uid=null,a.username="",a.admin_username="",a.fb_id="",a.type="",a.timeRange=null,v()}function K(){u.value=[]}function W(){return D(this,null,function*(){let i=[];if(u.value.length>0)i=_.value.getDataSource().filter(r=>u.value.includes(r.id));else try{const t=M({page:"1",pageSize:"999999"},a);t.timeRange&&t.timeRange.length===2&&(t.sTime=Math.floor(t.timeRange[0]/1e3),t.eTime=Math.floor(t.timeRange[1]/1e3),delete t.timeRange),i=(yield L(t)).data.list||[]}catch(t){n.error("获取数据失败");return}if(i.length===0){n.warning("没有数据可导出");return}U(i)})}function U(i){const t={1:"真实充值",2:"虚拟充值",3:"系统赠送"},r={0:"失败",1:"成功"},l={0:"未退回",1:"已退回"},b=i.map(s=>({ID:s.id,用户ID:s.uid,用户简称:s.username||"-",FB_ID:s.fb_id||"-",所属管理者:s.admin_id||"-",充值金额:s.money.toFixed(2),充值截图:s.image||"-",充值方式:t[s.type]||"-",状态:r[s.state]||"-",虚拟充值退回状态:s.type===2&&l[s.virtual_state]||"-",后台备注:s.remarks||"-",用户端备注:s.user_remarks||"-",更新时间:s.update_time?new Date(s.update_time*1e3).toLocaleString():"-",创建时间:s.create_time?new Date(s.create_time*1e3).toLocaleString():"-"})),k=T.json_to_sheet(b),g=T.book_new();T.book_append_sheet(g,k,"充值记录");const X=`充值记录_${new Date().toLocaleDateString().replace(/\//g,"-")}.xlsx`;pe(g,X),n.success(`导出成功，共 ${i.length} 条数据`)}return(i,t)=>{const r=se,l=re,b=ue,k=ce;return S(),z(oe,null,[d(r,{bordered:!1},{default:m(()=>[d(h(Z),{onRegister:h(p),onSubmit:$,onReset:q},null,8,["onRegister"])]),_:1}),d(r,{bordered:!1,class:"mt-3"},{default:m(()=>[d(h(Q),{columns:h(ye),request:A,"row-key":g=>g.id,ref_key:"actionRef",ref:_,actionColumn:y,"checked-row-keys":u.value,"onUpdate:checkedRowKeys":t[0]||(t[0]=g=>u.value=g),"scroll-x":2100,striped:!0},{tableTitle:m(()=>[d(k,{class:"flex items-center justify-between",style:{width:"100%"}},{default:m(()=>[d(k,{class:"flex items-center"},{default:m(()=>[d(b,{onClick:W},{icon:m(()=>[d(l,null,{default:m(()=>[d(h(de))]),_:1})]),default:m(()=>[t[1]||(t[1]=N(" 导出 "))]),_:1}),u.value.length>0?(S(),z("span",be," 已选 "+F(u.value.length)+" 项 ",1)):j("",!0),u.value.length>0?(S(),le(b,{key:1,text:"",type:"primary",onClick:K},{default:m(()=>t[2]||(t[2]=[N(" 清除 ")])),_:1})):j("",!0),V("div",null,[t[3]||(t[3]=N("当前充值方式总额：")),V("strong",ke,F(f.value),1)])]),_:1})]),_:1})]),_:1},8,["columns","row-key","actionColumn","checked-row-keys"])]),_:1})],64)}}});export{je as default};
